import{_ as a,c as e,f as n,o as t}from"./app-DSybn1wf.js";const l={};function p(c,s){return t(),e("div",null,s[0]||(s[0]=[n('<h2 id="_1-问题需求" tabindex="-1"><a class="header-anchor" href="#_1-问题需求"><span>1. 问题需求</span></a></h2><p>如一台机器上有个 346MB 的 cactus.tar 文件，需要把这个文件通过 rsync 或 scp 传输到另一台机器上，现在网络的速度限制在每秒传输1.1MB ，需要多长时间能传输完成整个文件？</p><p>要计算传输文件的时间，我们可以使用以下公式：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>传输时间</mtext><mo>=</mo><mfrac><mtext>文件大小</mtext><mtext>带宽速度</mtext></mfrac></mrow><annotation encoding="application/x-tex"> \\text{传输时间} = \\frac{\\text{文件大小}}{\\text{带宽速度}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">传输时间</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">带宽速度</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">文件大小</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>关键条件：</p><ul><li>文件大小为 346MB</li><li>带宽速度为 1.1MB/秒</li></ul><p>按照公式，计算传输时间：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>传输时间</mtext><mo>=</mo><mfrac><mrow><mn>346</mn><mtext>MB</mtext></mrow><mrow><mn>1.1</mn><mtext>MB/秒</mtext></mrow></mfrac><mo>=</mo><mn>314.55</mn></mrow><annotation encoding="application/x-tex"> \\text{传输时间} = \\frac{346 \\text{MB}}{1.1 \\text{MB/秒}} = 314.55 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord cjk_fallback">传输时间</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1.1</span><span class="mord text"><span class="mord">MB/</span><span class="mord cjk_fallback">秒</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">346</span><span class="mord text"><span class="mord">MB</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">314.55</span></span></span></span></span></p><p>将秒数转换为分钟：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>314.55</mn><mtext>秒</mtext><mo>=</mo><mfrac><mn>314.55</mn><mn>60</mn></mfrac><mo>≈</mo><mn>5.24</mn><mtext>分钟</mtext></mrow><annotation encoding="application/x-tex"> 314.55 \\text{秒} = \\frac{314.55}{60} \\approx 5.24 \\text{分钟} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">314.55</span><span class="mord text"><span class="mord cjk_fallback">秒</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">60</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">314.55</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">5.24</span><span class="mord text"><span class="mord cjk_fallback">分钟</span></span></span></span></span></span></p><p>因此，传输这个 346MB 的文件大约需要 <strong>5.24 分钟</strong>。</p><h2 id="_2-优化文件传输速度" tabindex="-1"><a class="header-anchor" href="#_2-优化文件传输速度"><span>2. 优化文件传输速度</span></a></h2><p>在网络带宽无法提升的情况下，优化文件传输的方式可以帮助提高传输效率。以下是一些优化传输速度的方式，尽管网络速度固定为1.1MB/s，但通过减少数据量、优化传输机制可以加速整体的传输过程：</p><h3 id="_2-1-压缩文件" tabindex="-1"><a class="header-anchor" href="#_2-1-压缩文件"><span>2.1. <strong>压缩文件</strong></span></a></h3><p>传输前先对文件进行压缩，以减少实际传输的数据量。这可以通过压缩工具如 <code>gzip</code> 或者 <code>tar</code> 的压缩选项实现。虽然 <code>cactus.tar</code> 已经是一个归档文件，但它可能还没有被压缩。你可以通过以下命令进一步压缩：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">tar</span><span style="color:#D19A66;"> -czvf</span><span style="color:#98C379;"> cactus.tar.gz</span><span style="color:#98C379;"> cactus.tar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后传输压缩后的文件 <code>cactus.tar.gz</code>。这样可以减少传输的数据量。</p><h3 id="_2-2-使用-rsync-的压缩功能" tabindex="-1"><a class="header-anchor" href="#_2-2-使用-rsync-的压缩功能"><span>2.2. <strong>使用 rsync 的压缩功能</strong></span></a></h3><p>如果选择使用 <code>rsync</code>，可以直接在传输过程中启用压缩选项 <code>-z</code>，这会在传输时压缩文件，减小需要传输的数据量：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">rsync</span><span style="color:#D19A66;"> -avz</span><span style="color:#98C379;"> cactus.tar</span><span style="color:#98C379;"> user@remote_host:/path/to/destination/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这个方法在传输过程中自动压缩和解压缩，节省带宽。</p><h3 id="_2-3-分片传输" tabindex="-1"><a class="header-anchor" href="#_2-3-分片传输"><span>2.3. <strong>分片传输</strong></span></a></h3><p>如果文件非常大且网络波动较大，可以考虑将文件分割为多个小文件并行传输，优化传输的鲁棒性。可以使用 <code>split</code> 命令将文件分割，例如：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">split</span><span style="color:#D19A66;"> -b</span><span style="color:#98C379;"> 100M</span><span style="color:#98C379;"> cactus.tar</span><span style="color:#98C379;"> cactus_part_</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后可以通过多个会话同时传输各个文件部分，并在远端重组这些文件。传输完成后，通过 <code>cat</code> 命令在目标机器上合并文件：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">cat</span><span style="color:#98C379;"> cactus_part_</span><span style="color:#E5C07B;">*</span><span style="color:#ABB2BF;"> &gt; </span><span style="color:#98C379;">cactus.tar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-4-调整-scp-rsync-的加密算法" tabindex="-1"><a class="header-anchor" href="#_2-4-调整-scp-rsync-的加密算法"><span>2.4. <strong>调整 SCP/RSYNC 的加密算法</strong></span></a></h3><p>如果 CPU 性能有限，加密的开销可能会降低传输速度。你可以尝试使用一个较轻量的加密算法来减小加密开销。</p><p>在 <code>scp</code> 中，可以指定更快速的加密算法（如 <code>arcfour</code> 或 <code>aes128-ctr</code>）：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">scp</span><span style="color:#D19A66;"> -c</span><span style="color:#98C379;"> arcfour</span><span style="color:#98C379;"> cactus.tar</span><span style="color:#98C379;"> user@remote_host:/path/to/destination/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在 <code>rsync</code> 中，也可以通过 <code>ssh</code> 参数指定加密算法：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">rsync</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &#39;ssh -c aes128-ctr&#39;</span><span style="color:#98C379;"> cactus.tar</span><span style="color:#98C379;"> user@remote_host:/path/to/destination/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-5-利用多线程工具" tabindex="-1"><a class="header-anchor" href="#_2-5-利用多线程工具"><span>2.5. <strong>利用多线程工具</strong></span></a></h3><p>你可以使用多线程文件传输工具，如 <code>bbcp</code> 或 <code>mcb</code>, 它们可以利用并行流加快传输速度。示例命令如下：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">bbcp</span><span style="color:#D19A66;"> -z</span><span style="color:#D19A66;"> -P</span><span style="color:#D19A66;"> 5</span><span style="color:#98C379;"> cactus.tar</span><span style="color:#98C379;"> user@remote_host:/path/to/destination/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>其中 <code>-P 5</code> 指的是开启 5 个并行流来加速传输。</p><h3 id="_2-6-udp-based-传输工具" tabindex="-1"><a class="header-anchor" href="#_2-6-udp-based-传输工具"><span>2.6. <strong>UDP-based 传输工具</strong></span></a></h3><p>在某些场景中，基于 TCP 的传输可能会受到网络延迟影响。使用基于 UDP 的传输工具，如 <code>UDT</code> 或 <code>tsunami-udp</code>，可以在不可靠的网络条件下提升传输速度。UDP 传输没有 TCP 的流控制机制，但需要更复杂的错误检测与处理。</p><h3 id="_2-7-减少包大小和窗口调整" tabindex="-1"><a class="header-anchor" href="#_2-7-减少包大小和窗口调整"><span>2.7. <strong>减少包大小和窗口调整</strong></span></a></h3><p>使用 <code>rsync</code> 或 <code>scp</code> 时，可以调节网络窗口大小、包大小来优化传输效率。通过配置网络传输参数，可以更好地利用带宽。通过修改 SSH 参数来优化性能：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">scp</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> &quot;TCPWindowSize=65536&quot;</span><span style="color:#98C379;"> cactus.tar</span><span style="color:#98C379;"> user@remote_host:/path/to/destination/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>总结来说，如果带宽是固定的，最常用且简单的优化方法是<strong>压缩文件</strong>，结合 <code>rsync</code> 的压缩传输选项。对于更加复杂的场景，可以考虑分片传输、多线程、甚至基于 UDP 的传输方式。</p>',42)]))}const o=a(l,[["render",p],["__file","Linux优化大文件传输速度.html.vue"]]),i=JSON.parse(`{"path":"/linuxs/Linux/Linux%E4%BC%98%E5%8C%96%E5%A4%A7%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%80%9F%E5%BA%A6.html","title":"Linux优化大文件传输速度","lang":"zh-CN","frontmatter":{"title":"Linux优化大文件传输速度","subtitle":"Linux优化大文件传输速度","date":"2024-09-26T17:15:26.000Z","category":["Linux"],"tag":["Linux"],"order":2,"description":"1. 问题需求 如一台机器上有个 346MB 的 cactus.tar 文件，需要把这个文件通过 rsync 或 scp 传输到另一台机器上，现在网络的速度限制在每秒传输1.1MB ，需要多长时间能传输完成整个文件？ 要计算传输文件的时间，我们可以使用以下公式： 传输时间=带宽速度文件大小​ 关键条件： 文件大小为 346MB 带宽速度为 1.1MB/...","head":[["meta",{"property":"og:url","content":"https://cactusli.net/linuxs/Linux/Linux%E4%BC%98%E5%8C%96%E5%A4%A7%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%80%9F%E5%BA%A6.html"}],["meta",{"property":"og:site_name","content":"Cactus's Blog"}],["meta",{"property":"og:title","content":"Linux优化大文件传输速度"}],["meta",{"property":"og:description","content":"1. 问题需求 如一台机器上有个 346MB 的 cactus.tar 文件，需要把这个文件通过 rsync 或 scp 传输到另一台机器上，现在网络的速度限制在每秒传输1.1MB ，需要多长时间能传输完成整个文件？ 要计算传输文件的时间，我们可以使用以下公式： 传输时间=带宽速度文件大小​ 关键条件： 文件大小为 346MB 带宽速度为 1.1MB/..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-29T09:45:24.000Z"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2024-09-26T17:15:26.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-29T09:45:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux优化大文件传输速度\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-09-26T17:15:26.000Z\\",\\"dateModified\\":\\"2024-10-29T09:45:24.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Cactus li\\",\\"url\\":\\"https://cactusli.net\\"}]}"]]},"headers":[{"level":2,"title":"1. 问题需求","slug":"_1-问题需求","link":"#_1-问题需求","children":[]},{"level":2,"title":"2. 优化文件传输速度","slug":"_2-优化文件传输速度","link":"#_2-优化文件传输速度","children":[{"level":3,"title":"2.1. 压缩文件","slug":"_2-1-压缩文件","link":"#_2-1-压缩文件","children":[]},{"level":3,"title":"2.2. 使用 rsync 的压缩功能","slug":"_2-2-使用-rsync-的压缩功能","link":"#_2-2-使用-rsync-的压缩功能","children":[]},{"level":3,"title":"2.3. 分片传输","slug":"_2-3-分片传输","link":"#_2-3-分片传输","children":[]},{"level":3,"title":"2.4. 调整 SCP/RSYNC 的加密算法","slug":"_2-4-调整-scp-rsync-的加密算法","link":"#_2-4-调整-scp-rsync-的加密算法","children":[]},{"level":3,"title":"2.5. 利用多线程工具","slug":"_2-5-利用多线程工具","link":"#_2-5-利用多线程工具","children":[]},{"level":3,"title":"2.6. UDP-based 传输工具","slug":"_2-6-udp-based-传输工具","link":"#_2-6-udp-based-传输工具","children":[]},{"level":3,"title":"2.7. 减少包大小和窗口调整","slug":"_2-7-减少包大小和窗口调整","link":"#_2-7-减少包大小和窗口调整","children":[]}]}],"git":{"createdTime":1729132573000,"updatedTime":1730195124000,"contributors":[{"name":"lixuanfengs","email":"1183895890@qq.com","commits":2}]},"readingTime":{"minutes":3.45,"words":1035},"filePathRelative":"linuxs/Linux/Linux优化大文件传输速度.md","localizedDate":"2024年9月26日","excerpt":"<h2>1. 问题需求</h2>\\n<p>如一台机器上有个 346MB 的 cactus.tar 文件，需要把这个文件通过 rsync 或 scp 传输到另一台机器上，现在网络的速度限制在每秒传输1.1MB ，需要多长时间能传输完成整个文件？</p>\\n<p>要计算传输文件的时间，我们可以使用以下公式：</p>\\n<p v-pre=\\"\\" class=\\"katex-block\\"><span class=\\"katex-display\\"><span class=\\"katex\\"><span class=\\"katex-mathml\\"><math xmlns=\\"http://www.w3.org/1998/Math/MathML\\" display=\\"block\\"><semantics><mrow><mtext>传输时间</mtext><mo>=</mo><mfrac><mtext>文件大小</mtext><mtext>带宽速度</mtext></mfrac></mrow><annotation encoding=\\"application/x-tex\\">\\n\\\\text{传输时间} = \\\\frac{\\\\text{文件大小}}{\\\\text{带宽速度}}\\n</annotation></semantics></math></span><span class=\\"katex-html\\" aria-hidden=\\"true\\"><span class=\\"base\\"><span class=\\"strut\\" style=\\"height:0.6833em;\\"></span><span class=\\"mord text\\"><span class=\\"mord cjk_fallback\\">传输时间</span></span><span class=\\"mspace\\" style=\\"margin-right:0.2778em;\\"></span><span class=\\"mrel\\">=</span><span class=\\"mspace\\" style=\\"margin-right:0.2778em;\\"></span></span><span class=\\"base\\"><span class=\\"strut\\" style=\\"height:2.0463em;vertical-align:-0.686em;\\"></span><span class=\\"mord\\"><span class=\\"mopen nulldelimiter\\"></span><span class=\\"mfrac\\"><span class=\\"vlist-t vlist-t2\\"><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:1.3603em;\\"><span style=\\"top:-2.314em;\\"><span class=\\"pstrut\\" style=\\"height:3em;\\"></span><span class=\\"mord\\"><span class=\\"mord text\\"><span class=\\"mord cjk_fallback\\">带宽速度</span></span></span></span><span style=\\"top:-3.23em;\\"><span class=\\"pstrut\\" style=\\"height:3em;\\"></span><span class=\\"frac-line\\" style=\\"border-bottom-width:0.04em;\\"></span></span><span style=\\"top:-3.677em;\\"><span class=\\"pstrut\\" style=\\"height:3em;\\"></span><span class=\\"mord\\"><span class=\\"mord text\\"><span class=\\"mord cjk_fallback\\">文件大小</span></span></span></span></span><span class=\\"vlist-s\\">​</span></span><span class=\\"vlist-r\\"><span class=\\"vlist\\" style=\\"height:0.686em;\\"><span></span></span></span></span></span><span class=\\"mclose nulldelimiter\\"></span></span></span></span></span></span></p>","autoDesc":true}`);export{o as comp,i as data};
