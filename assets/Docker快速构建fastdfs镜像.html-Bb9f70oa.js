import{_ as n,c as a,f as l,o as e}from"./app-cT001TM_.js";const p={};function i(o,s){return e(),a("div",null,s[0]||(s[0]=[l(`<h2 id="_1-安装fastdfs所需文件" tabindex="-1"><a class="header-anchor" href="#_1-安装fastdfs所需文件"><span>1. 安装fastdfs所需文件</span></a></h2><table><thead><tr><th>文件名</th><th>文件说明</th><th>本次安装版本</th></tr></thead><tbody><tr><td><a href="https://github.com/happyfish100/libfastcommon" target="_blank" rel="noopener noreferrer">libfastcommon</a></td><td>从 FastDFS 和 FastDHT 中提取出来的公共 C 函数库</td><td><a href="https://github.com/happyfish100/libfastcommon/archive/refs/tags/V1.0.75.tar.gz" target="_blank" rel="noopener noreferrer">V1.0.75</a></td></tr><tr><td><a href="https://github.com/happyfish100/libserverframe" target="_blank" rel="noopener noreferrer">libserverframe</a></td><td>从 FastDFS 中提取的网络服务框架库</td><td><a href="https://github.com/happyfish100/libserverframe/releases/tag/V1.2.5" target="_blank" rel="noopener noreferrer">V1.2.5</a></td></tr><tr><td><a href="https://github.com/happyfish100/fastdfs" target="_blank" rel="noopener noreferrer">fastdfs</a></td><td>FastDFS 源码，包含 tracker 和 storage 服务</td><td><a href="https://github.com/happyfish100/fastdfs/archive/refs/tags/V6.12.2.tar.gz" target="_blank" rel="noopener noreferrer">V6.12.2</a></td></tr><tr><td><a href="https://github.com/happyfish100/fastdfs-nginx-module" target="_blank" rel="noopener noreferrer">fastdfs-nginx-module</a></td><td>FastDFS 与 Nginx 关联模块，实现访问和下载文件</td><td><a href="https://github.com/happyfish100/fastdfs-nginx-module/archive/refs/tags/V1.24.tar.gz" target="_blank" rel="noopener noreferrer">V1.24</a></td></tr><tr><td><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">nginx</a></td><td>使文件能够通过http访问</td><td><a href="http://nginx.org/download/nginx-1.26.2.tar.gz" target="_blank" rel="noopener noreferrer">1.22.0</a></td></tr></tbody></table><blockquote><p>Linux 中下载文件命令：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> wget</span><span style="color:#D19A66;"> -O</span><span style="color:#98C379;"> libfastcommon-1.0.75.tar.gz</span><span style="color:#98C379;"> https://github.com/happyfish100/libfastcommon/archive/refs/tags/V1.0.75.tar.gz</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> wget</span><span style="color:#D19A66;"> -O</span><span style="color:#98C379;"> libserverframe-1.2.5.tar.gz</span><span style="color:#98C379;"> https://github.com/happyfish100/libserverframe/archive/refs/tags/V1.2.5.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> wget</span><span style="color:#D19A66;"> -O</span><span style="color:#98C379;"> fastdfs-6.12.2.tar.gz</span><span style="color:#98C379;"> https://github.com/happyfish100/fastdfs/archive/refs/tags/V6.12.2.tar.gz</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> wget</span><span style="color:#D19A66;"> -O</span><span style="color:#98C379;"> fastdfs-nginx-module-1.24.tar.gz</span><span style="color:#98C379;"> https://github.com/happyfish100/fastdfs-nginx-module/archive/refs/tags/V1.24.tar.gz</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> wget</span><span style="color:#98C379;"> http://nginx.org/download/nginx-1.26.2.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h2 id="_2-提取并修改相关配置文件" tabindex="-1"><a class="header-anchor" href="#_2-提取并修改相关配置文件"><span>2. 提取并修改相关配置文件</span></a></h2><h3 id="_2-1-提取文件" tabindex="-1"><a class="header-anchor" href="#_2-1-提取文件"><span>2.1 提取文件</span></a></h3><ol><li><p>解压 <code>fastdfs-6.12.2.tar.gz</code> 源码包，找到<code>http.con</code>f、<code>mime.types</code>、<code>storage_ids.conf</code>, <code>storage_ids.conf</code>文件只是用于构建好的镜像使用时挂载目录到容器内。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> tar</span><span style="color:#98C379;"> xzvf</span><span style="color:#98C379;"> fastdfs-6.12.2.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241025112101573.png" alt="image-20241025112101573" tabindex="0" loading="lazy"><figcaption>image-20241025112101573</figcaption></figure></li><li><p>解压<code>fastdfs-nginx-module-6.12.2.tar.gz</code>源码包找到mod_fastdfs.conf并提取,为后续编译做准备。</p><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241025161438574.png" alt="image-20241025161438574" tabindex="0" loading="lazy"><figcaption>image-20241025161438574</figcaption></figure></li><li><p>从nginx源码包中找到<code>nginx.conf</code> 提取配置文件</p><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241025161709574.png" alt="image-20241025161709574" tabindex="0" loading="lazy"><figcaption>image-20241025161709574</figcaption></figure></li></ol><p>在 <code>/sg-work/fastdfs-docker/</code> 目录下新建 <code>conf</code> 目录，将所有需要的配置文件都 <code>cp</code> 到<code>conf </code>目录下</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> mkdir</span><span style="color:#98C379;"> conf</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> cp</span><span style="color:#D19A66;"> -r</span><span style="color:#98C379;"> /sg-work/fastdfs-docker/fastdfs-6.12.2/conf/</span><span style="color:#E5C07B;">*</span><span style="color:#98C379;"> /sg-work/fastdfs-docker/conf/</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> cp</span><span style="color:#98C379;"> fastdfs-nginx-module-1.24/src/mod_fastdfs.conf</span><span style="color:#98C379;"> conf/</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> cp</span><span style="color:#98C379;"> nginx-1.26.2/conf/nginx.conf</span><span style="color:#98C379;"> conf/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-改相关配置文件" tabindex="-1"><a class="header-anchor" href="#_2-2-改相关配置文件"><span>2.2 改相关配置文件</span></a></h3><h4 id="_2-2-1-修改-tracker-conf" tabindex="-1"><a class="header-anchor" href="#_2-2-1-修改-tracker-conf"><span>2.2.1 修改 <code>tracker.conf</code></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 禁用配置文件（默认为 false，表示启用配置文件）</span></span>
<span class="line"><span style="color:#E06C75;">disabled</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">false</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Tracker 服务端口（默认为 22122）</span></span>
<span class="line"><span style="color:#E06C75;">port</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">22122</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 存储日志和数据的根目录</span></span>
<span class="line"><span style="color:#E06C75;">base_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">/home/fastdfs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-2-修改-storage-conf" tabindex="-1"><a class="header-anchor" href="#_2-2-2-修改-storage-conf"><span>2.2.2 修改 <code>storage.conf</code></span></a></h4><p>这里只修改base_path、store_path0、tracker_server</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 启用配置文件（默认为 false，表示启用配置文件）</span></span>
<span class="line"><span style="color:#E06C75;">disabled</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">false</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Storage 服务端口（默认为 23000）</span></span>
<span class="line"><span style="color:#E06C75;">port</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">23000</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 数据和日志文件存储根目录</span></span>
<span class="line"><span style="color:#E06C75;">base_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">/home/fastdfs</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 存储路径，访问时路径为 M00</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># store_path1 则为 M01，以此递增到 M99（如果配置了多个存储目录的话，这里只指定 1 个）</span></span>
<span class="line"><span style="color:#E06C75;">store_path0</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">/home/fastdfs</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Tracker 服务器 IP 地址和端口，单机搭建时也不要写 127.0.0.1</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># tracker_server 可以多次出现，如果有多个，则配置多个</span></span>
<span class="line"><span style="color:#E06C75;">tracker_server</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">192.168.1.20:22122</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-3-修改-client-conf" tabindex="-1"><a class="header-anchor" href="#_2-2-3-修改-client-conf"><span>2.2.3 修改 <code>client.conf</code></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 存储日志文件的基本路径</span></span>
<span class="line"><span style="color:#E06C75;">base_path</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">/home/fastdfs</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Tracker 服务器 IP 地址与端口号</span></span>
<span class="line"><span style="color:#E06C75;">tracker_server</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">192.168.1.20:22122</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-修改-mod-fastdfs-conf" tabindex="-1"><a class="header-anchor" href="#_2-2-4-修改-mod-fastdfs-conf"><span>2.2.4 修改 <code>mod_fastdfs.conf</code></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Tracker 服务器IP和端口修改</span></span>
<span class="line"><span style="color:#E06C75;">tracker_server</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">192.168.1.20:22122</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># url 中是否包含 group 名称，改为 true，包含 group</span></span>
<span class="line"><span style="color:#61AFEF;">url_have_group_name</span><span style="color:#98C379;"> =</span><span style="color:#D19A66;"> true</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 配置 Storage 信息，修改 store_path0 的信息</span></span>
<span class="line"><span style="color:#E06C75;">store_path0</span><span style="color:#56B6C2;">=</span><span style="color:#98C379;">/home/fastdfs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-5-修改-nginx-conf" tabindex="-1"><a class="header-anchor" href="#_2-2-5-修改-nginx-conf"><span>2.2.5 修改 <code>nginx.conf</code></span></a></h4><p>新增 8888 端口 server 节点，如图所示：</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" data-title="nginx" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">server</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    listen </span><span style="color:#D19A66;">      8888</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">    server_name </span><span style="color:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">    location</span><span style="color:#ABB2BF;"> ~/group[0-9]/M[0-9][0-9]/ {</span></span>
<span class="line"><span style="color:#ABB2BF;">        ngx_fastdfs_module;</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>说明：</p><ul><li><p><strong><code>server</code> 块</strong>：定义了一个服务器块，用于配置一个特定端口上的虚拟主机。</p><ul><li><strong><code>listen 8888;</code></strong>：指定 Nginx 监听的端口号为 8888。</li><li><strong><code>server_name localhost;</code></strong>：定义该服务器的名称为 <code>localhost</code>，即本地主机。</li></ul><p><strong><code>location</code> 块</strong>：用于匹配特定的 URL 路径，并应用相应的处理规则。</p><ul><li><strong><code>location ~/group[0-9]/M[0-9][0-9]/</code></strong>：这是一个正则表达式路径，匹配以 <code>/group</code> 开头、后面紧接着一个数字（0-9）、然后是 <code>/M</code> 和两个数字（0-9）的路径。这种路径格式通常用于 FastDFS 分布式文件系统中的文件分组存储结构。</li><li><strong><code>ngx_fastdfs_module;</code></strong>：这一行调用了 <code>ngx_fastdfs_module</code> 模块，表示使用该模块处理匹配到的请求。这个模块用于将 Nginx 与 FastDFS 文件存储系统集成，以便直接从 Nginx 服务器中访问 FastDFS 上的文件。</li></ul></li></ul></blockquote><h2 id="_3-编写-dockerfile脚本和启动脚本" tabindex="-1"><a class="header-anchor" href="#_3-编写-dockerfile脚本和启动脚本"><span>3. 编写 Dockerfile脚本和启动脚本</span></a></h2><p>由于 Centos 已停止更新维护。推荐使用 <strong>Rockylinux</strong> 和 <strong>Ubuntu</strong> 进行构建</p><h3 id="_3-1-基于centos-7基础镜像构建" tabindex="-1"><a class="header-anchor" href="#_3-1-基于centos-7基础镜像构建"><span>3.1 基于<code>centos:7</code>基础镜像构建</span></a></h3><p>直接在终端输入下面指令，快速创建 <code>Dockerfile</code> 文件：</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">cat &lt;&lt; </span><span style="color:#98C379;">&#39;EOF&#39;</span><span style="color:#ABB2BF;"> &gt; Dockerfile</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 基础镜像</span></span>
<span class="line"><span style="color:#61AFEF;">FROM</span><span style="color:#ABB2BF;"> centos:7</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加配置文件</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/storage.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/tracker.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/client.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/nginx.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/mod_fastdfs.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/http.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/mime.types /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs.sh /usr/bin/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 源文件版本号</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> LIB_VERSION=1.0.75</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> LIBSERVER_VERSION=1.2.5</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> FDFS_VERSION=6.12.2</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> FDFS_NGX_VERSION=1.24</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> NGX_VERSION=1.26.2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加源文件</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> libfastcommon-\${LIB_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> libserverframe-\${LIBSERVER_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs-\${FDFS_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs-nginx-module-\${FDFS_NGX_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> nginx-\${NGX_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 构建镜像时运行的指令</span></span>
<span class="line"><span style="color:#61AFEF;">RUN</span><span style="color:#ABB2BF;"> mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; yum install -y gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; mkdir -p /home/fastdfs/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd /usr/local/src/libfastcommon-\${LIB_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\ </span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../libserverframe-\${LIBSERVER_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh clean &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../fastdfs-\${FDFS_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../nginx-\${NGX_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./configure --add-module=/usr/local/src/fastdfs-nginx-module-\${FDFS_NGX_VERSION}/src \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; make &amp;&amp; make install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; chmod +x /usr/bin/fastdfs.sh \\</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #构建完成后清除相关软件包，减少镜像体积</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; rm -rf /usr/local/src/* \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; yum remove -y gcc gcc-c++ make automake libtool \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 允许外部数据挂载到该目录，容器启动时未指定数据卷，会自动挂载到匿名卷,</span></span>
<span class="line"><span style="color:#61AFEF;">VOLUME</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;/etc/fdfs&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 声明端口, 容器启动时如果使用随机端口映射会自动映射以下端口</span></span>
<span class="line"><span style="color:#61AFEF;">EXPOSE</span><span style="color:#ABB2BF;"> 22122 23000 8888</span></span>
<span class="line"><span style="color:#61AFEF;">ENTRYPOINT</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;/usr/bin/fastdfs.sh&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-基于rockylinux-9-基础镜像构建" tabindex="-1"><a class="header-anchor" href="#_3-2-基于rockylinux-9-基础镜像构建"><span>3.2 基于<code>RockyLinux 9 </code>基础镜像构建</span></a></h3><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">cat &lt;&lt; </span><span style="color:#98C379;">&#39;EOF&#39;</span><span style="color:#ABB2BF;"> &gt; Dockerfile</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 基础镜像</span></span>
<span class="line"><span style="color:#61AFEF;">FROM</span><span style="color:#ABB2BF;"> rockylinux:9</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加配置文件</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/storage.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/tracker.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/client.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/nginx.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/mod_fastdfs.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/http.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/mime.types /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs.sh /usr/bin/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 源文件版本号</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> LIB_VERSION=1.0.75</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> LIBSERVER_VERSION=1.2.5</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> FDFS_VERSION=6.12.2</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> FDFS_NGX_VERSION=1.24</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> NGX_VERSION=1.26.2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加源文件</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> libfastcommon-\${LIB_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> libserverframe-\${LIBSERVER_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs-\${FDFS_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs-nginx-module-\${FDFS_NGX_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> nginx-\${NGX_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 构建镜像时运行的指令</span></span>
<span class="line"><span style="color:#61AFEF;">RUN</span><span style="color:#ABB2BF;"> yum install -y gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; mkdir -p /home/fastdfs/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd /usr/local/src/libfastcommon-\${LIB_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\ </span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../libserverframe-\${LIBSERVER_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh clean &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../fastdfs-\${FDFS_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../nginx-\${NGX_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./configure --add-module=/usr/local/src/fastdfs-nginx-module-\${FDFS_NGX_VERSION}/src \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; make &amp;&amp; make install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; chmod +x /usr/bin/fastdfs.sh \\</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #构建完成后清除相关软件包，减少镜像体积</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; rm -rf /usr/local/src/* \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; yum remove -y gcc gcc-c++ make automake libtool \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; yum clean all</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 允许外部数据挂载到该目录，容器启动时未指定数据卷，会自动挂载到匿名卷,</span></span>
<span class="line"><span style="color:#61AFEF;">VOLUME</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;/etc/fdfs&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 声明端口, 容器启动时如果使用随机端口映射会自动映射以下端口</span></span>
<span class="line"><span style="color:#61AFEF;">EXPOSE</span><span style="color:#ABB2BF;"> 22122 23000 8888</span></span>
<span class="line"><span style="color:#61AFEF;">ENTRYPOINT</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;/usr/bin/fastdfs.sh&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-基于ubuntu-24-04-lts-基础镜像构建" tabindex="-1"><a class="header-anchor" href="#_3-3-基于ubuntu-24-04-lts-基础镜像构建"><span>3.3 基于<code>Ubuntu 24.04 LTS</code> 基础镜像构建</span></a></h3><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">cat &lt;&lt; </span><span style="color:#98C379;">&#39;EOF&#39;</span><span style="color:#ABB2BF;"> &gt; Dockerfile</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 基础镜像</span></span>
<span class="line"><span style="color:#61AFEF;">FROM</span><span style="color:#ABB2BF;"> ubuntu:24.04</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加配置文件</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/storage.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/tracker.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/client.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/nginx.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/mod_fastdfs.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/http.conf /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> conf/mime.types /etc/fdfs/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs.sh /usr/bin/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 源文件版本号</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> LIB_VERSION=1.0.75</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> LIBSERVER_VERSION=1.2.5</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> FDFS_VERSION=6.12.2</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> FDFS_NGX_VERSION=1.24</span></span>
<span class="line"><span style="color:#61AFEF;">ARG</span><span style="color:#ABB2BF;"> NGX_VERSION=1.26.2</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 添加源文件</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> libfastcommon-\${LIB_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> libserverframe-\${LIBSERVER_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs-\${FDFS_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> fastdfs-nginx-module-\${FDFS_NGX_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#61AFEF;">ADD</span><span style="color:#ABB2BF;"> nginx-\${NGX_VERSION}.tar.gz /usr/local/src/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 构建镜像时运行的指令</span></span>
<span class="line"><span style="color:#61AFEF;">RUN</span><span style="color:#ABB2BF;"> sed -i </span><span style="color:#98C379;">&#39;s/archive.ubuntu.com/mirrors.aliyun.com/g&#39;</span><span style="color:#ABB2BF;"> /etc/apt/sources.list \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; sed -i </span><span style="color:#98C379;">&#39;s/security.ubuntu.com/mirrors.aliyun.com/g&#39;</span><span style="color:#ABB2BF;"> /etc/apt/sources.list \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; apt-get update \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; apt-get install -y build-essential libxml2 libxml2-dev libxslt-dev openssl libpcre3 libpcre3-dev libgeoip-dev libgd-dev \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; mkdir -p /home/fastdfs/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd /usr/local/src/libfastcommon-\${LIB_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\ </span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../libserverframe-\${LIBSERVER_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh clean &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../fastdfs-\${FDFS_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./make.sh &amp;&amp; ./make.sh install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; cd ../nginx-\${NGX_VERSION}/ \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; ./configure --add-module=/usr/local/src/fastdfs-nginx-module-\${FDFS_NGX_VERSION}/src \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; make &amp;&amp; make install \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; chmod +x /usr/bin/fastdfs.sh \\</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #构建完成后清除相关软件包，减少镜像体积</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp; rm -rf /usr/local/src/* \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  cd / \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  apt-get remove -y build-essential \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  apt-get autoremove -y \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  apt-get clean \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  rm -rf /var/lib/apt/lists/* \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  rm -rf /usr/local/src/* \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  rm -rf /tmp/* \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  rm -rf /var/tmp/* \\</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 清理编译过程中产生的临时文件</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  find /usr/local -type f -name </span><span style="color:#98C379;">&#39;*.a&#39;</span><span style="color:#ABB2BF;"> -delete \\</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  find /usr/local -type f -name </span><span style="color:#98C379;">&#39;*.la&#39;</span><span style="color:#ABB2BF;"> -delete \\</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # 清理日志文件</span></span>
<span class="line"><span style="color:#ABB2BF;">  &amp;&amp;  find /var/log -type f -delete</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 允许外部数据挂载到该目录，容器启动时未指定数据卷，会自动挂载到匿名卷,</span></span>
<span class="line"><span style="color:#61AFEF;">VOLUME</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;/etc/fdfs&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 声明端口, 容器启动时如果使用随机端口映射会自动映射以下端口</span></span>
<span class="line"><span style="color:#61AFEF;">EXPOSE</span><span style="color:#ABB2BF;"> 22122 23000 8888</span></span>
<span class="line"><span style="color:#61AFEF;">ENTRYPOINT</span><span style="color:#ABB2BF;"> [</span><span style="color:#98C379;">&quot;/usr/bin/fastdfs.sh&quot;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-创建-fastdfs-sh-启动脚本" tabindex="-1"><a class="header-anchor" href="#_3-4-创建-fastdfs-sh-启动脚本"><span>3.4 创建 <code>fastdfs.sh</code> 启动脚本</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">cat</span><span style="color:#ABB2BF;"> &lt;&lt; </span><span style="color:#ABB2BF;">&#39;EOF&#39;</span><span style="color:#ABB2BF;"> &gt; </span><span style="color:#98C379;">fastdfs.sh</span></span>
<span class="line"><span style="color:#98C379;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">new_val=\\$FASTDFS_IPADDR</span></span>
<span class="line"><span style="color:#98C379;">old=&quot;192.168.1.20&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">sed -i &quot;s/\\$old/\\$new_val/g&quot; /etc/fdfs/client.conf</span></span>
<span class="line"><span style="color:#98C379;">sed -i &quot;s/\\$old/\\$new_val/g&quot; /etc/fdfs/storage.conf</span></span>
<span class="line"><span style="color:#98C379;">sed -i &quot;s/\\$old/\\$new_val/g&quot; /etc/fdfs/mod_fastdfs.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">:&lt;&lt;!</span></span>
<span class="line"><span style="color:#98C379;">cat /etc/fdfs/client.conf &gt; /etc/fdfs/client.conf.bak</span></span>
<span class="line"><span style="color:#98C379;">cat /etc/fdfs/storage.conf &gt; /etc/fdfs/storage.conf.bak</span></span>
<span class="line"><span style="color:#98C379;">cat /etc/fdfs/mod_fastdfs.conf &gt; /etc/fdfs/mod_fastdfs.conf.bak</span></span>
<span class="line"><span style="color:#98C379;">mv /usr/local/nginx/conf/nginx.conf /usr/local/nginx/conf/nginx.conf.bak</span></span>
<span class="line"><span style="color:#98C379;">!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">cp /etc/fdfs/nginx.conf /usr/local/nginx/conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">echo &quot;start trackerd&quot;</span></span>
<span class="line"><span style="color:#98C379;">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf start</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">echo &quot;start storage&quot;</span></span>
<span class="line"><span style="color:#98C379;">/usr/bin/fdfs_storaged /etc/fdfs/storage.conf start</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">echo &quot;start nginx&quot;</span></span>
<span class="line"><span style="color:#98C379;">/usr/local/nginx/sbin/nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">:&lt;&lt;!</span></span>
<span class="line"><span style="color:#98C379;">echo &quot;fdfs monitor&quot;</span></span>
<span class="line"><span style="color:#98C379;">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</span></span>
<span class="line"><span style="color:#98C379;">!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">tail -f /dev/null</span></span>
<span class="line"><span style="color:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-根据dockerfile构建fastdfs-镜像" tabindex="-1"><a class="header-anchor" href="#_4-根据dockerfile构建fastdfs-镜像"><span>4. 根据<code>Dockerfile</code>构建<code>fastdfs</code> 镜像</span></a></h2><h3 id="_4-1-首先准备好相关文件" tabindex="-1"><a class="header-anchor" href="#_4-1-首先准备好相关文件"><span>4.1 首先准备好相关文件</span></a></h3><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241029164035534.png" alt="image-20241029164035534" tabindex="0" loading="lazy"><figcaption>image-20241029164035534</figcaption></figure><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 下载基础镜像，推荐 rocky 和 ubuntu</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> pull</span><span style="color:#98C379;"> centos:7</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> pull</span><span style="color:#98C379;"> rockylinux:9</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> pull</span><span style="color:#98C379;"> ubuntu:24.04</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 打开Dockerfile所在目录，构建fastdfs镜像</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> build</span><span style="color:#D19A66;"> -t</span><span style="color:#98C379;"> fastdfs:6.12.2</span><span style="color:#98C379;"> .</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-构建完成镜像后并使用" tabindex="-1"><a class="header-anchor" href="#_4-2-构建完成镜像后并使用"><span>4.2 构建完成镜像后并使用</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 创建目录，用于挂载配置文件和数据</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> mkdir</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> /opt/docker/fastdfs/conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 启动命令</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> run</span><span style="color:#D19A66;"> -itd</span><span style="color:#D19A66;"> --restart=unless-stopped</span><span style="color:#D19A66;"> --name</span><span style="color:#98C379;"> fastdfs-centos</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-p </span><span style="color:#98C379;">22122:22122</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> 23000:23000</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> 8888:80</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-v </span><span style="color:#98C379;">/opt/docker/fastdfs:/home/fastdfs</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-v </span><span style="color:#98C379;">/opt/docker/fastdfs/conf:/etc/fdfs</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-e </span><span style="color:#98C379;">FASTDFS_IPADDR=</span><span style="color:#D19A66;">192.168.1.20</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">fastdfs:6.12.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果要外部主机可以上传文件，要改用宿主机网络</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> run</span><span style="color:#D19A66;"> -itd</span><span style="color:#D19A66;"> --restart=unless-stopped</span><span style="color:#D19A66;"> --name=fastdfs</span><span style="color:#D19A66;"> --net=host</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-v </span><span style="color:#98C379;">/opt/docker/fastdfs:/home/fastdfs</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-v </span><span style="color:#98C379;">/opt/docker/fastdfs/conf:/etc/fdfs/</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">-e </span><span style="color:#98C379;">FASTDFS_IPADDR=</span><span style="color:#D19A66;">192.168.1.20</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#ABB2BF;">fastdfs:6.12.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 根据容器名快速删除相关容器</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> stop</span><span style="color:#ABB2BF;"> $(</span><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> ps</span><span style="color:#D19A66;"> -q</span><span style="color:#D19A66;"> --filter</span><span style="color:#98C379;"> &quot;name=fastdfs&quot;</span><span style="color:#ABB2BF;">) &amp;&amp; </span><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> rm</span><span style="color:#ABB2BF;"> $(</span><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> ps</span><span style="color:#D19A66;"> -a</span><span style="color:#D19A66;"> -q</span><span style="color:#D19A66;"> --filter</span><span style="color:#98C379;"> &quot;name=fastdfs&quot;</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container caution"><p class="hint-container-title">注意</p><p>如果是使用打包好的镜像，则需要先将镜像包上传至服务器，然后导入镜像</p><p>$ docker load -i /opt/docker/fastdfs-docker-image-6.12.2.tar.gz</p></div><h3 id="_4-3-校验容器状态并测试上传" tabindex="-1"><a class="header-anchor" href="#_4-3-校验容器状态并测试上传"><span>4.3 校验容器状态并测试上传</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 进入容器</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#98C379;"> fastdfs</span><span style="color:#98C379;"> /bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 使用monitor查看tracker和storage服务状态</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> /usr/bin/fdfs_monitor</span><span style="color:#98C379;"> /etc/fdfs/storage.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果只是查看状态，可以不进入容器</span></span>
<span class="line"><span style="color:#61AFEF;">$</span><span style="color:#98C379;"> docker</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -i</span><span style="color:#98C379;"> fastdfs</span><span style="color:#98C379;"> /usr/bin/fdfs_monitor</span><span style="color:#98C379;"> /etc/fdfs/storage.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如图如果显示ACTIVE，则表示服务正常启动。</p><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241029164859685.png" alt="image-20241029164859685" tabindex="0" loading="lazy"><figcaption>image-20241029164859685</figcaption></figure><p>往宿主机与容器共享的目录下方一图照片,进入容器使用上传命令上传图片。</p><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241029171835246.png" alt="image-20241029171835246" tabindex="0" loading="lazy"><figcaption>image-20241029171835246</figcaption></figure><p>根据上传返回的路径进行访问：</p><figure><img src="https://lixuanfengs.github.io/blog-images/vp/web/image-20241029172044147.png" alt="image-20241029172044147" tabindex="0" loading="lazy"><figcaption>image-20241029172044147</figcaption></figure><p><strong>至此使用Docker构建 fastdfs容器测试完毕！</strong></p>`,49)]))}const t=n(p,[["render",i],["__file","Docker快速构建fastdfs镜像.html.vue"]]),r=JSON.parse(`{"path":"/linuxs/Docker/Docker%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BAfastdfs%E9%95%9C%E5%83%8F.html","title":"Docker快速构建fastdfs镜像","lang":"zh-CN","frontmatter":{"title":"Docker快速构建fastdfs镜像","subtitle":"Docker快速构建fastdfs镜像","date":"2024-10-25T10:41:26.000Z","category":["Docker"],"tag":["fastdfs"],"order":3,"description":"1. 安装fastdfs所需文件 Linux 中下载文件命令： 2. 提取并修改相关配置文件 2.1 提取文件 解压 fastdfs-6.12.2.tar.gz 源码包，找到http.conf、mime.types、storage_ids.conf, storage_ids.conf文件只是用于构建好的镜像使用时挂载目录到容器内。 image-2024...","head":[["meta",{"property":"og:url","content":"https://cactusli.net/linuxs/Docker/Docker%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BAfastdfs%E9%95%9C%E5%83%8F.html"}],["meta",{"property":"og:site_name","content":"Cactus's Blog"}],["meta",{"property":"og:title","content":"Docker快速构建fastdfs镜像"}],["meta",{"property":"og:description","content":"1. 安装fastdfs所需文件 Linux 中下载文件命令： 2. 提取并修改相关配置文件 2.1 提取文件 解压 fastdfs-6.12.2.tar.gz 源码包，找到http.conf、mime.types、storage_ids.conf, storage_ids.conf文件只是用于构建好的镜像使用时挂载目录到容器内。 image-2024..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://lixuanfengs.github.io/blog-images/vp/web/image-20241025112101573.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-29T09:45:24.000Z"}],["meta",{"property":"article:tag","content":"fastdfs"}],["meta",{"property":"article:published_time","content":"2024-10-25T10:41:26.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-29T09:45:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker快速构建fastdfs镜像\\",\\"image\\":[\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241025112101573.png\\",\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241025161438574.png\\",\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241025161709574.png\\",\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241029164035534.png\\",\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241029164859685.png\\",\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241029171835246.png\\",\\"https://lixuanfengs.github.io/blog-images/vp/web/image-20241029172044147.png\\"],\\"datePublished\\":\\"2024-10-25T10:41:26.000Z\\",\\"dateModified\\":\\"2024-10-29T09:45:24.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Cactus li\\",\\"url\\":\\"https://cactusli.net\\"}]}"]]},"headers":[{"level":2,"title":"1. 安装fastdfs所需文件","slug":"_1-安装fastdfs所需文件","link":"#_1-安装fastdfs所需文件","children":[]},{"level":2,"title":"2. 提取并修改相关配置文件","slug":"_2-提取并修改相关配置文件","link":"#_2-提取并修改相关配置文件","children":[{"level":3,"title":"2.1 提取文件","slug":"_2-1-提取文件","link":"#_2-1-提取文件","children":[]},{"level":3,"title":"2.2 改相关配置文件","slug":"_2-2-改相关配置文件","link":"#_2-2-改相关配置文件","children":[]}]},{"level":2,"title":"3. 编写 Dockerfile脚本和启动脚本","slug":"_3-编写-dockerfile脚本和启动脚本","link":"#_3-编写-dockerfile脚本和启动脚本","children":[{"level":3,"title":"3.1 基于centos:7基础镜像构建","slug":"_3-1-基于centos-7基础镜像构建","link":"#_3-1-基于centos-7基础镜像构建","children":[]},{"level":3,"title":"3.2 基于RockyLinux 9 基础镜像构建","slug":"_3-2-基于rockylinux-9-基础镜像构建","link":"#_3-2-基于rockylinux-9-基础镜像构建","children":[]},{"level":3,"title":"3.3 基于Ubuntu 24.04 LTS 基础镜像构建","slug":"_3-3-基于ubuntu-24-04-lts-基础镜像构建","link":"#_3-3-基于ubuntu-24-04-lts-基础镜像构建","children":[]},{"level":3,"title":"3.4 创建 fastdfs.sh 启动脚本","slug":"_3-4-创建-fastdfs-sh-启动脚本","link":"#_3-4-创建-fastdfs-sh-启动脚本","children":[]}]},{"level":2,"title":"4. 根据Dockerfile构建fastdfs 镜像","slug":"_4-根据dockerfile构建fastdfs-镜像","link":"#_4-根据dockerfile构建fastdfs-镜像","children":[{"level":3,"title":"4.1 首先准备好相关文件","slug":"_4-1-首先准备好相关文件","link":"#_4-1-首先准备好相关文件","children":[]},{"level":3,"title":"4.2 构建完成镜像后并使用","slug":"_4-2-构建完成镜像后并使用","link":"#_4-2-构建完成镜像后并使用","children":[]},{"level":3,"title":"4.3 校验容器状态并测试上传","slug":"_4-3-校验容器状态并测试上传","link":"#_4-3-校验容器状态并测试上传","children":[]}]}],"git":{"createdTime":1730195124000,"updatedTime":1730195124000,"contributors":[{"name":"lixuanfengs","email":"1183895890@qq.com","commits":1}]},"readingTime":{"minutes":7.79,"words":2336},"filePathRelative":"linuxs/Docker/Docker快速构建fastdfs镜像.md","localizedDate":"2024年10月25日","excerpt":"<h2>1. 安装fastdfs所需文件</h2>\\n<table>\\n<thead>\\n<tr>\\n<th>文件名</th>\\n<th>文件说明</th>\\n<th>本次安装版本</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><a href=\\"https://github.com/happyfish100/libfastcommon\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">libfastcommon</a></td>\\n<td>从 FastDFS 和 FastDHT 中提取出来的公共 C 函数库</td>\\n<td><a href=\\"https://github.com/happyfish100/libfastcommon/archive/refs/tags/V1.0.75.tar.gz\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">V1.0.75</a></td>\\n</tr>\\n<tr>\\n<td><a href=\\"https://github.com/happyfish100/libserverframe\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">libserverframe</a></td>\\n<td>从 FastDFS 中提取的网络服务框架库</td>\\n<td><a href=\\"https://github.com/happyfish100/libserverframe/releases/tag/V1.2.5\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">V1.2.5</a></td>\\n</tr>\\n<tr>\\n<td><a href=\\"https://github.com/happyfish100/fastdfs\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">fastdfs</a></td>\\n<td>FastDFS 源码，包含 tracker 和 storage 服务</td>\\n<td><a href=\\"https://github.com/happyfish100/fastdfs/archive/refs/tags/V6.12.2.tar.gz\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">V6.12.2</a></td>\\n</tr>\\n<tr>\\n<td><a href=\\"https://github.com/happyfish100/fastdfs-nginx-module\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">fastdfs-nginx-module</a></td>\\n<td>FastDFS 与 Nginx 关联模块，实现访问和下载文件</td>\\n<td><a href=\\"https://github.com/happyfish100/fastdfs-nginx-module/archive/refs/tags/V1.24.tar.gz\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">V1.24</a></td>\\n</tr>\\n<tr>\\n<td><a href=\\"http://nginx.org/en/download.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">nginx</a></td>\\n<td>使文件能够通过http访问</td>\\n<td><a href=\\"http://nginx.org/download/nginx-1.26.2.tar.gz\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">1.22.0</a></td>\\n</tr>\\n</tbody>\\n</table>","autoDesc":true}`);export{t as comp,r as data};
