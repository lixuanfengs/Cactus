import{_ as i,c as a,a as n,o as l}from"./app-BcTj92Yq.js";const e={};function h(k,s){return l(),a("div",null,[...s[0]||(s[0]=[n(`<h2 id="ä¸€ã€éƒ¨ç½²è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€éƒ¨ç½²è¯´æ˜"><span>ä¸€ã€éƒ¨ç½²è¯´æ˜</span></a></h2><p>æœ¬ç« ä»¥åŠä»¥æœ€ç®€å•çš„æ–¹å¼é…ç½®ä½¿ç”¨ Jenkins å®Œæˆ <code>Spring Boot</code>ã€<code>Vue</code>é¡¹ç›®çš„éƒ¨ç½²ï¼Œæ•´ä¸ªéƒ¨ç½²æ“ä½œæµç¨‹å¦‚ä¸‹ï¼›</p><figure><img src="https://beauties.eu.org/blogimg/main/img1/Jenkins1.drawio.png" alt="Jenkins1.drawio" tabindex="0" loading="lazy"><figcaption>Jenkins1.drawio</figcaption></figure><ul><li>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯æ•´ä¸ªé¡¹ç›®å‘å¸ƒçš„é…ç½®æµç¨‹ï¼Œå³è¾¹æ˜¯é…ç½®è¿‡ç¨‹ä¸­çš„ç»†èŠ‚ã€‚</li><li>å°†æœ¬åœ°å¯¹é¡¹ç›®æ‰“åŒ…éƒ¨ç½²çš„è¿‡ç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸ªæ¨¡å—ï¼Œåœ¨é…ç½®åˆ° <code>Jenkins</code> ç¯å¢ƒä¸­ï¼Œè¿™å°±æ˜¯ Jenkins çš„ä½œç”¨ã€‚</li></ul><h2 id="äºŒã€ç¯å¢ƒé…ç½®" tabindex="-1"><a class="header-anchor" href="#äºŒã€ç¯å¢ƒé…ç½®"><span>äºŒã€ç¯å¢ƒé…ç½®</span></a></h2><p>ç¡®ä¿æœåŠ¡å™¨ä¸Šå®‰è£…é…ç½®äº† Docker ç¯å¢ƒï¼Œå¹¶å®‰è£…äº† docker-composeï¼Œåœ¨é…ç½®åç»­çš„ç¯å¢ƒä¸­å¯èƒ½ä¼šéœ€è¦å¼€æ”¾ç«¯å£ï¼Œå¦‚ï¼š<code>Jenkins - 9090</code>ã€<code>8091 - lxf-dev-tech-app</code> æœåŠ¡ã€‚</p><h3 id="_1-jenkins-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#_1-jenkins-éƒ¨ç½²"><span>1. Jenkins éƒ¨ç½²</span></a></h3><h4 id="_1-1-ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#_1-1-ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨"><span>1.1 ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</span></a></h4><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515143822929.png" alt="image-20250515143822929" tabindex="0" loading="lazy"><figcaption>image-20250515143822929</figcaption></figure><ul><li>å¦‚å›¾ï¼›ä»¥ä¸Šé…ç½®å†…å®¹å·²ç»æ”¾åˆ° <a href="https://github.com/lixuanfengs/lxf-dev-tech/tree/main/lxf-dev-tech-jenkins/lxf-dev-tech-jenkins-app/docs/dev-ops" target="_blank" rel="noopener noreferrer">lxf-dev-tech-jenkins </a>å·¥ç¨‹ä¸­ï¼Œå¦‚æœä½ æ˜¯äº‘æœåŠ¡å™¨éƒ¨ç½²åˆ™éœ€è¦å°† dev-ops éƒ¨åˆ†å…¨éƒ¨ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ ¹ç›®å½•ä¸‹ã€‚</li><li><a href="http://compose-down.sh" target="_blank" rel="noopener noreferrer">compose-down.sh</a> æ˜¯ <code>docker-compose </code>ä¸‹è½½æ–‡ä»¶ï¼Œåªæœ‰ä½ å®‰è£…äº† docker-compose æ‰èƒ½æ‰§è¡Œ <code>docker-compose -f docker-compose-v1.0.yml up -d</code>ã€‚</li><li><a href="http://jdk-down.sh" target="_blank" rel="noopener noreferrer">jdk-down.sh</a> æ˜¯ jdk17ä¸‹è½½è·¯å¾„ï¼Œä»¥åŠè§£å‹è„šæœ¬ã€‚</li><li>maven ä¸‹çš„ settings.xml é…ç½®ï¼Œé»˜è®¤é…ç½®äº†é˜¿é‡Œäº‘é•œåƒæ–‡ä»¶ï¼Œæ–¹ä¾¿åœ¨ Jenkins æ„å»ºé¡¹ç›®æ—¶ï¼Œå¯ä»¥å¿«é€Ÿåœ°æ‹‰å–ä¸‹è½½ä¸‹æ¥åŒ…ã€‚</li></ul><h4 id="_1-2-éƒ¨ç½²è„šæœ¬è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_1-2-éƒ¨ç½²è„šæœ¬è¯´æ˜"><span>1.2 éƒ¨ç½²è„šæœ¬è¯´æ˜</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3.9&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‰§è¡Œè„šæœ¬ï¼›docker-compose -f docker-compose-v1.0.yml up -d</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  jenkins</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">jenkins/jenkins:2.510</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">jenkins</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    privileged</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;9090:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;50001:50000&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/localtime:/etc/localtime:ro</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #:ro ä»¥åªè¯»æ–¹å¼æŒ‚è½½ï¼Œé˜²æ­¢å®¹å™¨æ›´æ”¹å®¿ä¸»æœºæ—¶é—´ã€‚</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  	  - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/timezone:/etc/timezone:ro</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./jenkins_home:/var/jenkins_home</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/run/docker.sock:/var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/usr/bin/docker:/usr/local/bin/docker</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./maven/conf/settings.xml:/usr/local/maven/conf/settings.xml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">./maven/apache-maven-3.9.9:/usr/local/maven/apache-maven-3.9.9</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #      - /dev-ops/jdk/jdk-17.0.15:/usr/local/jdk-17.0.15</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">JAVA_OPTS=-Djenkins.install.runSetupWizard=false</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # ç¦æ­¢å®‰è£…å‘å¯¼ã€Œå¦‚æœéœ€è¦å¯†ç åˆ™ä¸è¦é…ç½®ã€docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">unless-stopped</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  jenkins_home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>/etc/localtime</code> åŒ…å«å½“å‰æ—¶åŒºçš„å…·ä½“æ—¶é—´æ•°æ®ï¼›</li><li><code>/etc/timezone</code> éƒ¨åˆ†å‘è¡Œç‰ˆï¼ˆå¦‚ Debian/Ubuntuï¼‰ç”¨æ¥è®¾ç½®ç³»ç»Ÿæ—¶åŒºï¼›</li><li><code>./jenkins_home:/var/jenkins_home</code> æŠŠ Jenkins çš„å·¥ä½œç›®å½•ï¼ˆæ’ä»¶ã€ä½œä¸šé…ç½®ã€ç³»ç»Ÿè®¾ç½®ç­‰ï¼‰æ°¸ä¹…ä¿å­˜åˆ°å®¿ä¸»æœºçš„ <code>jenkins_home</code> æ–‡ä»¶å¤¹ã€‚å®¹å™¨åˆ æ‰åæ•°æ®ä»åœ¨ï¼Œä¸‹ä¸€æ¬¡ <code>docker-compose up</code> ä¼šè‡ªåŠ¨å¤ç”¨ã€‚</li></ul><ul><li><code>/var/run/docker.sock:/var/run/docker.sock</code> æŠŠå®¿ä¸»æœº Docker daemon çš„ Unix Socket æš´éœ²ç»™å®¹å™¨ã€‚è¿™æ · Jenkins é‡Œè¿è¡Œçš„ Job å¯ä»¥ç›´æ¥è°ƒç”¨å®¿ä¸»æœº Dockerï¼ˆä¾‹å¦‚æµæ°´çº¿é‡Œæ‰§è¡Œ <code>docker build</code>ã€<code>docker push</code>ï¼‰ã€‚</li><li><code>/usr/bin/docker:/usr/local/bin/docker</code> æŠŠå®¿ä¸»æœºçš„ Docker CLIï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰æ”¾è¿›å®¹å™¨ï¼Œè®© Jenkins æ‹¥æœ‰ <code>docker</code> å‘½ä»¤ã€‚é€šå¸¸ä¸ä¸Šä¸€è¡Œçš„ sock ä¸€èµ·ä½¿ç”¨ã€‚</li><li><code>/dev-ops/maven/conf/settings.xml:/usr/local/maven/conf/settings.xml</code> æŠŠå®¿ä¸»æœºè‡ªå®šä¹‰çš„ Maven <code>settings.xml</code> æ”¾åˆ°å®¹å™¨é‡Œï¼Œç»Ÿä¸€ä»“åº“é•œåƒã€ç§æœè®¤è¯ç­‰é…ç½®ã€‚</li><li><code>/dev-ops/maven/apache-maven-3.9.9:/usr/local/maven/apache-maven-3.9.9</code> æŠŠä¸€æ•´å¥— Maven å‘è¡Œç‰ˆæŒ‚è¿›å®¹å™¨ï¼Œçœå»æ¯æ¬¡å¯åŠ¨éƒ½ä¸‹è½½ Maven çš„æ—¶é—´ï¼Œå¹¶ç¡®ä¿ç‰ˆæœ¬ä¸€è‡´ã€‚</li><li><code>/dev-ops/jdk/jdk-17.0.15:/usr/local/jdk-17.0.15</code>å¦‚æœéœ€è¦ä¹Ÿå¯å°†å®¿ä¸» JDK æŒ‚è¿›æ¥ï¼Œé¿å…é•œåƒé‡Œé¢å¤–å®‰è£…ã€‚</li><li><code>TZ=Asia/Shanghai</code> è¿™ç§æ–¹å¼åªå½±å“å®¹å™¨å†…ç¨‹åºçš„â€œæ—¶åŒºæ˜¾ç¤ºâ€ï¼Œä¸ä¿è¯æ—¶é—´ä¸å®¿ä¸»æœºå®Œå…¨ä¸€è‡´ï¼Œä¸”ä¸ä¼šå½±å“ç³»ç»Ÿæ—¶é—´ã€‚</li><li><code>JAVA_OPTS=-Djenkins.install.runSetupWizard=false</code> è¿™ä¸ªæ˜¯ä¸€ä¸ªç¦æ­¢å®‰è£…å‘å¯¼ï¼Œé…ç½®ä¸º false åï¼Œåˆ™ Jenkins ä¸ä¼šè®©ä½ è®¾ç½®å¯†ç ï¼Œä¹Ÿä¸ä¼šä¸€å¼€å§‹å°±å®‰è£…ä¸€å †æ’ä»¶ã€‚å¦‚æœä½ éœ€è¦å®‰è£…å‘å¯¼å¯ä»¥æ³¨é‡Šæ‰è¿™ä¸ªé…ç½®ã€‚å¹¶ä¸”å½“æç¤ºä½ è·å–å¯†ç æ—¶ï¼Œä½ å¯ä»¥æ‰§è¡Œï¼›<code>docker exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword</code> è·å–åˆ°ç™»å½•å¯†ç </li></ul><h4 id="_1-3-æ‰§è¡Œå®‰è£…" tabindex="-1"><a class="header-anchor" href="#_1-3-æ‰§è¡Œå®‰è£…"><span>1.3 æ‰§è¡Œå®‰è£…</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@rag-host:/work/jenkins/dev-ops#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker-compose-v1.0.yml</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WARN[0000]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /work/jenkins/dev-ops/docker-compose-v1.0.yml:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> attribute</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> \`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> obsolete,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> will</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> be</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ignored,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> please</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> remove</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> avoid</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> potential</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> confusion</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[+] Running 13/13</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jenkins</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pulled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                                           85.1s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cf05a52c0235</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             30.0s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> abe2f5ac32ce</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             32.0s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cc732753ed96</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             32.1s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 297e5fa4eccf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             32.1s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 9ea3a959459c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             32.3s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4f6765be549b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             59.8s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> c8630c3fa134</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             59.8s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d9812bfb002c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             59.9s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> b4c1a8dd5baf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             81.6s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 58668c68a1a7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             81.6s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 028b908db677</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             81.9s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 7242411434e5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Pull</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> complete</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                             82.0s</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[+] Running 2/2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Network</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev-ops_default</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  Created</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                                                                                                                                          0.1s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> âœ”</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jenkins</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        Started</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œè„šæœ¬ <code>docker-compose -f docker-compose-v1.0.yml up -d</code> åï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸Šä»£è¡¨ Jenkins å®‰è£…æˆåŠŸâ€ï¼</p><h3 id="_2-æ’ä»¶å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_2-æ’ä»¶å®‰è£…"><span>2. æ’ä»¶å®‰è£…</span></a></h3><p>åœ°å€ï¼š[<a href="http://192.168.1.23:9090/" target="_blank" rel="noopener noreferrer">http://192.168.1.23:9090/</a> - <code>ç™»å½•Jenkins</code></p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515160829529.png" alt="image-20250515160829529" tabindex="0" loading="lazy"><figcaption>image-20250515160829529</figcaption></figure><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515161124841.png" alt="image-20250515161124841" tabindex="0" loading="lazy"><figcaption>image-20250515161124841</figcaption></figure><ul><li>1~2æ­¥ï¼Œè®¾ç½®é•œåƒæºï¼Œè®¾ç½®åé‡å¯ä¸€ä¸‹ Jenkinsã€‚ é•œåƒæºåœ°å€ï¼š<a href="https://eastamerica.cloudflare.jenkins.io/current/update-center.json" target="_blank" rel="noopener noreferrer">https://eastamerica.cloudflare.jenkins.io/current/update-center.json</a></li><li>3~4æ­¥ï¼Œä¸‹è½½æ’ä»¶ï¼Œå…ˆä¸‹è½½å®‰è£… chinese æ±‰åŒ–æ’ä»¶.</li><li>5æ­¥ï¼Œæ‰€æœ‰çš„æ’ä»¶å®‰è£…å®Œæˆåï¼Œéƒ½éœ€è¦é‡å¯æ‰ä¼šç”Ÿæ•ˆã€‚<code>å®‰è£…å®Œ chinese æ’ä»¶ï¼Œé‡å¯åœ¨è¿›å…¥åˆ° Jenkins å°±æ˜¯æ±‰åŒ–çš„é¡µé¢äº†</code></li><li>é™¤äº†ä»¥ä¸Šæ­¥éª¤ï¼Œè¿˜éœ€è¦åŒæ ·çš„æ–¹å¼å®‰è£… mavenã€gitã€docker æ’ä»¶ã€‚</li><li>æ³¨æ„ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜ä½ å¯ä»¥å†åšè¿‡ç¨‹ä¸­ï¼Œæç¤ºå¤±è´¥ã€‚æ²¡å…³ç³»ï¼Œä½ å¯ä»¥å†æœè¿™ä¸ªæ’ä»¶ï¼Œå†é‡æ–°ä¸‹è½½ã€‚å®ƒä¼šæŠŠå¤±è´¥çš„ç»§ç»­ä¸‹è½½ã€‚</li></ul><h3 id="_3-å…¨å±€å·¥å…·é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-å…¨å±€å·¥å…·é…ç½®"><span>3. å…¨å±€å·¥å…·é…ç½®</span></a></h3><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515164145512.png" alt="image-20250515164145512" tabindex="0" loading="lazy"><figcaption>image-20250515164145512</figcaption></figure><p>ç”¨äºæ„å»ºéƒ¨ç½²çš„ SpringBoot åº”ç”¨çš„ç¯å¢ƒï¼Œéƒ½éœ€è¦åœ¨å…¨å±€å·¥å…·ä¸­é…ç½®å¥½ã€‚åŒ…æ‹¬ï¼›Mavenã€JDKã€Gitã€Dockerã€‚</p><h3 id="_4-æ·»åŠ å‡­è¯" tabindex="-1"><a class="header-anchor" href="#_4-æ·»åŠ å‡­è¯"><span>4. æ·»åŠ å‡­è¯</span></a></h3><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515165434711.png" alt="image-20250515165434711" tabindex="0" loading="lazy"><figcaption>image-20250515165434711</figcaption></figure><ul><li>åªæœ‰é…ç½®äº† git ä»“åº“çš„è¿æ¥å‡­è¯ï¼Œæ‰èƒ½ä»Gitä»“åº“æ‹‰å–ä»£ç ã€‚</li><li>å¦‚æœä½ è¿˜éœ€è¦æ“ä½œå¦‚ ssh ä¹Ÿéœ€è¦é…ç½®å‡­è¯ã€‚</li></ul><h2 id="ä¸‰ã€æ–°å»ºä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ–°å»ºä»»åŠ¡"><span>ä¸‰ã€æ–°å»ºä»»åŠ¡</span></a></h2><p>ä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€æ¡æ„å»ºå‘å¸ƒéƒ¨ç½²é¡¹ç›®çš„æ“ä½œã€‚</p><h3 id="_1-é…ç½®ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#_1-é…ç½®ä»»åŠ¡"><span>1. é…ç½®ä»»åŠ¡</span></a></h3><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515170238346.png" alt="image-20250515170238346" tabindex="0" loading="lazy"><figcaption>image-20250515170238346</figcaption></figure><h3 id="_2-é…ç½®git" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®git"><span>2. é…ç½®Git</span></a></h3><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515173728453.png" alt="image-20250515173728453" tabindex="0" loading="lazy"><figcaption>image-20250515173728453</figcaption></figure><h3 id="_3-é…ç½®maven" tabindex="-1"><a class="header-anchor" href="#_3-é…ç½®maven"><span>3. é…ç½®Maven</span></a></h3><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515173912340.png" alt="image-20250515173912340" tabindex="0" loading="lazy"><figcaption>image-20250515173912340</figcaption></figure><ul><li><p>åœ¨é«˜çº§ä¸­è®¾ç½® Maven é…ç½®çš„è·¯å¾„ <code>/usr/local/maven/conf/settings.xml</code>ã€‚è¿™æ ·æ‰èƒ½èµ°è‡ªå·±é…ç½®çš„é˜¿é‡Œäº‘é•œåƒä»“åº“ã€‚</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">clean</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Dmaven.test.skip=true</span></span></code></pre></div></li></ul><h3 id="_3-é…ç½®shell" tabindex="-1"><a class="header-anchor" href="#_3-é…ç½®shell"><span>3. é…ç½®Shell</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å…ˆåˆ é™¤ä¹‹å‰çš„å®¹å™¨å’Œé•œåƒæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ps </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lxf-dev-tech-jenkins-app)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lxf-dev-tech-jenkins-app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lxf-dev-tech-jenkins-app</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> images </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-q</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lxf-dev-tech-jenkins-app)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rmi</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lxf-dev-tech-jenkins-app</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é‡æ–°ç”Ÿæˆ</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/jenkins_home/workspace/lxf-dev-tech-jenkins/lxf-dev-tech-jenkins-app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cactusli/lxf-dev-tech-jenkins-app</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -itd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8091:8091</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lxf-dev-tech-jenkins-app</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cactusli/lxf-dev-tech-jenkins-app</span></span></code></pre></div><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250515174752475.png" alt="image-20250515174752475" tabindex="0" loading="lazy"><figcaption>image-20250515174752475</figcaption></figure><ul><li>å¦‚å›¾å½“ç†Ÿç»ƒä½¿ç”¨åï¼Œå°±å¯ä»¥æ¢ç´¢æ›´å¤šçš„å‘å¸ƒéƒ¨ç½²æµç¨‹ï¼Œæ¯”å¦‚è¿™é‡Œåªæ˜¯åšbuild ä½†ä¸åšrunæ‰§è¡Œæ“ä½œã€‚å…·ä½“çš„éƒ¨ç½²å¯ä»¥é€šè¿‡ docker compose æ‰§è¡Œéƒ¨ç½²è„šæœ¬ã€‚</li></ul><h2 id="å››ã€æµ‹è¯•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#å››ã€æµ‹è¯•éªŒè¯"><span>å››ã€æµ‹è¯•éªŒè¯</span></a></h2><h3 id="_1-å‡†å¤‡æµ‹è¯•é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_1-å‡†å¤‡æµ‹è¯•é¡¹ç›®"><span>1. å‡†å¤‡æµ‹è¯•é¡¹ç›®</span></a></h3><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/lixuanfengs/lxf-dev-tech/tree/main/lxf-dev-tech-jenkins/" target="_blank" rel="noopener noreferrer">https://github.com/lixuanfengs/lxf-dev-tech/tree/main/lxf-dev-tech-jenkins/</a> å¯ä»¥ä¸‹è½½ä¸‹æ¥å¯¼å…¥åˆ° gitee ã€gitlab ç­‰ä»“åº“è¿›è¡Œä½¿ç”¨ã€‚</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> cn.cactusli.jenkins.app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> jakarta.servlet.http.HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.boot.SpringApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.boot.autoconfigure.SpringBootApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RequestMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.web.bind.annotation.RestController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> org.springframework.web.servlet.mvc.method.annotation.ResponseBodyEmitter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> java.io.IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/api/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     * http://localhost:8091/api/test</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/test&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> method</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> RequestMethod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">GET</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseBodyEmitter</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setContentType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;text/event-stream&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setCharacterEncoding</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Cache-Control&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;no-cache&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        ResponseBodyEmitter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> emitter</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ResponseBodyEmitter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">words</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[]{</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;å—¨ï¼Œè‡­å®ã€‚</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\r\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æ­å–œğŸ’ &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ä½ çš„&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot; Jenkins &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;éƒ¨&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ç½²&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æµ‹&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;è¯•&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;æˆ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;åŠŸ&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;äº†å•¦ğŸŒ¶ï¼&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\r\\n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">By ä»™äººçƒ https://cactusli.net&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> word</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> words) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    emitter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(word);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    Thread</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">250</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                    throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(e);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> emitter;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é¡¹ç›®ä¸­æä¾›äº† RestApi; <a href="http://192.168.1.23:8091/api/test" target="_blank" rel="noopener noreferrer">http://192.168.1.23:8091/api/test</a></li></ul><h3 id="_2-ci-cd-æ„å»ºå‘å¸ƒ" tabindex="-1"><a class="header-anchor" href="#_2-ci-cd-æ„å»ºå‘å¸ƒ"><span>2. CI&amp;CD - æ„å»ºå‘å¸ƒ</span></a></h3><p><strong>è®¿é—®åœ°å€</strong>ï¼š<a href="http://192.168.1.23:9090/job/lxf-dev-tech-jenkins/" target="_blank" rel="noopener noreferrer">http://192.168.1.23:9090/job/lxf-dev-tech-jenkins/</a></p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250516111118664.png" alt="image-20250516111118664" tabindex="0" loading="lazy"><figcaption>image-20250516111118664</figcaption></figure><ul><li>ç‚¹å‡»æ„å»ºé¡¹ç›®ï¼Œæœ€ç»ˆä¼šå®Œæˆæ„å»ºå’Œéƒ¨ç½²æˆåŠŸã€‚è¿è¡Œåˆ°è¿™ä»£è¡¨ä½ å…¨éƒ¨æ“ä½œå®Œæˆäº†ã€‚</li></ul><h3 id="_3-éªŒè¯ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_3-éªŒè¯ç»“æœ"><span>3. éªŒè¯ç»“æœ</span></a></h3><p><strong>è®¿é—®</strong>ï¼š<a href="http://192.168.1.23:8091/api/test" target="_blank" rel="noopener noreferrer">http://192.168.1.23:8091/api/test</a></p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250516111251716.png" alt="image-20250516111251716" tabindex="0" loading="lazy"><figcaption>image-20250516111251716</figcaption></figure><ul><li>å¦‚å›¾ä»£è¡¨ä½ å·²ç»å®Œæ•´çš„é…ç½®å¥½äº†æ•´ä¸ª Jenkins CI&amp;CD æµç¨‹ã€‚</li></ul><h2 id="äº”ã€æ‰©å±•" tabindex="-1"><a class="header-anchor" href="#äº”ã€æ‰©å±•"><span>äº”ã€æ‰©å±•</span></a></h2><p>è¿™æ˜¯ä¸€ä¸ª Jenkins æµæ°´çº¿è„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºã€æ‰“åŒ…å’Œéƒ¨ç½²ä¸¤ä¸ªå‰ç«¯é¡¹ç›®ï¼ˆcactus-ui-admin-vue3 å’Œ shenzhen-webï¼‰ï¼Œæœ€ç»ˆå°†å®ƒä»¬æ‰“åŒ…ä¸ºä¸€ä¸ª Nginx æœåŠ¡çš„ Docker é•œåƒå¹¶é€šè¿‡ Docker Compose éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚</p><h3 id="_1-pipelineè„šæœ¬éƒ¨ç½²å‰ç«¯é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_1-pipelineè„šæœ¬éƒ¨ç½²å‰ç«¯é¡¹ç›®"><span>1. Pipelineè„šæœ¬éƒ¨ç½²å‰ç«¯é¡¹ç›®</span></a></h3><div class="language-groovy line-numbers-mode" data-highlighter="shiki" data-ext="groovy" data-title="groovy" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    agent any</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    tools {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        nodejs </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;NodeJS-18.20.8&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // å‡è®¾Jenkinså·²é…ç½®NodeJSå·¥å…·</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    environment {</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        CACTUS_UI_REPO</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;http://192.168.1.19:8929/root/cactus-ui-admin-vue3.git&#39;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        SHENZHEN_WEB_REPO</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;http://192.168.1.19:8929/root/shenzhen-web.git&#39;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        SSH_CONFIG_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;sg-server&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // Jenkins &quot;Publish over SSH&quot; ä¸­é…ç½®çš„æœåŠ¡å™¨åç§°</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        GIT_CREDENTIALS_ID</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;a71a582f-eb89-4a76-9ef0-7e572e572bad&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        CACTUS_UI_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;cactus-ui-admin-vue3&#39;</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        SHENZHEN_WEB_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;shenzhen-web&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        DOCKER_CREDENTIALS_ID</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;68b87c8d-77bc-4d4b-b09b-0b24bc7d7fa2&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Docker é•œåƒåç§° - æ ¹æ®æ‚¨çš„å®é™…æƒ…å†µä¿®æ”¹</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        DOCKER_IMAGE_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;218.249.73.244:8443/cactuslixf/sg-nginx&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ä¾‹å¦‚ï¼šyourdockerhubusername/multi-static-app</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        DOCKER_IMAGE_TAG</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;latest&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // ä¾‹å¦‚ï¼šlatest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Docker Compose ç›¸å…³é…ç½® (éœ€è¦åœ¨è¿œç¨‹æœåŠ¡å™¨ sg-server ä¸Šå®é™…å­˜åœ¨)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // è¿œç¨‹æœåŠ¡å™¨ä¸Š docker-compose.yml æ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        REMOTE_COMPOSE_PROJECT_DIR</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/work/projects/cactus-pipeline/&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // &lt;&lt;== ã€ç”¨æˆ·å¿…é¡»ä¿®æ”¹ã€‘</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰çš„ Nginx æœåŠ¡åç§°</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">        REMOTE_NGINX_SERVICE_NAME</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;sg-nginx&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // &lt;&lt;== ã€ç”¨æˆ·å¿…é¡»ä¿®æ”¹ã€‘</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Checkout Projects&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            parallel {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Checkout Cactus UI Project&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                        dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.CACTUS_UI_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            git </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">CACTUS_UI_REPO</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">branch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;main&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">credentialsId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">GIT_CREDENTIALS_ID</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Checkout Shenzhen Web Project&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                        dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.SHENZHEN_WEB_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            git </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">SHENZHEN_WEB_REPO</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">branch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;master&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">credentialsId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">GIT_CREDENTIALS_ID</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Install Project Dependencies&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            parallel {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Install Cactus UI Dependencies&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                        dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.CACTUS_UI_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            //sh &#39;rm -rf node_modules&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;npm config set registry https://registry.npmmirror.com&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;npm install&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Install Shenzhen Web Dependencies&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                        dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.SHENZHEN_WEB_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            //sh &#39;rm -rf node_modules&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;npm config set registry https://registry.npmmirror.com&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;npm install&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build Projects&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            parallel {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build Cactus UI Project&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                        dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.CACTUS_UI_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            // é‡è¦: ç¡®ä¿æ­¤æ„å»ºå‘½ä»¤ç”Ÿæˆçš„åº”ç”¨èƒ½å¤Ÿæ­£ç¡®å¤„ç†å…¶è¿è¡Œæ—¶çš„åŸºç¡€è·¯å¾„ (base path)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            // ä¾‹å¦‚ï¼Œå¦‚æœæœ€ç»ˆé€šè¿‡ Nginx ä»¥ /cactus-ui/ è®¿é—®ï¼ŒVue app çš„ publicPath éœ€è¦é…ç½®ä¸º /cactus-ui/</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            // sh &#39;rm -rf dist-dev&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;npm run build:dev&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build Shenzhen Web Project&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                        dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.SHENZHEN_WEB_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            // é‡è¦: åŒä¸Šï¼Œç¡®ä¿åº”ç”¨æ„å»ºæ—¶è€ƒè™‘äº†æœ€ç»ˆçš„è®¿é—®è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                            // sh &#39;rm -rf dist&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;npm run build&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Prepare Docker Context&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                script {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;mkdir -p docker-context/cactus-ui-dist&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;mkdir -p docker-context/shenzhen-web-dist&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cp -R </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.CACTUS_UI_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/dist-dev/* docker-context/cactus-ui-dist/&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;cp -R </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.SHENZHEN_WEB_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/dist/* docker-context/shenzhen-web-dist/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    // å†™å…¥ç®€åŒ–åçš„ Dockerfile (ä¸åŒ…å« Nginx é…ç½®)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    writeFile </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;docker-context/Dockerfile&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;\\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        FROM nginx:alpine</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        RUN mkdir -p /usr/share/nginx/html/cactus-ui-admin &amp;&amp; \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                            mkdir -p /usr/share/nginx/html/shenzhen-web</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        COPY cactus-ui-dist /usr/share/nginx/html/v2_admin/</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        COPY shenzhen-web-dist /usr/share/nginx/html/v2/</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        EXPOSE 80</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        EXPOSE 443</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Dockerfile prepared in docker-context directory.&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Build and Push Docker Image&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                script {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                    def</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fullImageNameWithTag </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_IMAGE_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_IMAGE_TAG</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                    def</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> fullImageNameLatest </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_IMAGE_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:latest&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Building Docker image: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameWithTag</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameLatest</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                    dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;docker-context&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;docker build -t </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameWithTag</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;docker tag </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameWithTag</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;"> \${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameLatest</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    // (å¯é€‰) æ¨é€åˆ° Docker ä»“åº“</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                    // è¯·ç¡®ä¿åœ¨æ­¤ä¹‹å‰å·²ç»é…ç½®äº† Docker ä»“åº“çš„ç™»å½•å‡­æ®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                    withCredentials</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">usernamePassword</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">credentialsId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_CREDENTIALS_ID</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">passwordVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DOCKER_PASS&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">usernameVariable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;DOCKER_USER&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)]) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;echo </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;\\$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{DOCKER_PASS}</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> | docker login -u </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;\\$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{DOCKER_USER}</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  --password-stdin 218.249.73.244:8443&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                        // æ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;docker push </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameWithTag</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;docker push </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameLatest</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Docker images pushed: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameWithTag</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameLatest</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Docker images built: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameWithTag</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">fullImageNameLatest</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">        stage</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Deploy via Docker Compose&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Deploying service </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.REMOTE_NGINX_SERVICE_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.SSH_CONFIG_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> using image </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_IMAGE_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                sshPublisher</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">publishers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                    sshPublisherDesc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                        configName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">SSH_CONFIG_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                        transfers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">                            sshTransfer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                    // æŒ‡å®šæœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                    //sourceFiles: &quot;docker-compose.yml, docker-context/**&quot;,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                    // è¿œç¨‹æœåŠ¡å™¨çš„ç›®æ ‡ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                    //remoteDirectory: &quot;\${REMOTE_COMPOSE_PROJECT_DIR}&quot;,</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                                    // æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¯é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">                                    execCommand</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                        set -x  # æ‰§è¡Œå‘½ä»¤å‰æ‰“å°å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                        cd </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.REMOTE_COMPOSE_PROJECT_DIR</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                        docker compose -f cactus-server-pipeline-compose.yml down</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                        docker compose -f cactus-server-pipeline-compose.yml pull</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                        docker compose -f cactus-server-pipeline-compose.yml up -d</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            )</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                    )</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                ])</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    post {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        success {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Pipeline completed successfully! Docker Image: </span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_IMAGE_NAME</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">\${</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">env.DOCKER_IMAGE_TAG</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and :latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        failure {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Pipeline failed!&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        always {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            echo </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Cleaning up Jenkins workspace...&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            sh </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;rm -rf docker-context&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // æ¸…ç† Docker æ„å»ºä¸Šä¸‹æ–‡ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸»è¦åŠŸèƒ½ï¼š</strong></p><ul><li><p>å¹¶è¡Œæ£€å‡ºä»£ç ï¼š</p><ul><li>ä» Git ä»“åº“<code>ï¼ˆcactus-ui-admin-vue3 å’Œ shenzhen-webï¼‰</code>å¹¶è¡Œæ£€å‡ºä»£ç åˆ°æŒ‡å®šç›®å½•ã€‚</li><li>ä½¿ç”¨é…ç½®çš„<code> Git å‡­æ®ï¼ˆGIT_CREDENTIALS_IDï¼‰å’ŒæŒ‡å®šçš„åˆ†æ”¯ï¼ˆmain å’Œ masterï¼‰</code>ã€‚</li></ul></li><li><p>å¹¶è¡Œå®‰è£…ä¾èµ–ï¼š</p><ul><li>åœ¨ä¸¤ä¸ªé¡¹ç›®ç›®å½•ä¸­åˆ†åˆ«è¿è¡Œ<code> npm install</code>ï¼Œä½¿ç”¨å›½å†…é•œåƒæº<code>ï¼ˆhttps://registry.npmmirror.comï¼‰</code>åŠ é€Ÿä¾èµ–å®‰è£…ã€‚</li></ul></li><li><p>å¹¶è¡Œæ„å»ºé¡¹ç›®ï¼š</p><ul><li><p>å¯¹ <code>cactus-ui-admin-vue3</code> æ‰§è¡Œ <code>npm run build:dev</code>ï¼Œç”Ÿæˆ <code>dist-dev</code> ç›®å½•ã€‚</p></li><li><p>å¯¹ <code>shenzhen-web</code> æ‰§è¡Œ <code>npm run build</code>ï¼Œç”Ÿæˆ <code>dis</code>t ç›®å½•ã€‚</p></li></ul></li><li><p>å‡†å¤‡ Docker ä¸Šä¸‹æ–‡ï¼š</p><ul><li><p>åˆ›å»º <code>docker-context</code> ç›®å½•ï¼Œå°†ä¸¤ä¸ªé¡¹ç›®çš„æ„å»ºè¾“å‡ºï¼ˆ<code>dist-dev å’Œ dist</code>ï¼‰å¤åˆ¶åˆ°å¯¹åº”å­ç›®å½•ã€‚</p></li><li><p>ç”Ÿæˆä¸€ä¸ªç®€å•çš„ <code>Dockerfile</code>ï¼ŒåŸºäº<code> nginx:alpine</code> é•œåƒï¼Œå°†æ„å»ºè¾“å‡ºå¤åˆ¶åˆ° <code>Nginx</code> çš„é™æ€æ–‡ä»¶ç›®å½•<code>ï¼ˆ/usr/share/nginx/html/v2_admin/ å’Œ /usr/share/nginx/html/v2/</code>ï¼‰ã€‚</p></li></ul></li><li><p>æ„å»ºå¹¶æ¨é€ Docker é•œåƒï¼š</p><ul><li><p>åœ¨ <code>docker-context</code> ç›®å½•ä¸­æ„å»º<code> Docker</code> é•œåƒï¼Œå‘½åä¸º<code> DOCKER_IMAGE_NAME:DOCKER_IMAGE_TAG</code> å’Œ <code>latest </code>æ ‡ç­¾ã€‚</p></li><li><p>ä½¿ç”¨é…ç½®çš„ <code>Docker</code> å‡­æ®<code>ï¼ˆDOCKER_CREDENTIALS_IDï¼‰</code>ç™»å½•åˆ°ç§æœ‰ <code>Docker</code> ä»“åº“ï¼ˆ<code>218.249.73.244:8443</code>ï¼‰ã€‚</p></li><li><p>æ¨é€æ„å»ºçš„é•œåƒåˆ°ä»“åº“ã€‚</p></li></ul></li><li><p>é€šè¿‡ <code>Docker Compose</code> éƒ¨ç½²ï¼š</p><ul><li><p>ä½¿ç”¨<code> Jenkins</code> çš„<code>Publish over SSH</code> æ’ä»¶è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼ˆ<code>SSH_CONFIG_NAME</code>ï¼‰ã€‚</p></li><li><p>åœ¨è¿œç¨‹æœåŠ¡å™¨çš„æŒ‡å®šç›®å½•ï¼ˆ<code>REMOTE_COMPOSE_PROJECT_DIR</code>ï¼‰æ‰§è¡Œ<code> Docker Compose</code> å‘½ä»¤ï¼š</p><ul><li><p>åœæ­¢ç°æœ‰æœåŠ¡ï¼ˆdocker compose downï¼‰ã€‚</p></li><li><p>æ‹‰å–æœ€æ–°é•œåƒï¼ˆdocker compose pullï¼‰ã€‚</p></li><li><p>å¯åŠ¨æœåŠ¡ï¼ˆdocker compose up -dï¼‰ã€‚</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3.8&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # Specify a Docker Compose version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sg-nginx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">218.249.73.244:8443/cactuslixf/sg-nginx:latest</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sg-nginx</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;8081:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;4431:443&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/work/projects/cactus-pipeline/nginx/nginx.conf:/etc/nginx/nginx.conf</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/work/projects/cactus-pipeline/nginx/conf.d:/etc/nginx/conf.d</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/work/projects/cactus-pipeline/nginx/logs:/var/log/nginx</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/work/projects/cactus-pipeline/nginx/cert:/etc/nginx/cert</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      #- /work/projects/cactus-pipeline/nginx/html:/usr/share/nginx/html</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    logging</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      driver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;json-file&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      options</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        max-size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;10m&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        max-file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;3&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sg_network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sg_network</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    driver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">bridge</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li><li><p>åæœŸå¤„ç†:</p><ul><li><strong>æˆåŠŸ</strong>ï¼šæ‰“å°æˆåŠŸä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„ Docker é•œåƒåç§°å’Œæ ‡ç­¾ã€‚</li><li><strong>å¤±è´¥</strong>ï¼šæ‰“å°å¤±è´¥ä¿¡æ¯ã€‚</li><li><strong>å§‹ç»ˆæ‰§è¡Œ</strong>ï¼šæ¸…ç† Jenkins å·¥ä½œç©ºé—´ä¸­çš„ docker-context ç›®å½•ã€‚</li></ul></li></ul><h3 id="_2-é…ç½®å…¨å±€å·¥å…·-nodejs" tabindex="-1"><a class="header-anchor" href="#_2-é…ç½®å…¨å±€å·¥å…·-nodejs"><span>2. é…ç½®å…¨å±€å·¥å…· nodejs</span></a></h3><p>è„šæœ¬ä¸­ä½¿ç”¨åˆ°äº† <code>nodej</code> , å› æ­¤éœ€è¦é…ç½®å…¨å±€ <code>nodejs</code> å·¥å…·ã€‚</p><p>é…ç½® Node.jsï¼Œéœ€è¿›å…¥å®¹å™¨å†…éƒ¨ï¼š</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jenkins</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bash</span></span></code></pre></div><p>åœ¨å®¹å™¨ä¸­æ‰‹åŠ¨å®‰è£… Node.jsï¼ˆä»¥ Node.js 20 ä¸ºä¾‹ï¼‰ï¼š</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ›´æ–°åŒ…ç´¢å¼• </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å®‰è£… curlï¼ˆè‹¥æœªå®‰è£…ï¼‰ </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ä¸‹è½½å¹¶å®‰è£… Node.js </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -fsSL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://deb.nodesource.com/setup_18.x</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodejs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># éªŒè¯å®‰è£… </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span></span></code></pre></div><p>jenkins å…¨å±€å·¥å…·é…ç½®nodejsï¼š</p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528110658876.png" alt="image-20250528110658876" tabindex="0" loading="lazy"><figcaption>image-20250528110658876</figcaption></figure><h3 id="_3-åç«¯é¡¹ç›®éƒ¨ç½²é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-åç«¯é¡¹ç›®éƒ¨ç½²é…ç½®"><span>3. åç«¯é¡¹ç›®éƒ¨ç½²é…ç½®</span></a></h3><p>æºç ç®¡ç†ï¼š</p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528111012779.png" alt="image-20250528111012779" tabindex="0" loading="lazy"><figcaption>image-20250528111012779</figcaption></figure><p>ç¼–è¯‘ Buildï¼š</p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528111118273.png" alt="image-20250528111118273" tabindex="0" loading="lazy"><figcaption>image-20250528111118273</figcaption></figure><p>Post Stepsï¼š</p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528111227566.png" alt="image-20250528111227566" tabindex="0" loading="lazy"><figcaption>image-20250528111227566</figcaption></figure><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528112546790.png" alt="image-20250528112546790" tabindex="0" loading="lazy"><figcaption>image-20250528112546790</figcaption></figure><p>SSH Publishersï¼ˆéœ€è¦åœ¨æ’ä»¶ç®¡ç†å®‰è£… SSH Publisherï¼‰ï¼Œç„¶ååœ¨<code>ç³»ç»Ÿç®¡ç†</code>ä¸­é…ç½®è¿œç¨‹ SSH Servers:</p><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528111539619.png" alt="image-20250528111539619" tabindex="0" loading="lazy"><figcaption>image-20250528111539619</figcaption></figure><figure><img src="https://beauties.eu.org/blogimg/main/img1/image-20250528111558029.png" alt="image-20250528111558029" tabindex="0" loading="lazy"><figcaption>image-20250528111558029</figcaption></figure><p>æ»šåŠ¨å‡çº§åç«¯é¡¹ç›®æ‰§è¡Œè„šæœ¬ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å˜é‡å®šä¹‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">COMPOSE_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/work/projects/cactus-server-all/sg-cactus-server.yml&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">NGINX_CONF</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/work/projects/cactus-pipeline/nginx/nginx.conf&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">NGINX_CONTAINER</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sg-nginx&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">BACKEND_1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.168.11.25:58080&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">BACKEND_2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;192.168.11.25:58081&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">NEW_IMAGE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;218.249.73.244:8443/cactuslixf/cactus-server:latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/work/projects/cactus-server-all/upgrade.log&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dirname</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ—¥å¿—å‡½æ•°ï¼šæ·»åŠ æ—¶é—´æˆ³å¹¶å†™å…¥æ—¥å¿—æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;+%Y-%m-%d %H:%M:%S&#39;) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$message</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¤‡ä»½å½“å‰é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å¤‡ä»½å½“å‰é…ç½®æ–‡ä»¶...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">COMPOSE_FILE</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.bak</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONF</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">NGINX_CONF</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.bak</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ‹‰å–æ–°é•œåƒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æ‹‰å–æ–°é•œåƒ...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NEW_IMAGE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‡½æ•°ï¼šæ›´æ–° Nginx é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> backend</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> weight</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">$2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æ›´æ–° Nginx é…ç½®: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$backend</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> weight=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$weight</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;s/server </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$backend</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> weight=[0-9];/server </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$backend</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> weight=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$weight</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">;/&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONF</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONTAINER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONTAINER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‡çº§ç¬¬ä¸€ä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å‡çº§ç¬¬ä¸€ä¸ªå®ä¾‹ (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">)...&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å°†æµé‡å®Œå…¨å¯¼å‘ç¬¬äºŒä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœæ­¢å¹¶æ›´æ–°ç¬¬ä¸€ä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;åœæ­¢å¹¶æ›´æ–°ç¬¬ä¸€ä¸ªå®ä¾‹...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sg-cactus-server-1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sg-cactus-server-1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># éªŒè¯æ–°å®ä¾‹è¿è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;éªŒè¯ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> è¿è¡ŒçŠ¶æ€...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sg-cactus-server-1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -q</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;started&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> å‡çº§æˆåŠŸ&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ERROR: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> å‡çº§å¤±è´¥ï¼Œæ¢å¤ Nginx é…ç½®...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    cp</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">NGINX_CONF</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.bak</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONTAINER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    exit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¢å¤æµé‡å¹³è¡¡</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æ¢å¤æµé‡å¹³è¡¡...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å‡çº§ç¬¬äºŒä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å‡çº§ç¬¬äºŒä¸ªå®ä¾‹ (</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">)...&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å°†æµé‡å®Œå…¨å¯¼å‘ç¬¬ä¸€ä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœæ­¢å¹¶æ›´æ–°ç¬¬äºŒä¸ªå®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;åœæ­¢å¹¶æ›´æ–°ç¬¬äºŒä¸ªå®ä¾‹...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sg-cactus-server-2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sg-cactus-server-2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># éªŒè¯æ–°å®ä¾‹è¿è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;éªŒè¯ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> è¿è¡ŒçŠ¶æ€...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> compose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $COMPOSE_FILE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sg-cactus-server-2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -q</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;started&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> å‡çº§æˆåŠŸ&quot;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;ERROR: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$BACKEND_2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> å‡çº§å¤±è´¥ï¼Œæ¢å¤ Nginx é…ç½®...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    cp</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> \${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">NGINX_CONF</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.bak</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $NGINX_CONTAINER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reload</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    exit</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¢å¤æµé‡å¹³è¡¡</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æ¢å¤æµé‡å¹³è¡¡...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_nginx_config</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $BACKEND_2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¸…ç†</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æ¸…ç†æ—§é•œåƒ...&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> prune</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 2&gt;&amp;1 | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tee</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $LOG_FILE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å‡çº§å®Œæˆï¼&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿œç¨‹æœºå™¨ä¸Šçš„ <code>sg-cactus-server.yml</code>:</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sg-cactus-server-1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">218.249.73.244:8443/cactuslixf/cactus-server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sg-cactus-server-1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    privileged</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SPRING_PROFILES_ACTIVE=dev</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">JAVA_OPTS=-Xms4096m -Xmx14336m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">58080:48080</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/work/projects/cactus-server-all/sg-cactus-server-1:/root/logs/</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">unless-stopped</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sg_network</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sg-cactus-server-2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">218.249.73.244:8443/cactuslixf/cactus-server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sg-cactus-server-2</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    privileged</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SPRING_PROFILES_ACTIVE=dev</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">JAVA_OPTS=-Xms4096m -Xmx14336m</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">58081:48080</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    volumes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/work/projects/cactus-server-all/sg-cactus-server-2:/root/logs/</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">unless-stopped</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sg_network</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">networks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sg_network</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    driver</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">bridge</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,83)])])}const p=i(e,[["render",h]]),d=JSON.parse(`{"path":"/devops/cicd/Docker%E4%B8%AD%E9%83%A8%E7%BD%B2Jenkins%E5%AE%9E%E7%8E%B0CI_CD.html","title":"Dockerä¸­éƒ¨ç½²Jenkinså®ç°CI&CD","lang":"zh-CN","frontmatter":{"title":"Dockerä¸­éƒ¨ç½²Jenkinså®ç°CI&CD","subtitle":"Dockerä¸­éƒ¨ç½²Jenkinså®ç°CI&CD","date":"2025-05-10T16:06:01.000Z","category":["Jenkins"],"tag":["Jenkins"],"order":11,"description":"ä¸€ã€éƒ¨ç½²è¯´æ˜ æœ¬ç« ä»¥åŠä»¥æœ€ç®€å•çš„æ–¹å¼é…ç½®ä½¿ç”¨ Jenkins å®Œæˆ Spring Bootã€Vueé¡¹ç›®çš„éƒ¨ç½²ï¼Œæ•´ä¸ªéƒ¨ç½²æ“ä½œæµç¨‹å¦‚ä¸‹ï¼› Jenkins1.drawioJenkins1.drawio å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯æ•´ä¸ªé¡¹ç›®å‘å¸ƒçš„é…ç½®æµç¨‹ï¼Œå³è¾¹æ˜¯é…ç½®è¿‡ç¨‹ä¸­çš„ç»†èŠ‚ã€‚ å°†æœ¬åœ°å¯¹é¡¹ç›®æ‰“åŒ…éƒ¨ç½²çš„è¿‡ç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸ªæ¨¡å—ï¼Œåœ¨é…ç½®åˆ° Jenkins ç¯å¢ƒä¸­ï¼Œè¿™å°±æ˜¯ Je...","head":[["meta",{"property":"og:url","content":"https://cactusli.net/devops/cicd/Docker%E4%B8%AD%E9%83%A8%E7%BD%B2Jenkins%E5%AE%9E%E7%8E%B0CI_CD.html"}],["meta",{"property":"og:site_name","content":"Cactus's Blog"}],["meta",{"property":"og:title","content":"Dockerä¸­éƒ¨ç½²Jenkinså®ç°CI&CD"}],["meta",{"property":"og:description","content":"ä¸€ã€éƒ¨ç½²è¯´æ˜ æœ¬ç« ä»¥åŠä»¥æœ€ç®€å•çš„æ–¹å¼é…ç½®ä½¿ç”¨ Jenkins å®Œæˆ Spring Bootã€Vueé¡¹ç›®çš„éƒ¨ç½²ï¼Œæ•´ä¸ªéƒ¨ç½²æ“ä½œæµç¨‹å¦‚ä¸‹ï¼› Jenkins1.drawioJenkins1.drawio å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯æ•´ä¸ªé¡¹ç›®å‘å¸ƒçš„é…ç½®æµç¨‹ï¼Œå³è¾¹æ˜¯é…ç½®è¿‡ç¨‹ä¸­çš„ç»†èŠ‚ã€‚ å°†æœ¬åœ°å¯¹é¡¹ç›®æ‰“åŒ…éƒ¨ç½²çš„è¿‡ç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸ªæ¨¡å—ï¼Œåœ¨é…ç½®åˆ° Jenkins ç¯å¢ƒä¸­ï¼Œè¿™å°±æ˜¯ Je..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://beauties.eu.org/blogimg/main/img1/Jenkins1.drawio.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-18T09:49:26.000Z"}],["meta",{"property":"article:tag","content":"Jenkins"}],["meta",{"property":"article:published_time","content":"2025-05-10T16:06:01.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-18T09:49:26.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Dockerä¸­éƒ¨ç½²Jenkinså®ç°CI&CD\\",\\"image\\":[\\"https://beauties.eu.org/blogimg/main/img1/Jenkins1.drawio.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515143822929.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515160829529.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515161124841.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515164145512.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515165434711.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515170238346.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515173728453.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515173912340.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250515174752475.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250516111118664.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250516111251716.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528110658876.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528111012779.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528111118273.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528111227566.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528112546790.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528111539619.png\\",\\"https://beauties.eu.org/blogimg/main/img1/image-20250528111558029.png\\"],\\"datePublished\\":\\"2025-05-10T16:06:01.000Z\\",\\"dateModified\\":\\"2025-08-18T09:49:26.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Cactus li\\",\\"url\\":\\"https://cactusli.net\\"}]}"]]},"headers":[{"level":2,"title":"ä¸€ã€éƒ¨ç½²è¯´æ˜","slug":"ä¸€ã€éƒ¨ç½²è¯´æ˜","link":"#ä¸€ã€éƒ¨ç½²è¯´æ˜","children":[]},{"level":2,"title":"äºŒã€ç¯å¢ƒé…ç½®","slug":"äºŒã€ç¯å¢ƒé…ç½®","link":"#äºŒã€ç¯å¢ƒé…ç½®","children":[{"level":3,"title":"1. Jenkins éƒ¨ç½²","slug":"_1-jenkins-éƒ¨ç½²","link":"#_1-jenkins-éƒ¨ç½²","children":[]},{"level":3,"title":"2. æ’ä»¶å®‰è£…","slug":"_2-æ’ä»¶å®‰è£…","link":"#_2-æ’ä»¶å®‰è£…","children":[]},{"level":3,"title":"3. å…¨å±€å·¥å…·é…ç½®","slug":"_3-å…¨å±€å·¥å…·é…ç½®","link":"#_3-å…¨å±€å·¥å…·é…ç½®","children":[]},{"level":3,"title":"4. æ·»åŠ å‡­è¯","slug":"_4-æ·»åŠ å‡­è¯","link":"#_4-æ·»åŠ å‡­è¯","children":[]}]},{"level":2,"title":"ä¸‰ã€æ–°å»ºä»»åŠ¡","slug":"ä¸‰ã€æ–°å»ºä»»åŠ¡","link":"#ä¸‰ã€æ–°å»ºä»»åŠ¡","children":[{"level":3,"title":"1. é…ç½®ä»»åŠ¡","slug":"_1-é…ç½®ä»»åŠ¡","link":"#_1-é…ç½®ä»»åŠ¡","children":[]},{"level":3,"title":"2. é…ç½®Git","slug":"_2-é…ç½®git","link":"#_2-é…ç½®git","children":[]},{"level":3,"title":"3. é…ç½®Maven","slug":"_3-é…ç½®maven","link":"#_3-é…ç½®maven","children":[]},{"level":3,"title":"3. é…ç½®Shell","slug":"_3-é…ç½®shell","link":"#_3-é…ç½®shell","children":[]}]},{"level":2,"title":"å››ã€æµ‹è¯•éªŒè¯","slug":"å››ã€æµ‹è¯•éªŒè¯","link":"#å››ã€æµ‹è¯•éªŒè¯","children":[{"level":3,"title":"1. å‡†å¤‡æµ‹è¯•é¡¹ç›®","slug":"_1-å‡†å¤‡æµ‹è¯•é¡¹ç›®","link":"#_1-å‡†å¤‡æµ‹è¯•é¡¹ç›®","children":[]},{"level":3,"title":"2. CI&CD - æ„å»ºå‘å¸ƒ","slug":"_2-ci-cd-æ„å»ºå‘å¸ƒ","link":"#_2-ci-cd-æ„å»ºå‘å¸ƒ","children":[]},{"level":3,"title":"3. éªŒè¯ç»“æœ","slug":"_3-éªŒè¯ç»“æœ","link":"#_3-éªŒè¯ç»“æœ","children":[]}]},{"level":2,"title":"äº”ã€æ‰©å±•","slug":"äº”ã€æ‰©å±•","link":"#äº”ã€æ‰©å±•","children":[{"level":3,"title":"1. Pipelineè„šæœ¬éƒ¨ç½²å‰ç«¯é¡¹ç›®","slug":"_1-pipelineè„šæœ¬éƒ¨ç½²å‰ç«¯é¡¹ç›®","link":"#_1-pipelineè„šæœ¬éƒ¨ç½²å‰ç«¯é¡¹ç›®","children":[]},{"level":3,"title":"2. é…ç½®å…¨å±€å·¥å…· nodejs","slug":"_2-é…ç½®å…¨å±€å·¥å…·-nodejs","link":"#_2-é…ç½®å…¨å±€å·¥å…·-nodejs","children":[]},{"level":3,"title":"3. åç«¯é¡¹ç›®éƒ¨ç½²é…ç½®","slug":"_3-åç«¯é¡¹ç›®éƒ¨ç½²é…ç½®","link":"#_3-åç«¯é¡¹ç›®éƒ¨ç½²é…ç½®","children":[]}]}],"git":{"createdTime":1755510566000,"updatedTime":1755510566000,"contributors":[{"name":"Dell","username":"Dell","email":"1183895890@qq.com","commits":1,"url":"https://github.com/Dell"}]},"readingTime":{"minutes":12.91,"words":3872},"filePathRelative":"devops/cicd/Dockerä¸­éƒ¨ç½²Jenkinså®ç°CI&CD.md","localizedDate":"2025å¹´5æœˆ10æ—¥","excerpt":"<h2>ä¸€ã€éƒ¨ç½²è¯´æ˜</h2>\\n<p>æœ¬ç« ä»¥åŠä»¥æœ€ç®€å•çš„æ–¹å¼é…ç½®ä½¿ç”¨ Jenkins å®Œæˆ <code>Spring Boot</code>ã€<code>Vue</code>é¡¹ç›®çš„éƒ¨ç½²ï¼Œæ•´ä¸ªéƒ¨ç½²æ“ä½œæµç¨‹å¦‚ä¸‹ï¼›</p>\\n<figure><img src=\\"https://beauties.eu.org/blogimg/main/img1/Jenkins1.drawio.png\\" alt=\\"Jenkins1.drawio\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>Jenkins1.drawio</figcaption></figure>\\n<ul>\\n<li>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦è¾¹æ˜¯æ•´ä¸ªé¡¹ç›®å‘å¸ƒçš„é…ç½®æµç¨‹ï¼Œå³è¾¹æ˜¯é…ç½®è¿‡ç¨‹ä¸­çš„ç»†èŠ‚ã€‚</li>\\n<li>å°†æœ¬åœ°å¯¹é¡¹ç›®æ‰“åŒ…éƒ¨ç½²çš„è¿‡ç¨‹æ‹†è§£ä¸ºä¸€ä¸ªä¸ªæ¨¡å—ï¼Œåœ¨é…ç½®åˆ° <code>Jenkins</code> ç¯å¢ƒä¸­ï¼Œè¿™å°±æ˜¯ Jenkins çš„ä½œç”¨ã€‚</li>\\n</ul>","autoDesc":true}`);export{p as comp,d as data};
