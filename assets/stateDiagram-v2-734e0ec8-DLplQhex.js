import{D as K,A as I,L as Y,E as z,t as F,I as H,_ as Q,C as X}from"./styles-b6ab520b-CI0EiVzs.js";import{Z as tt}from"./graph-e9862b7e-DsLgKov8.js";import{L as p,J as S,T as A,n as et,P as st,b as E}from"./mermaid.esm.min-Ds9q7Vr_.js";import{b as ot}from"./index-5e3196ce-DJU6MHy1.js";import"./app-Da1Br5pT.js";import"./layout-2e6f21ea-8P9ZiItt.js";import"./clone-06085faa-Z2Fw6AUN.js";import"./edges-16a2be2d-CCV5Dlrp.js";import"./createText-323577ec-BA4n_oFW.js";import"./line-552be4bc-BPXCTRjz.js";import"./array-2ff2c7a6-C3YJfAyO.js";import"./path-428ebac9-B0oSrkCJ.js";const w="rect",k="rectWithTitle",at="start",rt="end",it="divider",nt="roundedWithTitle",dt="note",lt="noteGroup",h="statediagram",ct="state",pt=`${h}-${ct}`,M="transition",bt="note",gt="note-edge",ut=`${M} ${gt}`,ht=`${h}-${bt}`,yt="cluster",ft=`${h}-${yt}`,mt="cluster-alt",$t=`${h}-${mt}`,W="parent",j="note",xt="state",v="----",wt=`${v}${j}`,_=`${v}${W}`,G="fill:none",O="fill: #333",q="c",J="text",U="normal";let T={},c=0;const Tt=function(t){const a=Object.keys(t);for(const e of a)t[e]},St=function(t,a){return a.db.extract(a.db.getRootDocV2()),a.db.getClasses()};function Dt(t){return t==null?"":t.classes?t.classes.join(" "):""}function B(t="",a=0,e="",r=v){const i=e!==null&&e.length>0?`${r}${e}`:"";return`${xt}-${t}${i}-${a}`}const x=(t,a,e,r,i,n)=>{const s=e.id,y=Dt(r[s]);if(s!=="root"){let g=w;e.start===!0&&(g=at),e.start===!1&&(g=rt),e.type!==z&&(g=e.type),T[s]||(T[s]={id:s,shape:g,description:E.sanitizeText(s,S()),classes:`${y} ${pt}`});const o=T[s];e.description&&(Array.isArray(o.description)?(o.shape=k,o.description.push(e.description)):o.description.length>0?(o.shape=k,o.description===s?o.description=[e.description]:o.description=[o.description,e.description]):(o.shape=w,o.description=e.description),o.description=E.sanitizeTextOrArray(o.description,S())),o.description.length===1&&o.shape===k&&(o.shape=w),!o.type&&e.doc&&(p.info("Setting cluster for ",s,R(e)),o.type="group",o.dir=R(e),o.shape=e.type===F?it:nt,o.classes=o.classes+" "+ft+" "+(n?$t:""));const u={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:s,dir:o.dir,domId:B(s,c),type:o.type,padding:15};if(u.centerLabel=!0,e.note){const d={labelStyle:"",shape:dt,labelText:e.note.text,classes:ht,style:"",id:s+wt+"-"+c,domId:B(s,c,j),type:o.type,padding:15},l={labelStyle:"",shape:lt,labelText:e.note.text,classes:o.classes,style:"",id:s+_,domId:B(s,c,W),type:"group",padding:0};c++;const f=s+_;t.setNode(f,l),t.setNode(d.id,d),t.setNode(s,u),t.setParent(s,f),t.setParent(d.id,f);let b=s,m=d.id;e.note.position==="left of"&&(b=d.id,m=s),t.setEdge(b,m,{arrowhead:"none",arrowType:"",style:G,labelStyle:"",classes:ut,arrowheadStyle:O,labelpos:q,labelType:J,thickness:U})}else t.setNode(s,u)}a&&a.id!=="root"&&(p.trace("Setting node ",s," to be child of its parent ",a.id),t.setParent(s,a.id)),e.doc&&(p.trace("Adding nodes children "),At(t,e,e.doc,r,i,!n))},At=(t,a,e,r,i,n)=>{p.trace("items",e),e.forEach(s=>{switch(s.stmt){case Q:x(t,a,s,r,i,n);break;case z:x(t,a,s,r,i,n);break;case H:{x(t,a,s.state1,r,i,n),x(t,a,s.state2,r,i,n);const y={id:"edge"+c,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:G,labelStyle:"",label:E.sanitizeText(s.description,S()),arrowheadStyle:O,labelpos:q,labelType:J,thickness:U,classes:M};t.setEdge(s.state1.id,s.state2.id,y,c),c++}break}})},R=(t,a=X)=>{let e=a;if(t.doc)for(let r=0;r<t.doc.length;r++){const i=t.doc[r];i.stmt==="dir"&&(e=i.value)}return e},kt=async function(t,a,e,r){p.info("Drawing state diagram (v2)",a),T={},r.db.getDirection();const{securityLevel:i,state:n}=S(),s=n.nodeSpacing||50,y=n.rankSpacing||50;p.info(r.db.getRootDocV2()),r.db.extract(r.db.getRootDocV2()),p.info(r.db.getRootDocV2());const g=r.db.getStates(),o=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:R(r.db.getRootDocV2()),nodesep:s,ranksep:y,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});x(o,void 0,r.db.getRootDocV2(),g,r.db,!0);let u;i==="sandbox"&&(u=A("#i"+a));const d=i==="sandbox"?A(u.nodes()[0].contentDocument.body):A("body"),l=d.select(`[id="${a}"]`),f=d.select("#"+a+" g");await ot(f,o,["barb"],h,a);const b=8;et.insertTitle(l,"statediagramTitleText",n.titleTopMargin,r.db.getDiagramTitle());const m=l.node().getBBox(),C=m.width+b*2,L=m.height+b*2;l.attr("class",h);const V=l.node().getBBox();st(l,L,C,n.useMaxWidth);const N=`${V.x-b} ${V.y-b} ${C} ${L}`;p.debug(`viewBox ${N}`),l.attr("viewBox",N);const Z=document.querySelectorAll('[id="'+a+'"] .edgeLabel .label');for(const D of Z){const P=D.getBBox(),$=document.createElementNS("http://www.w3.org/2000/svg",w);$.setAttribute("rx",0),$.setAttribute("ry",0),$.setAttribute("width",P.width),$.setAttribute("height",P.height),D.insertBefore($,D.firstChild)}},Bt={setConf:Tt,getClasses:St,draw:kt},Wt={parser:K,db:I,renderer:Bt,styles:Y,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,I.clear()}};export{Wt as diagram};
