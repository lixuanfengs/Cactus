<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.58" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://cactusli.net/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E7%BA%BF%E7%A8%8B%E5%88%86%E6%9E%90%E4%B9%8B%E7%BA%BF%E7%A8%8BDump%E5%88%86%E6%9E%90.html"><meta property="og:site_name" content="Cactus's Blog"><meta property="og:title" content="调试排错 Java 线程分析之线程Dump分析"><meta property="og:description" content="Thread Dump是非常有用的诊断Java应用问题的工具。 调试排错 Java 线程分析之线程Dump分析 Thread Dump介绍 什么是Thread Dump Thread Dump特点 Thread Dump抓取 Thread Dump分析 Thread Dump信息 Thread状态分析 关键状态分析 关键状态示例 案例分析 问题场景 死..."><meta property="og:type" content="article"><meta property="og:image" content="https://lixuanfengs.github.io/blog-images/vp/Java/java-jvm-debug-1.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-22T10:01:39.000Z"><meta property="article:tag" content="Java"><meta property="article:tag" content="JVM"><meta property="article:published_time" content="2024-03-17T17:08:41.000Z"><meta property="article:modified_time" content="2024-03-22T10:01:39.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"调试排错 Java 线程分析之线程Dump分析","image":["https://lixuanfengs.github.io/blog-images/vp/Java/java-jvm-debug-1.png"],"datePublished":"2024-03-17T17:08:41.000Z","dateModified":"2024-03-22T10:01:39.000Z","author":[{"@type":"Person","name":"Cactus li","url":"https://cactusli.net"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://cactusli.net/rss.xml" title="Cactus's Blog RSS Feed"><title>调试排错 Java 线程分析之线程Dump分析 | Cactus's Blog</title><meta name="description" content="Thread Dump是非常有用的诊断Java应用问题的工具。 调试排错 Java 线程分析之线程Dump分析 Thread Dump介绍 什么是Thread Dump Thread Dump特点 Thread Dump抓取 Thread Dump分析 Thread Dump信息 Thread状态分析 关键状态分析 关键状态示例 案例分析 问题场景 死...">
    <link rel="preload" href="/assets/style-DFJaYI29.css" as="style"><link rel="stylesheet" href="/assets/style-DFJaYI29.css">
    <link rel="modulepreload" href="/assets/app-CF9kF85C.js"><link rel="modulepreload" href="/assets/调试排错 Java 线程分析之线程Dump分析.html-BXc6AS9N.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Cactus&#39;s Blog</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页"><!--[--><span class="font-icon icon iconfont icon-zhuye" style=""></span><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/demo/" aria-label="导航"><!--[--><span class="font-icon icon iconfont icon-daohang" style=""></span><!--]-->导航<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="知识体系"><!--[--><span class="font-icon icon iconfont icon-biji" style=""></span>知识体系<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">后端</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/posts/Java/" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Spring/" aria-label="Spring"><!--[--><span class="font-icon icon iconfont icon-spring" style=""></span><!--]-->Spring<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/posts/Python/" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->Python<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">前端</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/webs/ES6/" aria-label="ES6"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->ES6<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/webs/TypeScript/" aria-label="TypeScript"><!--[--><span class="font-icon icon iconfont icon-code" style=""></span><!--]-->TypeScript<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">服务器</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/linuxs/Linux/" aria-label="Linux"><!--[--><span class="font-icon icon iconfont icon-linux" style=""></span><!--]-->Linux<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/linuxs/Docker/" aria-label="Docker"><!--[--><span class="font-icon icon iconfont icon-docker" style=""></span><!--]-->Docker<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">博客相关</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/blog/" aria-label="博客相关"><!--[--><span class="font-icon icon iconfont icon-blog" style=""></span><!--]-->博客相关<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tutorial/" aria-label="工具|教程"><!--[--><span class="font-icon icon iconfont icon-ruanjian" style=""></span><!--]-->工具|教程<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/collect.html" aria-label="收藏"><!--[--><span class="font-icon icon iconfont icon-shoucang1" style=""></span><!--]-->收藏<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/visitorsbook.html" aria-label="留言板"><!--[--><span class="font-icon icon iconfont icon-liuyanpinglun" style=""></span><!--]-->留言板<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/friend.html" aria-label="友链"><!--[--><span class="font-icon icon iconfont icon-duankailianjie" style=""></span><!--]-->友链<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="关于"><!--[--><span class="font-icon icon iconfont icon-guanyu" style=""></span>关于<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/intro.html" aria-label="关于我"><!--[--><span class="font-icon icon iconfont icon-people" style=""></span><!--]-->关于我<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="关于本站"><!--[--><span class="font-icon icon iconfont icon-info" style=""></span><!--]-->关于本站<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/lixuanfengs/Cactus" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://fire.199228.xyz/" title="开往" target="_blank" rel="noopener noreferrer" aria-label="travelling"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor" style="width:1.25rem;height:1.25rem;vertical-align:middle"><path d="M658.836 519.32c-22.121 0-40.145 18.431-40.145 40.957 0 22.528 18.023 40.962 40.145 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957zM364.742 519.32c-22.121 0-40.141 18.431-40.141 40.957 0.41 22.528 18.02 40.962 40.141 40.962 22.117 0 40.141-18.434 40.141-40.962 0-22.526-18.024-40.957-40.141-40.957z" p-id="8700"></path><path d="M512 0C229.23 0 0 229.23 0 512s229.23 512 512 512 512-229.23 512-512S794.77 0 512 0z m133.727 804.81c0 7.375-6.145 13.52-13.516 13.52H391.773c-7.371 0-13.515-6.145-13.515-13.52v-13.516c0-7.371 6.144-13.517 13.515-13.517h240.438c7.371 0 13.516 6.146 13.516 13.517v13.516z m120.832 37.273c-12.289 6.965-27.441 2.867-34.406-9.418l-54.887-96.668c-4.504 0.82-9.422 1.23-13.926 1.23H361.054c-4.914 0-9.421-0.41-13.925-1.23l-54.887 96.668c-6.965 12.285-22.527 16.383-34.406 9.418-12.289-6.961-16.383-22.938-9.422-35.223l51.199-90.113c-27.031-19.66-43.418-52.43-40.957-88.883l19.25-293.273c3.277-49.152 34.406-88.066 87.246-88.066h80.281c0-37.684 29.899-67.993 66.762-67.993 36.868 0 66.766 30.309 66.766 67.993h93.391c53.246 0 70.449 38.914 73.727 88.066l19.25 293.273c2.461 36.453-13.926 69.223-40.957 88.883l51.199 90.113c6.964 12.696 2.867 28.262-9.012 35.223z" p-id="8701"></path><path d="M672.352 314.931H351.633c-14.747 0-26.622 12.285-26.622 27.441v108.953c0 15.157 11.875 27.446 26.622 27.446h320.719c14.746 0 26.625-12.289 26.625-27.446V342.372c0-15.156-11.879-27.441-26.625-27.441z" p-id="8702"></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/" aria-label="Java 知识体系"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span><!--]-->Java 知识体系<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java 基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-list" style=""></span><span class="vp-sidebar-title">Java 集合框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-proxy" style=""></span><span class="vp-sidebar-title">Java 多线程和并发</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-IO" style=""></span><span class="vp-sidebar-title">Java IO/NIO/AIO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java8 新特性</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">JVM 核心知识点</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB%E8%AF%A6%E8%A7%A3.html" aria-label="JVM 相关知识体系详解"><!---->JVM 相关知识体系详解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%B1%BB%E5%AD%97%E8%8A%82%E7%A0%81%E8%AF%A6%E8%A7%A3.html" aria-label="JVM 基础之类字节码详解"><!---->JVM 基础之类字节码详解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E5%A2%9E%E5%BC%BA%E6%8A%80%E6%9C%AF.html" aria-label="JVM 基础之字节码的增强技术"><!---->JVM 基础之字节码的增强技术<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E5%9F%BA%E7%A1%80%E4%B9%8BJava%20%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6.html" aria-label="JVM 基础之Java 类加载机制"><!---->JVM 基础之Java 类加载机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E5%9F%BA%E7%A1%80%E4%B9%8BJVM%20%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.html" aria-label="JVM 基础之JVM 内存结构"><!---->JVM 基础之JVM 内存结构<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E5%9F%BA%E7%A1%80%E4%B9%8B%20Java%20%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%BC%95%E5%85%A5.html" aria-label="JVM 基础之 Java 内存模型引入"><!---->JVM 基础之 Java 内存模型引入<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/JVM%20%E5%9F%BA%E7%A1%80%E4%B9%8B%20Java%20%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3.html" aria-label="JVM 基础之 Java 内存模型详解"><!---->JVM 基础之 Java 内存模型详解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/GC%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" aria-label="GC 垃圾回收基础知识"><!---->GC 垃圾回收基础知识<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/GC%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E4%B9%8BG1%E8%AF%A6%E8%A7%A3.html" aria-label="GC 垃圾回收器之G1详解"><!---->GC 垃圾回收器之G1详解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/GC%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E4%B9%8BZGC%E8%AF%A6%E8%A7%A3.html" aria-label="GC 垃圾回收器之ZGC详解"><!---->GC 垃圾回收器之ZGC详解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/GC%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E4%B9%8BCMS%20GC%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90%E4%B8%8E%E8%A7%A3%E5%86%B3.html" aria-label="GC 垃圾回收器之CMS GC问题分析与解决"><!---->GC 垃圾回收器之CMS GC问题分析与解决<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20JVM%20%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0.html" aria-label="调试排错之 JVM 调优参数"><!---->调试排错之 JVM 调优参数<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E4%B9%8B%E5%A0%86%E5%86%85%E5%AD%98%E5%92%8CMetaSpace%E5%86%85%E5%AD%98.html" aria-label="调试排错 Java 内存分析之堆内存和MetaSpace内存"><!---->调试排错 Java 内存分析之堆内存和MetaSpace内存<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E4%B9%8B%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98.html" aria-label="调试排错 Java 内存分析之堆外内存"><!---->调试排错 Java 内存分析之堆外内存<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E7%BA%BF%E7%A8%8B%E5%88%86%E6%9E%90%E4%B9%8B%E7%BA%BF%E7%A8%8BDump%E5%88%86%E6%9E%90.html" aria-label="调试排错 Java 线程分析之线程Dump分析"><!---->调试排错 Java 线程分析之线程Dump分析<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B9%8BLinux%E5%91%BD%E4%BB%A4.html" aria-label="调试排错 Java 问题排查之Linux命令"><!---->调试排错 Java 问题排查之Linux命令<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B9%8B%E5%B7%A5%E5%85%B7%E5%8D%95.html" aria-label="调试排错 Java 问题排查之工具单"><!---->调试排错 Java 问题排查之工具单<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B9%8BJVM%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7.html" aria-label="调试排错 Java 问题排查之JVM可视化工具"><!---->调试排错 Java 问题排查之JVM可视化工具<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B9%8B%E5%BA%94%E7%94%A8%E5%9C%A8%E7%BA%BF%E8%B0%83%E8%AF%95Arthas.html" aria-label="调试排错 Java 问题排查之应用在线调试Arthas"><!---->调试排错 Java 问题排查之应用在线调试Arthas<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B9%8B%E4%BD%BF%E7%94%A8IDEA%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95%E5%92%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95.html" aria-label="调试排错 Java 问题排查之使用IDEA本地调试和远程调试"><!---->调试排错 Java 问题排查之使用IDEA本地调试和远程调试<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86.html" aria-label="调试排错 Java动态调试技术原理"><!---->调试排错 Java动态调试技术原理<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">Java8 方法引</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->调试排错 Java 线程分析之线程Dump分析</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://cactusli.net" target="_blank" rel="noopener noreferrer">Cactus li</a></span><span property="author" content="Cactus li"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2024年3月17日</span><meta property="datePublished" content="2024-03-17T17:08:41.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E7%BA%BF%E7%A8%8B%E5%88%86%E6%9E%90%E4%B9%8B%E7%BA%BF%E7%A8%8BDump%E5%88%86%E6%9E%90.html" data-page-key="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E7%BA%BF%E7%A8%8B%E5%88%86%E6%9E%90%E4%B9%8B%E7%BA%BF%E7%A8%8BDump%E5%88%86%E6%9E%90.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 19 分钟</span><meta property="timeRequired" content="PT19M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">Java</span><!--]--><meta property="articleSection" content="Java"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">Java</span><span class="page-tag-item color7 clickable" role="navigation">JVM</span><!--]--><meta property="keywords" content="Java,JVM"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#thread-dump介绍"># Thread Dump介绍</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#什么是thread-dump"># 什么是Thread Dump</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thread-dump特点"># Thread Dump特点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thread-dump抓取"># Thread Dump抓取</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#thread-dump分析"># Thread Dump分析</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thread-dump信息"># Thread Dump信息</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thread状态分析"># Thread状态分析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#关键状态分析"># 关键状态分析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#关键状态示例"># 关键状态示例</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#案例分析"># 案例分析</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#问题场景"># 问题场景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#死锁"># 死锁</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#热锁"># 热锁</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jvm重要线程"># JVM重要线程</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#参考文章"># 参考文章</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><blockquote><p>Thread Dump是非常有用的诊断Java应用问题的工具。</p></blockquote><ul><li>调试排错 Java 线程分析之线程Dump分析 <ul><li>Thread Dump介绍 <ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFthread-dump">什么是Thread Dump</a></li><li><a href="#thread-dump%E7%89%B9%E7%82%B9">Thread Dump特点</a></li><li><a href="#thread-dump%E6%8A%93%E5%8F%96">Thread Dump抓取</a></li></ul></li><li>Thread Dump分析 <ul><li><a href="#thread-dump%E4%BF%A1%E6%81%AF">Thread Dump信息</a></li><li><a href="#thread%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90">Thread状态分析</a></li><li><a href="#%E5%85%B3%E9%94%AE%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90">关键状态分析</a></li><li><a href="#%E5%85%B3%E9%94%AE%E7%8A%B6%E6%80%81%E7%A4%BA%E4%BE%8B">关键状态示例</a></li></ul></li><li>案例分析 <ul><li><a href="#%E9%97%AE%E9%A2%98%E5%9C%BA%E6%99%AF">问题场景</a></li><li><a href="#%E6%AD%BB%E9%94%81">死锁</a></li><li><a href="#%E7%83%AD%E9%94%81">热锁</a></li></ul></li><li><a href="#jvm%E9%87%8D%E8%A6%81%E7%BA%BF%E7%A8%8B">JVM重要线程</a></li><li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0">参考文章</a></li></ul></li></ul><h2 id="thread-dump介绍" tabindex="-1"><a class="header-anchor" href="#thread-dump介绍"><span><a href="#thread-dump%E4%BB%8B%E7%BB%8D">#</a> Thread Dump介绍</span></a></h2><h3 id="什么是thread-dump" tabindex="-1"><a class="header-anchor" href="#什么是thread-dump"><span><a href="#%E4%BB%80%E4%B9%88%E6%98%AFthread-dump">#</a> 什么是Thread Dump</span></a></h3><p>Thread Dump是非常有用的诊断Java应用问题的工具。每一个Java虚拟机都有及时生成所有线程在某一点状态的thread-dump的能力，虽然各个 Java虚拟机打印的thread dump略有不同，但是 大多都提供了当前活动线程的快照，及JVM中所有Java线程的堆栈跟踪信息，堆栈信息一般包含完整的类名及所执行的方法，如果可能的话还有源代码的行数。</p><h3 id="thread-dump特点" tabindex="-1"><a class="header-anchor" href="#thread-dump特点"><span><a href="#thread-dump%E7%89%B9%E7%82%B9">#</a> Thread Dump特点</span></a></h3><ul><li>能在各种操作系统下使用；</li><li>能在各种Java应用服务器下使用；</li><li>能在生产环境下使用而不影响系统的性能；</li><li>能将问题直接定位到应用程序的代码行上；</li></ul><h3 id="thread-dump抓取" tabindex="-1"><a class="header-anchor" href="#thread-dump抓取"><span><a href="#thread-dump%E6%8A%93%E5%8F%96">#</a> Thread Dump抓取</span></a></h3><p>一般当服务器挂起，崩溃或者性能低下时，就需要抓取服务器的线程堆栈（Thread Dump）用于后续的分析。在实际运行中，往往一次 dump的信息，还不足以确认问题。为了反映线程状态的动态变化，需要接连多次做thread dump，每次间隔10-20s，建议至少产生三次 dump信息，如果每次 dump都指向同一个问题，我们才确定问题的典型性。</p><ul><li>操作系统命令获取ThreadDump</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">ps</span><span style="color:#98C379;"> –ef</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> java</span></span>
<span class="line"><span style="color:#56B6C2;">kill</span><span style="color:#D19A66;"> -3</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">pi</span><span style="color:#ABB2BF;">d&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：</p><blockquote><p>一定要谨慎, 一步不慎就可能让服务器进程被杀死。kill -9 命令会杀死进程。</p></blockquote><ul><li>JVM 自带的工具获取线程堆栈</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">jps</span><span style="color:#98C379;"> 或</span><span style="color:#98C379;"> ps</span><span style="color:#98C379;"> –ef</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> java</span><span style="color:#98C379;"> （获取PID）</span></span>
<span class="line"><span style="color:#61AFEF;">jstack</span><span style="color:#ABB2BF;"> [-l </span><span style="color:#98C379;">]</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">pi</span><span style="color:#ABB2BF;">d&gt; | </span><span style="color:#61AFEF;">tee</span><span style="color:#D19A66;"> -a</span><span style="color:#98C379;"> jstack.log（获取ThreadDump）</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="thread-dump分析" tabindex="-1"><a class="header-anchor" href="#thread-dump分析"><span><a href="#thread-dump%E5%88%86%E6%9E%90">#</a> Thread Dump分析</span></a></h2><h3 id="thread-dump信息" tabindex="-1"><a class="header-anchor" href="#thread-dump信息"><span><a href="#thread-dump%E4%BF%A1%E6%81%AF">#</a> Thread Dump信息</span></a></h3><ul><li>头部信息：时间，JVM信息</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">2011-11-02</span><span style="color:#98C379;"> 19:05:06</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#61AFEF;">Full</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> dump</span><span style="color:#98C379;"> Java</span><span style="color:#98C379;"> HotSpot</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">TM</span><span style="color:#ABB2BF;">) </span><span style="color:#98C379;">Server</span><span style="color:#98C379;"> VM</span><span style="color:#ABB2BF;"> (16.3-b01 </span><span style="color:#98C379;">mixed</span><span style="color:#98C379;"> mode</span><span style="color:#ABB2BF;">):</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>线程INFO信息块：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">1.</span><span style="color:#98C379;"> &quot;Timer-0&quot;</span><span style="color:#98C379;"> daemon</span><span style="color:#98C379;"> prio=</span><span style="color:#D19A66;">10</span><span style="color:#98C379;"> tid=</span><span style="color:#D19A66;">0xac190c00</span><span style="color:#98C379;"> nid=</span><span style="color:#D19A66;">0xaef</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> Object.wait</span><span style="color:#ABB2BF;">() [0xae77d000] </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 线程名称：Timer-0；线程类型：daemon；优先级: 10，默认是5；</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># JVM线程id：tid=0xac190c00，JVM内部线程的唯一标识（通过java.lang.Thread.getId()获取，通常用自增方式实现）。</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 对应系统线程id（NativeThread ID）：nid=0xaef，和top命令查看的线程pid对应，不过一个是10进制，一个是16进制。（通过命令：top -H -p pid，可以查看该进程的所有线程信息）</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 线程状态：in Object.wait()；</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 起始栈地址：[0xae77d000]，对象的内存地址，通过JVM内存查看工具，能够看出线程是在哪儿个对象上等待；</span></span>
<span class="line"><span style="color:#61AFEF;">2.</span><span style="color:#98C379;">  java.lang.Thread.State:</span><span style="color:#98C379;"> TIMED_WAITING</span><span style="color:#ABB2BF;"> (on </span><span style="color:#98C379;">object</span><span style="color:#98C379;"> monitor</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">3.</span><span style="color:#98C379;">  at</span><span style="color:#98C379;"> java.lang.Object.wait</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Native</span><span style="color:#98C379;"> Method</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">4.</span><span style="color:#D19A66;">  -waiting</span><span style="color:#98C379;"> on</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xb3885f6</span><span style="color:#ABB2BF;">0&gt; (a </span><span style="color:#98C379;">java.util.TaskQueue</span><span style="color:#ABB2BF;">)     </span><span style="color:#7F848E;font-style:italic;"># 继续wait </span></span>
<span class="line"><span style="color:#61AFEF;">5.</span><span style="color:#98C379;">  at</span><span style="color:#98C379;"> java.util.TimerThread.mainLoop</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Timer.java:509</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">6.</span><span style="color:#D19A66;">  -locked</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xb3885f6</span><span style="color:#ABB2BF;">0&gt; (a </span><span style="color:#98C379;">java.util.TaskQueue</span><span style="color:#ABB2BF;">)         </span><span style="color:#7F848E;font-style:italic;"># 已经locked</span></span>
<span class="line"><span style="color:#61AFEF;">7.</span><span style="color:#98C379;">  at</span><span style="color:#98C379;"> java.util.TimerThread.run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Timer.java:462</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">Java</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> statck</span><span style="color:#98C379;"> trace：是上面2-7行的信息。到目前为止这是最重要的数据，Java</span><span style="color:#98C379;"> stack</span><span style="color:#98C379;"> trace提供了大部分信息来精确定位问题根源。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Java thread statck trace详解：</li></ul><p><strong>堆栈信息应该逆向解读</strong>：程序先执行的是第7行，然后是第6行，依次类推。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">-</span><span style="color:#98C379;"> locked</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xb3885f6</span><span style="color:#ABB2BF;">0&gt; (a </span><span style="color:#98C379;">java.util.ArrayList</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#61AFEF;">-</span><span style="color:#98C379;"> waiting</span><span style="color:#98C379;"> on</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xb3885f6</span><span style="color:#ABB2BF;">0&gt; (a </span><span style="color:#98C379;">java.util.ArrayList</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>也就是说对象先上锁，锁住对象0xb3885f60，然后释放该对象锁，进入waiting状态</strong>。为啥会出现这样的情况呢？看看下面的java代码示例，就会明白：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">synchronized</span><span style="color:#E06C75;">(obj) {  </span></span>
<span class="line"><span style="color:#ABB2BF;">   .........</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E5C07B;">   obj</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">();</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">   .........</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上，线程的执行过程，先用 <code>synchronized</code> 获得了这个对象的 Monitor（对应于 <code>locked &lt;0xb3885f60&gt;</code> ）。当执行到 <code>obj.wait()</code>，线程即放弃了 Monitor的所有权，进入 “wait set”队列（对应于 <code>waiting on &lt;0xb3885f60&gt;</code> ）。</p><p><strong>在堆栈的第一行信息中，进一步标明了线程在代码级的状态</strong>，例如：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">java.lang.Thread.State:</span><span style="color:#98C379;"> TIMED_WAITING</span><span style="color:#ABB2BF;"> (parking)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>解释如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">|</span><span style="color:#61AFEF;">blocked</span><span style="color:#ABB2BF;">|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">This</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> tried</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> enter</span><span style="color:#98C379;"> asynchronized</span><span style="color:#98C379;"> block,</span><span style="color:#98C379;"> but</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> lock</span><span style="color:#98C379;"> was</span><span style="color:#98C379;"> taken</span><span style="color:#98C379;"> by</span><span style="color:#98C379;"> another</span><span style="color:#98C379;"> thread.</span><span style="color:#98C379;"> This</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> isblocked</span><span style="color:#98C379;"> until</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> lock</span><span style="color:#98C379;"> gets</span><span style="color:#98C379;"> released.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">|</span><span style="color:#61AFEF;">blocked</span><span style="color:#ABB2BF;"> (on </span><span style="color:#98C379;">thin</span><span style="color:#98C379;"> lock</span><span style="color:#ABB2BF;">)|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">This</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> same</span><span style="color:#98C379;"> state</span><span style="color:#98C379;"> asblocked,</span><span style="color:#98C379;"> but</span><span style="color:#98C379;"> the</span><span style="color:#98C379;"> lock</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> question</span><span style="color:#98C379;"> is</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> thin</span><span style="color:#98C379;"> lock.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">|</span><span style="color:#61AFEF;">waiting</span><span style="color:#ABB2BF;">|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">This</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> calledObject.wait</span><span style="color:#ABB2BF;">() </span><span style="color:#98C379;">on</span><span style="color:#98C379;"> an</span><span style="color:#98C379;"> object.</span><span style="color:#98C379;"> The</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> will</span><span style="color:#98C379;"> remain</span><span style="color:#98C379;"> there</span><span style="color:#98C379;"> until</span><span style="color:#98C379;"> some</span><span style="color:#98C379;"> otherthread</span><span style="color:#98C379;"> sends</span><span style="color:#98C379;"> a</span><span style="color:#98C379;"> notification</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> that</span><span style="color:#98C379;"> object.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">|</span><span style="color:#61AFEF;">sleeping</span><span style="color:#ABB2BF;">|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">This</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> calledjava.lang.Thread.sleep</span><span style="color:#ABB2BF;">()</span><span style="color:#98C379;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">|</span><span style="color:#61AFEF;">parked</span><span style="color:#ABB2BF;">|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">This</span><span style="color:#98C379;"> thread</span><span style="color:#98C379;"> calledjava.util.concurrent.locks.LockSupport.park</span><span style="color:#ABB2BF;">()</span><span style="color:#98C379;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">|</span><span style="color:#61AFEF;">suspended</span><span style="color:#ABB2BF;">|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">&gt; </span><span style="color:#61AFEF;">The</span><span style="color:#98C379;"> thread&#39;s execution wassuspended by java.lang.Thread.suspend() or a JVMTI agent call.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="thread状态分析" tabindex="-1"><a class="header-anchor" href="#thread状态分析"><span><a href="#thread%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90">#</a> Thread状态分析</span></a></h3><p>线程的状态是一个很重要的东西，因此thread dump中会显示这些状态，通过对这些状态的分析，能够得出线程的运行状况，进而发现可能存在的问题。<strong>线程的状态在Thread.State这个枚举类型中定义</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> enum</span><span style="color:#E5C07B;"> State</span><span style="color:#E06C75;">   </span></span>
<span class="line"><span style="color:#E06C75;">{  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       /** </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * Thread state for a thread which has not yet started. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        */</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#D19A66;">       NEW</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">         </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       /** </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * Thread state for a runnable thread.  A thread in the runnable </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * state is executing in the Java virtual machine but it may </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * be waiting for other resources from the operating system </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * such as processor. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        */</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#D19A66;">       RUNNABLE</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">         </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       /** </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * Thread state for a thread blocked waiting for a monitor lock. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * A thread in the blocked state is waiting for a monitor lock </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * to enter a synchronized block/method or  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * reenter a synchronized block/method after calling </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * {</span><span style="color:#C678DD;font-style:italic;">@link</span><span style="color:#E5C07B;font-style:italic;"> Object</span><span style="color:#7F848E;font-style:italic;">#</span><span style="color:#E06C75;font-style:italic;">wait()</span><span style="color:#7F848E;font-style:italic;"> Object.wait}. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        */</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#D19A66;">       BLOCKED</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       /** </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * Thread state for a waiting thread. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * A thread is in the waiting state due to calling one of the  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * following methods: </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * &lt;ul&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{</span><span style="color:#C678DD;font-style:italic;">@link</span><span style="color:#E5C07B;font-style:italic;"> Object</span><span style="color:#7F848E;font-style:italic;">#</span><span style="color:#E06C75;font-style:italic;">wait()</span><span style="color:#7F848E;font-style:italic;"> Object.wait} with no timeout&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{</span><span style="color:#C678DD;font-style:italic;">@link</span><span style="color:#7F848E;font-style:italic;"> #</span><span style="color:#E06C75;font-style:italic;">join()</span><span style="color:#7F848E;font-style:italic;"> Thread.join} with no timeout&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{</span><span style="color:#C678DD;font-style:italic;">@link</span><span style="color:#E5C07B;font-style:italic;"> LockSupport</span><span style="color:#7F848E;font-style:italic;">#</span><span style="color:#E06C75;font-style:italic;">park()</span><span style="color:#7F848E;font-style:italic;"> LockSupport.park}&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * &lt;/ul&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * &lt;p&gt;A thread in the waiting state is waiting for another thread to </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * perform a particular action.   </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * on an object is waiting for another thread to call  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt;  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * is waiting for a specified thread to terminate. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        */</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#D19A66;">       WAITING</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">         </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       /** </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * Thread state for a waiting thread with a specified waiting time. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * A thread is in the timed waiting state due to calling one of  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * the following methods with a specified positive waiting time: </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * &lt;ul&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{@link #sleep Thread.sleep}&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{</span><span style="color:#C678DD;font-style:italic;">@link</span><span style="color:#E5C07B;font-style:italic;"> Object</span><span style="color:#7F848E;font-style:italic;">#</span><span style="color:#E06C75;font-style:italic;">wait(long)</span><span style="color:#7F848E;font-style:italic;"> Object.wait} with timeout&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{</span><span style="color:#C678DD;font-style:italic;">@link</span><span style="color:#7F848E;font-style:italic;"> #</span><span style="color:#E06C75;font-style:italic;">join(long)</span><span style="color:#7F848E;font-style:italic;"> Thread.join} with timeout&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{@link LockSupport#parkNanos LockSupport.parkNanos}&lt;/li&gt;  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        *   &lt;li&gt;{@link LockSupport#parkUntil LockSupport.parkUntil}&lt;/li&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * &lt;/ul&gt; </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        */</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#D19A66;">       TIMED_WAITING</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">       /** </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * Thread state for a terminated thread. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        * The thread has completed execution. </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        */</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#D19A66;">       TERMINATED</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>NEW：</li></ul><p>每一个线程，在堆内存中都有一个对应的Thread对象。Thread t = new Thread();当刚刚在堆内存中创建Thread对象，还没有调用t.start()方法之前，线程就处在NEW状态。在这个状态上，线程与普通的java对象没有什么区别，就仅仅是一个堆内存中的对象。</p><ul><li>RUNNABLE：</li></ul><p>该状态表示线程具备所有运行条件，在运行队列中准备操作系统的调度，或者正在运行。 这个状态的线程比较正常，但如果线程长时间停留在在这个状态就不正常了，这说明线程运行的时间很长（存在性能问题），或者是线程一直得不得执行的机会（存在线程饥饿的问题）。</p><ul><li>BLOCKED：</li></ul><p>线程正在等待获取java对象的监视器(也叫内置锁)，即线程正在等待进入由synchronized保护的方法或者代码块。synchronized用来保证原子性，任意时刻最多只能由一个线程进入该临界区域，其他线程只能排队等待。</p><ul><li>WAITING：</li></ul><p>处在该线程的状态，正在等待某个事件的发生，只有特定的条件满足，才能获得执行机会。而产生这个特定的事件，通常都是另一个线程。也就是说，如果不发生特定的事件，那么处在该状态的线程一直等待，不能获取执行的机会。比如：</p><p>A线程调用了obj对象的obj.wait()方法，如果没有线程调用obj.notify或obj.notifyAll，那么A线程就没有办法恢复运行； 如果A线程调用了LockSupport.park()，没有别的线程调用LockSupport.unpark(A)，那么A没有办法恢复运行。 TIMED_WAITING：</p><p>J.U.C中很多与线程相关类，都提供了限时版本和不限时版本的API。TIMED_WAITING意味着线程调用了限时版本的API，正在等待时间流逝。当等待时间过去后，线程一样可以恢复运行。如果线程进入了WAITING状态，一定要特定的事件发生才能恢复运行；而处在TIMED_WAITING的线程，如果特定的事件发生或者是时间流逝完毕，都会恢复运行。</p><ul><li>TERMINATED：</li></ul><p>线程执行完毕，执行完run方法正常返回，或者抛出了运行时异常而结束，线程都会停留在这个状态。这个时候线程只剩下Thread对象了，没有什么用了。</p><h3 id="关键状态分析" tabindex="-1"><a class="header-anchor" href="#关键状态分析"><span><a href="#%E5%85%B3%E9%94%AE%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90">#</a> 关键状态分析</span></a></h3><ul><li><strong>Wait on condition</strong>：The thread is either sleeping or waiting to be notified by another thread.</li></ul><p>该状态说明它在等待另一个条件的发生，来把自己唤醒，或者干脆它是调用了 sleep(n)。</p><p>此时线程状态大致为以下几种：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">java.lang.Thread.State:</span><span style="color:#98C379;"> WAITING</span><span style="color:#ABB2BF;"> (parking)：一直等那个条件发生；</span></span>
<span class="line"><span style="color:#61AFEF;">java.lang.Thread.State:</span><span style="color:#98C379;"> TIMED_WAITING</span><span style="color:#ABB2BF;"> (parking或sleeping)：定时的，那个条件不到来，也将定时唤醒自己。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Waiting for Monitor Entry 和 in Object.wait()</strong>：The thread is waiting to get the lock for an object (some other thread may be holding the lock). This happens if two or more threads try to execute synchronized code. Note that the lock is always for an object and not for individual methods.</li></ul><p>在多线程的JAVA程序中，实现线程之间的同步，就要说说 Monitor。<strong>Monitor是Java中用以实现线程之间的互斥与协作的主要手段，它可以看成是对象或者Class的锁。每一个对象都有，也仅有一个 Monitor</strong> 。下面这个图，描述了线程和 Monitor之间关系，以及线程的状态转换图：</p><figure><img src="https://lixuanfengs.github.io/blog-images/vp/Java/java-jvm-debug-1.png" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><p>如上图，每个Monitor在某个时刻，只能被一个线程拥有，<strong>该线程就是 “ActiveThread”，而其它线程都是 “Waiting Thread”，分别在两个队列“Entry Set”和“Wait Set”里等候</strong>。在“Entry Set”中等待的线程状态是“Waiting for monitor entry”，而在“Wait Set”中等待的线程状态是“in Object.wait()”。</p><p>先看“Entry Set”里面的线程。我们称被 synchronized保护起来的代码段为临界区。<strong>当一个线程申请进入临界区时，它就进入了“Entry Set”队列</strong>。对应的 code就像：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">synchronized</span><span style="color:#E06C75;">(obj) {</span></span>
<span class="line"><span style="color:#ABB2BF;">   .........</span></span>
<span class="line"><span style="color:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时有两种可能性：</p><ul><li>该 monitor不被其它线程拥有， Entry Set里面也没有其它等待线程。本线程即成为相应类或者对象的 Monitor的 Owner，执行临界区的代码。</li><li>该 monitor被其它线程拥有，本线程在 Entry Set队列中等待。</li></ul><p>在第一种情况下，线程将处于 “Runnable”的状态，而第二种情况下，线程 DUMP会显示处于 “waiting for monitor entry”。如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">&quot;Thread-0&quot;</span><span style="color:#98C379;"> prio=</span><span style="color:#D19A66;">10</span><span style="color:#98C379;"> tid=</span><span style="color:#D19A66;">0x08222eb0</span><span style="color:#98C379;"> nid=</span><span style="color:#D19A66;">0x9</span><span style="color:#98C379;"> waiting</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> monitor</span><span style="color:#98C379;"> entry</span><span style="color:#ABB2BF;"> [0xf927b000..0xf927bdb8] </span></span>
<span class="line"><span style="color:#61AFEF;">at</span><span style="color:#98C379;"> testthread.WaitThread.run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">WaitThread.java:39</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;">-</span><span style="color:#98C379;"> waiting</span><span style="color:#98C379;"> to</span><span style="color:#98C379;"> lock</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xef63bf0</span><span style="color:#ABB2BF;">8&gt; (a </span><span style="color:#98C379;">java.lang.Object</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;">-</span><span style="color:#98C379;"> locked</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xef63beb</span><span style="color:#ABB2BF;">8&gt; (a </span><span style="color:#98C379;">java.util.ArrayList</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;">at</span><span style="color:#98C379;"> java.lang.Thread.run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Thread.java:595</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>临界区的设置，是为了保证其内部的代码执行的原子性和完整性</strong>。但是因为临界区在任何时间只允许线程串行通过，这和我们多线程的程序的初衷是相反的。<strong>如果在多线程的程序中，大量使用 synchronized，或者不适当的使用了它，会造成大量线程在临界区的入口等待，造成系统的性能大幅下降</strong>。如果在线程 DUMP中发现了这个情况，应该审查源码，改进程序。</p><p>再看“Wait Set”里面的线程。<strong>当线程获得了 Monitor，进入了临界区之后，如果发现线程继续运行的条件没有满足，它则调用对象（一般就是被 synchronized 的对象）的 wait() 方法，放弃 Monitor，进入 “Wait Set”队列。只有当别的线程在该对象上调用了 notify() 或者 notifyAll()，“Wait Set”队列中线程才得到机会去竞争</strong>，但是只有一个线程获得对象的Monitor，恢复到运行态。在 “Wait Set”中的线程， DUMP中表现为： in Object.wait()。如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">&quot;Thread-1&quot;</span><span style="color:#98C379;"> prio=</span><span style="color:#D19A66;">10</span><span style="color:#98C379;"> tid=</span><span style="color:#D19A66;">0x08223250</span><span style="color:#98C379;"> nid=</span><span style="color:#D19A66;">0xa</span><span style="color:#98C379;"> in</span><span style="color:#98C379;"> Object.wait</span><span style="color:#ABB2BF;">() [0xef47a000..0xef47aa38] </span></span>
<span class="line"><span style="color:#61AFEF;"> at</span><span style="color:#98C379;"> java.lang.Object.wait</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Native</span><span style="color:#98C379;"> Method</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;"> -</span><span style="color:#98C379;"> waiting</span><span style="color:#98C379;"> on</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xef63beb</span><span style="color:#ABB2BF;">8&gt; (a </span><span style="color:#98C379;">java.util.ArrayList</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;"> at</span><span style="color:#98C379;"> java.lang.Object.wait</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Object.java:474</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;"> at</span><span style="color:#98C379;"> testthread.MyWaitThread.run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">MyWaitThread.java:40</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;"> -</span><span style="color:#98C379;"> locked</span><span style="color:#ABB2BF;"> &lt;</span><span style="color:#98C379;">0xef63beb</span><span style="color:#ABB2BF;">8&gt; (a </span><span style="color:#98C379;">java.util.ArrayList</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;"> at</span><span style="color:#98C379;"> java.lang.Thread.run</span><span style="color:#ABB2BF;">(</span><span style="color:#61AFEF;">Thread.java:595</span><span style="color:#ABB2BF;">) </span></span>
<span class="line"><span style="color:#61AFEF;">综上，一般CPU很忙时，则关注runnable的线程，CPU很闲时，则关注waiting</span><span style="color:#98C379;"> for</span><span style="color:#98C379;"> monitor</span><span style="color:#98C379;"> entry的线程。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>JDK 5.0 的 Lock</strong></li></ul><p>上面提到如果 synchronized和 monitor机制运用不当，可能会造成多线程程序的性能问题。在 JDK 5.0中，引入了 Lock机制，从而使开发者能更灵活的开发高性能的并发多线程程序，可以替代以往 JDK中的 synchronized和 Monitor的 机制。但是，<strong>要注意的是，因为 Lock类只是一个普通类，JVM无从得知 Lock对象的占用情况，所以在线程 DUMP中，也不会包含关于 Lock的信息</strong>， 关于死锁等问题，就不如用 synchronized的编程方式容易识别。</p><h3 id="关键状态示例" tabindex="-1"><a class="header-anchor" href="#关键状态示例"><span><a href="#%E5%85%B3%E9%94%AE%E7%8A%B6%E6%80%81%E7%A4%BA%E4%BE%8B">#</a> 关键状态示例</span></a></h3><ul><li><strong>显示BLOCKED状态</strong></li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">package</span><span style="color:#C678DD;"> jstack</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> BlockedState</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">    private</span><span style="color:#C678DD;"> static</span><span style="color:#E5C07B;"> Object</span><span style="color:#E06C75;"> object </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Object</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">    </span></span>
<span class="line"><span style="color:#C678DD;">    public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">    {  </span></span>
<span class="line"><span style="color:#E5C07B;">        Runnable</span><span style="color:#E06C75;"> task</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Runnable</span><span style="color:#ABB2BF;">() {  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            @</span><span style="color:#E5C07B;">Override</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;">            public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> run</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">            {  </span></span>
<span class="line"><span style="color:#C678DD;">                synchronized</span><span style="color:#ABB2BF;"> (object)  </span></span>
<span class="line"><span style="color:#ABB2BF;">                {  </span></span>
<span class="line"><span style="color:#C678DD;">                    long</span><span style="color:#E06C75;"> begin</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> System</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;">                    long</span><span style="color:#E06C75;"> end</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> System</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    // 让线程运行5分钟,会一直持有object的监视器  </span></span>
<span class="line"><span style="color:#C678DD;">                    while</span><span style="color:#ABB2BF;"> ((end </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> begin) </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;"> 5</span><span style="color:#56B6C2;"> *</span><span style="color:#D19A66;"> 60</span><span style="color:#56B6C2;"> *</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#ABB2BF;">                    {  </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">                    }  </span></span>
<span class="line"><span style="color:#ABB2BF;">                }  </span></span>
<span class="line"><span style="color:#ABB2BF;">            }  </span></span>
<span class="line"><span style="color:#ABB2BF;">        };  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        new</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(task, </span><span style="color:#98C379;">&quot;t1&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#C678DD;">        new</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(task, </span><span style="color:#98C379;">&quot;t2&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先获取object的线程会执行5分钟，<strong>这5分钟内会一直持有object的监视器，另一个线程无法执行处在BLOCKED状态</strong>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E5C07B;">Full</span><span style="color:#E06C75;"> thread dump </span><span style="color:#E5C07B;">Java</span><span style="color:#61AFEF;"> HotSpot</span><span style="color:#E06C75;">(TM) </span><span style="color:#E5C07B;">Server</span><span style="color:#61AFEF;"> VM</span><span style="color:#E06C75;"> (</span><span style="color:#D19A66;">20.12</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">b01 mixed mode)</span><span style="color:#C678DD;">:</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#98C379;">&quot;DestroyJavaVM&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x00856c00</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x1314</span><span style="color:#E06C75;"> waiting on condition [</span><span style="color:#D19A66;">0x00000000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#E5C07B;"> RUNNABLE</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;t2&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x27d7a800</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x1350</span><span style="color:#E06C75;"> waiting </span><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> monitor entry [</span><span style="color:#D19A66;">0x2833f000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#61AFEF;"> BLOCKED</span><span style="color:#E06C75;"> (on object monitor)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">jstack</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">BlockedState$1</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BlockedState</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">17</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> waiting to lock </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x1cfcdc00</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">662</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;t1&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x27d79400</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x1338</span><span style="color:#E06C75;"> runnable [</span><span style="color:#D19A66;">0x282ef000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;"> java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#E5C07B;"> RUNNABLE</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">jstack</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">BlockedState$1</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">BlockedState</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">22</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> locked </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x1cfcdc00</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">662</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过thread dump可以看到：<strong>t2线程确实处在BLOCKED (on object monitor)。waiting for monitor entry 等待进入synchronized保护的区域</strong>。</p><ul><li><strong>显示WAITING状态</strong></li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">package</span><span style="color:#C678DD;"> jstack</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> WaitingState</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">    private</span><span style="color:#C678DD;"> static</span><span style="color:#E5C07B;"> Object</span><span style="color:#E06C75;"> object </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Object</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">    {  </span></span>
<span class="line"><span style="color:#E5C07B;">        Runnable</span><span style="color:#E06C75;"> task</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Runnable</span><span style="color:#ABB2BF;">() {  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            @</span><span style="color:#E5C07B;">Override</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;">            public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> run</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">            {  </span></span>
<span class="line"><span style="color:#C678DD;">                synchronized</span><span style="color:#ABB2BF;"> (object)  </span></span>
<span class="line"><span style="color:#ABB2BF;">                {  </span></span>
<span class="line"><span style="color:#C678DD;">                    long</span><span style="color:#E06C75;"> begin</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> System</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#C678DD;">                    long</span><span style="color:#E06C75;"> end</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> System</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                    // 让线程运行5分钟,会一直持有object的监视器  </span></span>
<span class="line"><span style="color:#C678DD;">                    while</span><span style="color:#ABB2BF;"> ((end </span><span style="color:#56B6C2;">-</span><span style="color:#ABB2BF;"> begin) </span><span style="color:#56B6C2;">&lt;=</span><span style="color:#D19A66;"> 5</span><span style="color:#56B6C2;"> *</span><span style="color:#D19A66;"> 60</span><span style="color:#56B6C2;"> *</span><span style="color:#D19A66;"> 1000</span><span style="color:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#ABB2BF;">                    {  </span></span>
<span class="line"><span style="color:#C678DD;">                        try</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">                        {  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                            // 进入等待的同时,会进入释放监视器  </span></span>
<span class="line"><span style="color:#E5C07B;">                            object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">                        } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">InterruptedException</span><span style="color:#E06C75;font-style:italic;"> e</span><span style="color:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#ABB2BF;">                        {  </span></span>
<span class="line"><span style="color:#E5C07B;">                            e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">                        }  </span></span>
<span class="line"><span style="color:#ABB2BF;">                    }  </span></span>
<span class="line"><span style="color:#ABB2BF;">                }  </span></span>
<span class="line"><span style="color:#ABB2BF;">            }  </span></span>
<span class="line"><span style="color:#ABB2BF;">        };  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">        new</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(task, </span><span style="color:#98C379;">&quot;t1&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#C678DD;">        new</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(task, </span><span style="color:#98C379;">&quot;t2&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">}</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E5C07B;">Full</span><span style="color:#E06C75;"> thread dump </span><span style="color:#E5C07B;">Java</span><span style="color:#61AFEF;"> HotSpot</span><span style="color:#E06C75;">(TM) </span><span style="color:#E5C07B;">Server</span><span style="color:#61AFEF;"> VM</span><span style="color:#E06C75;"> (</span><span style="color:#D19A66;">20.12</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">b01 mixed mode)</span><span style="color:#C678DD;">:</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;DestroyJavaVM&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x00856c00</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x1734</span><span style="color:#E06C75;"> waiting on condition [</span><span style="color:#D19A66;">0x00000000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#E5C07B;"> RUNNABLE</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;t2&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x27d7e000</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x17f4</span><span style="color:#E06C75;"> in </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;"> [</span><span style="color:#D19A66;">0x2833f000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#61AFEF;"> WAITING</span><span style="color:#E06C75;"> (on object monitor)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Native</span><span style="color:#ABB2BF;"> Method)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> waiting on </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x1cfcdc00</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">485</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">jstack</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">WaitingState$1</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">WaitingState</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">26</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> locked </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x1cfcdc00</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">662</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;t1&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x27d7d400</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x17f0</span><span style="color:#E06C75;"> in </span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">()</span><span style="color:#E06C75;"> [</span><span style="color:#D19A66;">0x282ef000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#61AFEF;"> WAITING</span><span style="color:#E06C75;"> (on object monitor)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Native</span><span style="color:#ABB2BF;"> Method)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> waiting on </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x1cfcdc00</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">wait</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Object</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">485</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">jstack</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">WaitingState$1</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">WaitingState</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">26</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> locked </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x1cfcdc00</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">662</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以发现t1和t2都处在WAITING (on object monitor)，进入等待状态的原因是调用了in Object.wait()。通过J.U.C包下的锁和条件队列，也是这个效果，大家可以自己实践下。</p><ul><li><strong>显示TIMED_WAITING状态</strong></li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">package</span><span style="color:#C678DD;"> jstack</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> java.util.concurrent.TimeUnit</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> java.util.concurrent.locks.Condition</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> java.util.concurrent.locks.Lock</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> java.util.concurrent.locks.ReentrantLock</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> TimedWaitingState</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">{</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // java的显示锁,类似java对象内置的监视器  </span></span>
<span class="line"><span style="color:#C678DD;">    private</span><span style="color:#C678DD;"> static</span><span style="color:#E5C07B;"> Lock</span><span style="color:#E06C75;"> lock </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // 锁关联的条件队列(类似于object.wait)  </span></span>
<span class="line"><span style="color:#C678DD;">    private</span><span style="color:#C678DD;"> static</span><span style="color:#E5C07B;"> Condition</span><span style="color:#E06C75;"> condition </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> lock</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newCondition</span><span style="color:#ABB2BF;">();</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#61AFEF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">    {  </span></span>
<span class="line"><span style="color:#E5C07B;">        Runnable</span><span style="color:#E06C75;"> task</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> Runnable</span><span style="color:#ABB2BF;">() {  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">            @</span><span style="color:#E5C07B;">Override</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;">            public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> run</span><span style="color:#ABB2BF;">()</span><span style="color:#61AFEF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">            {  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                // 加锁,进入临界区  </span></span>
<span class="line"><span style="color:#E5C07B;">                lock</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">lock</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;">                try</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">                {  </span></span>
<span class="line"><span style="color:#E5C07B;">                    condition</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">await</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">TimeUnit</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">MINUTES</span><span style="color:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#ABB2BF;">                } </span><span style="color:#C678DD;">catch</span><span style="color:#ABB2BF;"> (</span><span style="color:#E5C07B;">InterruptedException</span><span style="color:#E06C75;font-style:italic;"> e</span><span style="color:#ABB2BF;">)  </span></span>
<span class="line"><span style="color:#ABB2BF;">                {  </span></span>
<span class="line"><span style="color:#E5C07B;">                    e</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">                }  </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">                // 解锁,退出临界区  </span></span>
<span class="line"><span style="color:#E5C07B;">                lock</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">unlock</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">            }  </span></span>
<span class="line"><span style="color:#ABB2BF;">        };  </span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;">        new</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(task, </span><span style="color:#98C379;">&quot;t1&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#C678DD;">        new</span><span style="color:#61AFEF;"> Thread</span><span style="color:#ABB2BF;">(task, </span><span style="color:#98C379;">&quot;t2&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">start</span><span style="color:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;">}</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E5C07B;">Full</span><span style="color:#E06C75;"> thread dump </span><span style="color:#E5C07B;">Java</span><span style="color:#61AFEF;"> HotSpot</span><span style="color:#E06C75;">(TM) </span><span style="color:#E5C07B;">Server</span><span style="color:#61AFEF;"> VM</span><span style="color:#E06C75;"> (</span><span style="color:#D19A66;">20.12</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">b01 mixed mode)</span><span style="color:#C678DD;">:</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;DestroyJavaVM&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x00856c00</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x169c</span><span style="color:#E06C75;"> waiting on condition [</span><span style="color:#D19A66;">0x00000000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#E5C07B;"> RUNNABLE</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;t2&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x27d7d800</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0xc30</span><span style="color:#E06C75;"> waiting on condition [</span><span style="color:#D19A66;">0x2833f000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#61AFEF;"> TIMED_WAITING</span><span style="color:#E06C75;"> (parking)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">sun</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">misc</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Unsafe</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">park</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Native</span><span style="color:#ABB2BF;"> Method)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> parking to wait </span><span style="color:#C678DD;">for</span><span style="color:#56B6C2;">  &lt;</span><span style="color:#D19A66;">0x1cfce5b8</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">util</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">concurrent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">locks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">AbstractQueuedSynchronizer$ConditionObject</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">util</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">concurrent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">locks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">LockSupport</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parkNanos</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">LockSupport</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">196</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">util</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">concurrent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">locks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">AbstractQueuedSynchronizer$ConditionObject</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">await</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">AbstractQueuedSynchronizer</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">2116</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">jstack</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TimedWaitingState$1</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">TimedWaitingState</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">28</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">662</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;t1&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">6</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x280d0c00</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x16e0</span><span style="color:#E06C75;"> waiting on condition [</span><span style="color:#D19A66;">0x282ef000</span><span style="color:#E06C75;">]  </span></span>
<span class="line"><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">State</span><span style="color:#C678DD;">:</span><span style="color:#61AFEF;"> TIMED_WAITING</span><span style="color:#E06C75;"> (parking)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">sun</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">misc</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Unsafe</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">park</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Native</span><span style="color:#ABB2BF;"> Method)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#56B6C2;">     -</span><span style="color:#E06C75;"> parking to wait </span><span style="color:#C678DD;">for</span><span style="color:#56B6C2;">  &lt;</span><span style="color:#D19A66;">0x1cfce5b8</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">util</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">concurrent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">locks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">AbstractQueuedSynchronizer$ConditionObject</span><span style="color:#E06C75;">)  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">util</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">concurrent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">locks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">LockSupport</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">parkNanos</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">LockSupport</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">196</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">util</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">concurrent</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">locks</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">AbstractQueuedSynchronizer$ConditionObject</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">await</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">AbstractQueuedSynchronizer</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">2116</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">jstack</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TimedWaitingState$1</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">TimedWaitingState</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">28</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;">     at </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">Thread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">662</span><span style="color:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到t1和t2线程都处在java.lang.Thread.State: TIMED_WAITING (parking)，这个parking代表是调用的JUC下的工具类，而不是java默认的监视器。</p><h2 id="案例分析" tabindex="-1"><a class="header-anchor" href="#案例分析"><span><a href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">#</a> 案例分析</span></a></h2><h3 id="问题场景" tabindex="-1"><a class="header-anchor" href="#问题场景"><span><a href="#%E9%97%AE%E9%A2%98%E5%9C%BA%E6%99%AF">#</a> 问题场景</span></a></h3><ul><li><strong>CPU飙高，load高，响应很慢</strong><ol><li>一个请求过程中多次dump；</li><li>对比多次dump文件的runnable线程，如果执行的方法有比较大变化，说明比较正常。如果在执行同一个方法，就有一些问题了；</li></ol></li><li><strong>查找占用CPU最多的线程</strong><ol><li>使用命令：top -H -p pid（pid为被测系统的进程号），找到导致CPU高的线程ID，对应thread dump信息中线程的nid，只不过一个是十进制，一个是十六进制；</li><li>在thread dump中，根据top命令查找的线程id，查找对应的线程堆栈信息；</li></ol></li><li><strong>CPU使用率不高但是响应很慢</strong></li></ul><p>进行dump，查看是否有很多thread struck在了i/o、数据库等地方，定位瓶颈原因；</p><ul><li><strong>请求无法响应</strong></li></ul><p>多次dump，对比是否所有的runnable线程都一直在执行相同的方法，如果是的，恭喜你，锁住了！</p><h3 id="死锁" tabindex="-1"><a class="header-anchor" href="#死锁"><span><a href="#%E6%AD%BB%E9%94%81">#</a> 死锁</span></a></h3><p>死锁经常表现为程序的停顿，或者不再响应用户的请求。从操作系统上观察，对应进程的CPU占用率为零，很快会从top或prstat的输出中消失。</p><p>比如在下面这个示例中，是个较为典型的死锁情况：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#98C379;">&quot;Thread-1&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">5</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x00acc490</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0xe50</span><span style="color:#E06C75;"> waiting </span><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> monitor entry [</span><span style="color:#D19A66;">0x02d3f000</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">..</span><span style="color:#FFFFFF;">0x02d3fd68</span><span style="color:#E06C75;">] </span></span>
<span class="line"><span style="color:#E06C75;">at </span><span style="color:#E5C07B;">deadlockthreads</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TestThread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">TestThread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">31</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#56B6C2;">-</span><span style="color:#E06C75;"> waiting to lock </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x22c19f18</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">) </span></span>
<span class="line"><span style="color:#56B6C2;">-</span><span style="color:#E06C75;"> locked </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x22c19f20</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;Thread-0&quot;</span><span style="color:#E06C75;"> prio</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">5</span><span style="color:#E06C75;"> tid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0x00accdb0</span><span style="color:#E06C75;"> nid</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">0xdec</span><span style="color:#E06C75;"> waiting </span><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> monitor entry [</span><span style="color:#D19A66;">0x02cff000</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#ABB2BF;">..</span><span style="color:#FFFFFF;">0x02cff9e8</span><span style="color:#E06C75;">] </span></span>
<span class="line"><span style="color:#E06C75;">at </span><span style="color:#E5C07B;">deadlockthreads</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">TestThread</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">run</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">TestThread</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">java</span><span style="color:#C678DD;">:</span><span style="color:#D19A66;">31</span><span style="color:#ABB2BF;">)</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#56B6C2;">-</span><span style="color:#E06C75;"> waiting to lock </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x22c19f20</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">) </span></span>
<span class="line"><span style="color:#56B6C2;">-</span><span style="color:#E06C75;"> locked </span><span style="color:#56B6C2;">&lt;</span><span style="color:#D19A66;">0x22c19f18</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> (a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 JAVA 5中加强了对死锁的检测。<strong>线程 Dump中可以直接报告出 Java级别的死锁</strong>，如下所示：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E5C07B;">Found</span><span style="color:#E06C75;"> one Java</span><span style="color:#56B6C2;">-</span><span style="color:#E06C75;">level deadlock</span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#56B6C2;">=============================</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#98C379;">&quot;Thread-1&quot;</span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">waiting to lock monitor </span><span style="color:#D19A66;">0x0003f334</span><span style="color:#E06C75;"> (object </span><span style="color:#D19A66;">0x22c19f18</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">which is held by </span><span style="color:#98C379;">&quot;Thread-0&quot;</span><span style="color:#E06C75;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;">&quot;Thread-0&quot;</span><span style="color:#C678DD;">:</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">waiting to lock monitor </span><span style="color:#D19A66;">0x0003f314</span><span style="color:#E06C75;"> (object </span><span style="color:#D19A66;">0x22c19f20</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> a </span><span style="color:#E5C07B;">java</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">lang</span><span style="color:#ABB2BF;">.</span><span style="color:#E5C07B;">Object</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span></span>
<span class="line"><span style="color:#E06C75;">which is held by </span><span style="color:#98C379;">&quot;Thread-1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="热锁" tabindex="-1"><a class="header-anchor" href="#热锁"><span><a href="#%E7%83%AD%E9%94%81">#</a> 热锁</span></a></h3><p>热锁，也往往是导致系统性能瓶颈的主要因素。其表现特征为：<strong>由于多个线程对临界区，或者锁的竞争</strong>，可能出现：</p><ul><li><strong>频繁的线程的上下文切换</strong>：从操作系统对线程的调度来看，当线程在等待资源而阻塞的时候，操作系统会将之切换出来，放到等待的队列，当线程获得资源之后，调度算法会将这个线程切换进去，放到执行队列中。</li><li><strong>大量的系统调用</strong>：因为线程的上下文切换，以及热锁的竞争，或者临界区的频繁的进出，都可能导致大量的系统调用。</li><li><strong>大部分CPU开销用在“系统态”</strong>：线程上下文切换，和系统调用，都会导致 CPU在 “系统态 ”运行，换而言之，虽然系统很忙碌，但是CPU用在 “用户态 ”的比例较小，应用程序得不到充分的 CPU资源。</li><li><strong>随着CPU数目的增多，系统的性能反而下降</strong>。因为CPU数目多，同时运行的线程就越多，可能就会造成更频繁的线程上下文切换和系统态的CPU开销，从而导致更糟糕的性能。</li></ul><p>上面的描述，都是一个 scalability（可扩展性）很差的系统的表现。从整体的性能指标看，由于线程热锁的存在，程序的响应时间会变长，吞吐量会降低。</p><p><strong>那么，怎么去了解 “热锁 ”出现在什么地方呢</strong>？</p><p>一个重要的方法是 结合操作系统的各种工具观察系统资源使用状况，以及收集Java线程的DUMP信息，看线程都阻塞在什么方法上，了解原因，才能找到对应的解决方法。</p><h2 id="jvm重要线程" tabindex="-1"><a class="header-anchor" href="#jvm重要线程"><span><a href="#jvm%E9%87%8D%E8%A6%81%E7%BA%BF%E7%A8%8B">#</a> JVM重要线程</span></a></h2><p>JVM运行过程中产生的一些比较重要的线程罗列如下：</p><table><thead><tr><th>线程名称</th><th>解释说明</th></tr></thead><tbody><tr><td>Attach Listener</td><td>Attach Listener 线程是负责接收到外部的命令，而对该命令进行执行的并把结果返回给发送者。通常我们会用一些命令去要求JVM给我们一些反馈信息，如：java -version、jmap、jstack等等。 如果该线程在JVM启动的时候没有初始化，那么，则会在用户第一次执行JVM命令时，得到启动。</td></tr><tr><td>Signal Dispatcher</td><td>前面提到Attach Listener线程的职责是接收外部JVM命令，当命令接收成功后，会交给signal dispather线程去进行分发到各个不同的模块处理命令，并且返回处理结果。signal dispather线程也是在第一次接收外部JVM命令时，进行初始化工作。</td></tr><tr><td>CompilerThread0</td><td>用来调用JITing，实时编译装卸class 。 通常，JVM会启动多个线程来处理这部分工作，线程名称后面的数字也会累加，例如：CompilerThread1。</td></tr><tr><td>Concurrent Mark-Sweep GC Thread</td><td>并发标记清除垃圾回收器（就是通常所说的CMS GC）线程， 该线程主要针对于老年代垃圾回收。ps：启用该垃圾回收器，需要在JVM启动参数中加上：-XX:+UseConcMarkSweepGC。</td></tr><tr><td>DestroyJavaVM</td><td>执行main()的线程，在main执行完后调用JNI中的 jni_DestroyJavaVM() 方法唤起DestroyJavaVM 线程，处于等待状态，等待其它线程（Java线程和Native线程）退出时通知它卸载JVM。每个线程退出时，都会判断自己当前是否是整个JVM中最后一个非deamon线程，如果是，则通知DestroyJavaVM 线程卸载JVM。</td></tr><tr><td>Finalizer Thread</td><td>这个线程也是在main线程之后创建的，其优先级为10，主要用于在垃圾收集前，调用对象的finalize()方法；关于Finalizer线程的几点：1) 只有当开始一轮垃圾收集时，才会开始调用finalize()方法；因此并不是所有对象的finalize()方法都会被执行；2) 该线程也是daemon线程，因此如果虚拟机中没有其他非daemon线程，不管该线程有没有执行完finalize()方法，JVM也会退出；3) JVM在垃圾收集时会将失去引用的对象包装成Finalizer对象（Reference的实现），并放入ReferenceQueue，由Finalizer线程来处理；最后将该Finalizer对象的引用置为null，由垃圾收集器来回收；4) JVM为什么要单独用一个线程来执行finalize()方法呢？如果JVM的垃圾收集线程自己来做，很有可能由于在finalize()方法中误操作导致GC线程停止或不可控，这对GC线程来说是一种灾难；</td></tr><tr><td>Low Memory Detector</td><td>这个线程是负责对可使用内存进行检测，如果发现可用内存低，分配新的内存空间。</td></tr><tr><td>Reference Handler</td><td>JVM在创建main线程后就创建Reference Handler线程，其优先级最高，为10，它主要用于处理引用对象本身（软引用、弱引用、虚引用）的垃圾回收问题 。</td></tr><tr><td>VM Thread</td><td>这个线程就比较牛b了，是JVM里面的线程母体，根据hotspot源码（vmThread.hpp）里面的注释，它是一个单个的对象（最原始的线程）会产生或触发所有其他的线程，这个单个的VM线程是会被其他线程所使用来做一些VM操作（如：清扫垃圾等）。</td></tr></tbody></table><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0">#</a> 参考文章</span></a></h2></div><!--[--><div class="sponsor" data-v-7bab3bae><div id="drinks-box" data-v-7bab3bae><div id="drinks-box-s" class="drinks-button left-100" data-v-7bab3bae><div id="drinks-icons" class="left-100 tr3" data-v-7bab3bae><div id="coffee-donate" class="icon-donate" data-v-7bab3bae><span class="font-icon icon iconfont icon-hk-flutter" data-v-7bab3bae></span> 赞助 </div></div><div id="drinks-button-box" class="tr3 left-100" data-v-7bab3bae><div id="drinks-button-bg" class="left-100" data-v-7bab3bae></div><div id="github-box" data-v-7bab3bae><a href="https://github.com/lixuanfengs/Cactus" target="_blank" data-v-7bab3bae>Github</a></div><ul id="donate-buttons" class="list tr3" data-v-7bab3bae><li id="paypal_donate" data-v-7bab3bae><a href="https://www.paypal.me/oragekk" target="_blank" data-v-7bab3bae>Paypal</a></li><!-- <li id="btc_donate" class="donate-button">Bitcoin</li> --><li id="alipay_donate" class="donate-button" data-v-7bab3bae>AliPay</li><li id="wechat_donate" class="donate-button2" data-v-7bab3bae>WeChat</li></ul></div><div id="drinks-qrcodes" class="left-100 tr3" data-v-7bab3bae><div id="drinks-qrcode" data-v-7bab3bae></div></div></div></div></div><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/lixuanfengs/Cactus/edit/main/src/posts/Java/JVM/调试排错 Java 线程分析之线程Dump分析.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2024/3/22 10:01:39</span></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 1183895890@qq.com">lixuanfengs</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90%E4%B9%8B%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98.html" aria-label="调试排错 Java 内存分析之堆外内存"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->调试排错 Java 内存分析之堆外内存</div></a><a class="route-link auto-link next" href="/posts/Java/JVM/%E8%B0%83%E8%AF%95%E6%8E%92%E9%94%99%20Java%20%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E4%B9%8BLinux%E5%91%BD%E4%BB%A4.html" aria-label="调试排错 Java 问题排查之Linux命令"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">调试排错 Java 问题排查之Linux命令<!----></div></a></nav><div id="comment" class="waline-wrapper vp-comment" vp-comment darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-reaction"><div class="wl-reaction-title">你认为这篇文章怎么样？</div><ul class="wl-reaction-list"><!--[--><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_agree.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_look_down.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sunglasses.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_pick_nose.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_awkward.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sleep.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><!--]--></ul></div><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">昵称</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">邮箱(可选)</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">网址(可选)</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="请留言。(填写邮箱可在被回复时收到邮件提醒)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>预览:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="表情" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="表情包"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" aria-hidden="true" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="上传图片" aria-label="上传图片"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="预览"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <span>  /  <span class="">300</span></span>  字</div><button type="button" class="wl-btn">登录</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->提交<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="搜索表情包"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> 评论</div><ul class="wl-sort"><!--[--><li class="active">按正序</li><li class="">按倒序</li><li class="">按热度</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v3.3.2</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--c835f6e4:;"><div class="busuanzi"><span id="busuanzi_container_site_pv" style="display:none;"> 本站总访问量 <span id="busuanzi_value_site_pv"></span>次 <span class="post-meta-divider">|</span></span><span id="busuanzi_container_site_uv" style="display:none;"> 您是本站第 <span id="busuanzi_value_site_uv"></span>位访问者 </span></div><div class="footer-content"><div class="footer">默认页脚</div><div class="copyright">Copyright © 2018-2024 Cactus li</div></div><span id="runtime_span"></span><!--        <div class="footer-link">--><!--            <a href="https://www.foreverblog.cn/go.html" target="_blank">--><!--                <img--><!--                        :src="wormhole"--><!--                        alt=""--><!--                        style="width: auto; height: 32px"--><!--                        title="穿梭虫洞-随机访问十年之约友链博客"--><!--                /></a>--><!--            <a href="https://www.travellings.cn/go.html" target="_blank">--><!--                <img--><!--                        src="https://www.travellings.cn/assets/logo.gif"--><!--                        alt=""--><!--                        style="width: auto; height: 32px"--><!--                        title="开往-友链接力"--><!--                /></a>--><!--            &lt;!&ndash; <a href="https://www.foreverblog.cn/" target="_blank">--><!--              <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width: auto; height: 16px" />--><!--            </a> &ndash;&gt;--><!--        </div>--></footer></div><!--]--><!--[--><!----><!----><!--[--><!--]--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CF9kF85C.js" defer></script>
  </body>
</html>
