---
title: "Jekyllæ—§ç«™å›å¿†"
icon: read
date: 2024-3-03 12:00:00
category:
  - Blog
tag:
  - Blog
---

## ğŸ”¨ æ­å»º Cactus

1. é¦–å…ˆï¼Œè¿›å…¥ [Cactus](https://github.com/lixuanfengs/Cactus) é¡¹ç›®é¡µï¼Œç‚¹å‡»å³ä¸Šè§’ã€ŒUse this templateã€åé€‰æ‹©ã€ŒCreate a new repositoryã€ã€‚

   ![image-20240306170117254](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240306170117254.png)

   ![image-20240306170313963](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240306170313963.png)

2. æ¥ç€ï¼Œè¿›å…¥é¡¹ç›®ä»“åº“çš„ã€ŒSettingsã€>ã€ŒActionsã€>ã€ŒGeneralã€ï¼Œé€‰ä¸­åº•éƒ¨ Workflow permissions ä¸­çš„ `Read and write permissions`ï¼Œç„¶åç‚¹å‡»ä¿å­˜å³å¯ã€‚å¦‚æœæœªæˆæƒï¼ŒGitHub Page éƒ¨ç½²ä¼šç”±äº repo æƒé™ä¸è¶³è€ŒæŠ¥é”™ `failed with exit code 128`ã€‚

   ![image-20240306171213682](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240306171213682.png)

3. æ¥ä¸‹æ¥ï¼Œè¯·è¿›å…¥èœå•æ é¡¶éƒ¨çš„ã€ŒActionsã€>ã€Œæœ€æ–°çš„ workflowã€ï¼Œå¹¶ç‚¹å‡»å³ä¸Šæ–¹çš„ã€ŒRe-run jobsã€>ã€ŒRe-run all jobsã€ï¼Œä»¥é‡æ–°ç”Ÿæˆç½‘é¡µã€‚è‹¥éƒ¨ç½²æ­£ç¡®ï¼ŒGitHub å°†è‡ªåŠ¨æ­å»º gh-page åˆ†æ”¯é¡µé¢ã€‚

## ğŸ€é…ç½® Cactus



## ğŸ¯éƒ¨ç½² Cactus

### éƒ¨ç½²åˆ° Vercel

Vercel çš„é€Ÿåº¦ç›¸å¯¹ GitHub Pages æ›´å¿«ï¼Œä½† `*.vercel.app` åŸŸåå·²å— DNS æ±¡æŸ“å½±å“ã€‚ä¸ºä¿è¯å›½å†…ç”¨æˆ·è®¿é—®ç¨³å®šï¼Œéœ€ç»‘å®šè‡ªå®šä¹‰åŸŸåã€‚

Vercel éƒ¨ç½²æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç‚¹å‡» [![Vercel](https://lixuanfengs.github.io/blog-images/cactus-blogs/68747470733a2f2f76657263656c2e636f6d2f627574746f6e)](https://vercel.com/new/clone?repository-url=https://github.com/lixuanfengs/Cactus/tree/gh-pages) æˆ–å°† `https://vercel.com/new/clone?repository-url=https://github.com/lixuanfengs/Cactus/tree/gh-pages` ä¸­çš„ `rockbenben/Cactus` æ”¹ä¸º `ä½ çš„ç”¨æˆ·å/ä»“åº“å`ï¼Œç„¶åä¼šè·³è½¬è‡³ Vercel è¿›è¡Œç½‘é¡µéƒ¨ç½²ã€‚å¦‚æœä½ æœªç™»å½•ï¼ŒVercel æç¤ºä½ æ³¨å†Œæˆ–ç™»å½•ï¼Œè¯·ä½¿ç”¨ GitHub è´¦æˆ·è¿›è¡Œå¿«æ·ç™»å½•ã€‚
2. è¾“å…¥ä¸€ä¸ªä½ å–œæ¬¢çš„ Vercel é¡¹ç›®åç§°ï¼Œé»˜è®¤ private å³å¯ï¼Œç„¶åç‚¹å‡» `Create`ã€‚

![image-20240307101726683](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307101726683.png)

3. æ¥ç€ï¼ŒVercel ä¼šåŸºäº Cactus æ¨¡æ¿å¸®åŠ©ä½ æ–°å»ºå¹¶åˆå§‹åŒ–ä»“åº“ï¼Œä»“åº“åä¸ºä½ ä¹‹å‰è¾“å…¥çš„é¡¹ç›®åã€‚å‡ åç§’åï¼Œæ»¡å±çš„çƒŸèŠ±ä¼šåº†ç¥ä½ éƒ¨ç½²æˆåŠŸã€‚æ­¤æ—¶ï¼Œç‚¹å‡» `Go to Dashboard` è·³è½¬åˆ°åº”ç”¨çš„æ§åˆ¶å°ã€‚

   ![image-20240307101851481](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307101851481.png)

4. ä¸ºäº†è®© Vercel é¡µé¢ä¸ GitHub Pages è‡ªåŠ¨ä¿æŒåŒæ­¥æ›´æ–°ï¼Œä½ éœ€è¦é…ç½® `VERCEL_TOKEN`ã€`VERCEL_ORG_ID`ã€`VERCEL_PROJECT_ID`ã€ å’Œ GitHub Actionsã€‚

    - åœ¨ Vercel  æ§åˆ¶é¢æ¿é€‰æ‹© [settings ]  >  [Tokens]  > [Create] åˆ›å»º  `VERCEL_TOKEN`ï¼Œå¤åˆ¶ Tokens åˆ° github ä¸­ [settings ]  >  [Secrets and variables]  >  [Actions]  >  [new repository secret] åˆ›å»º `VERCEL_TOKEN` ä»“åº“å¯†é’¥ã€‚
    - åœ¨ Vercel  æ§åˆ¶é¢æ¿é€‰æ‹© [settings ]  >  [General]  >  [Vercel ID]  ï¼Œå¤åˆ¶ Vercel ID åˆ° github ä¸­ [settings ]  >  [Secrets and variables]  >  [Actions]  >  [new repository secret] åˆ›å»º `VERCEL_ORG_ID` ä»“åº“å¯†é’¥ã€‚
    - åœ¨ Vercel  æ§åˆ¶é¢æ¿é€‰æ‹© [Project Settings]  >  [General]  >  [Project ID]  ï¼Œå¤åˆ¶ Project ID åˆ° github ä¸­ [settings ]  >  [Secrets and variables]  >  [Actions]  >  [new repository secret] åˆ›å»º `VERCEL_PROJECT_ID` ä»“åº“å¯†é’¥ã€‚

   ```yaml
   # å°†é¡µé¢æ›´æ–°åˆ° Vercel
         - name: éƒ¨ç½²åˆ° Vercel
           uses: amondnet/vercel-action@v20 # ä½¿ç”¨Vercel Action
           with:
             vercel-token: ${{ secrets.VERCEL_TOKEN }} # ä½¿ç”¨å­˜å‚¨åœ¨Secretsçš„Vercel Token
             vercel-org-id: ${{ secrets.VERCEL_ORG_ID }} # ä½ çš„Vercelç»„ç»‡ID
             vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }} # ä½ çš„Vercelé¡¹ç›®ID
             vercel-args: '--prod' # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
   
   ```

> æ³¨æ„åœ¨ vercel æ§åˆ¶å°å¦‚æœå‡ºç°äº†éƒ¨ç½²é”™è¯¯å¯èƒ½æ˜¯å› ä¸ºmainå’Œgh-pages æŸä¸€ä¸ªåˆ†æ”¯éƒ¨ç½²é”™äº†ã€‚æ‰¾åˆ° Vercel  æ§åˆ¶é¢æ¿é€‰æ‹© [Project Settings]  >  [git]  >  [Production Branch] (æ¡†é‡Œå†™ main)ã€‚ç„¶ååœ¨ä¸‹é¢æ‰¾åˆ° [Ignored Build Step]  >  [custom] å¡«å…¥ ã€bash -c 'if [[ "$VERCEL_GIT_COMMIT_REF" == "gh-pages" ]]; then exit 0; fi'ã€‘

### ä½¿ç”¨ Docker éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Š

#### ä¸€ã€æ­å»ºå‡†å¤‡

#### äºŒã€é¡¹ç›®ç»“æ„è¯´æ˜

é¦–å…ˆæŠŠåšå®¢çŸ¥è¯†æ¡†æ¶å…‹éš†åˆ°æœ¬åœ°ã€‚

![image-20240307163754657](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307163754657.png)

* src ç›®å½•ä¸‹ï¼Œæ˜¯åšå®¢çš„æ¡†æ¶æ¨¡æ¿å’Œå·²ç»å†™å¥½çš„æ–‡ç« å†…å®¹ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `package.json`ä¸­çš„ `docs:build` ç”¨äºæ„å»ºï¼Œ `docs:dev`ç”¨äºæœ¬åœ°å¯åŠ¨æµ‹è¯•ã€‚
* dev-ops ç›®å½•æ˜¯æä¾›åšå®¢çš„éƒ¨ç½²ï¼Œè¿™é‡Œçš„ docker-compose.yml æ˜¯ Docker æ‰§è¡Œè„šæœ¬å®‰è£… Nginx ç¯å¢ƒã€‚
* åœ¨ `src/.vuepress-> config.ts`æ–‡ä»¶ä¸­ä¸‹é…ç½®äº†æŠŠé¡¹ç›® build åˆ° nginx/html æ–‡ä»¶å¤¹ã€‚è¿™æ ·å¯ä»¥æ›´åŠ æ–¹ä¾¿æˆ‘ä»¬éƒ¨ç½²ã€‚

#### ä¸‰ã€éƒ¨ç½²é¡¹ç›®

ä½¿ç”¨ WebStrom å‰ç«¯å¼€å‘å·¥å…·ï¼Œæ‰“å¼€å…‹éš†åˆ°æœ¬åœ°çš„é¡¹ç›®ã€‚åœ¨å·¥å…·ç•Œé¢ä¼šæç¤ºä½ æ‰§è¡Œ npm install å®‰è£…é¡¹ç›®è¿è¡Œå’Œéƒ¨ç½²æ‰€éœ€çš„ç¯å¢ƒã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°æç¤ºçš„è¯ï¼Œå¯ä»¥æ‰“å¼€ Terminal  çª—å£ã€‚æ‰§è¡Œå®‰è£…å‘½ä»¤å°±å¯ä»¥åšä¸‹ä¸€æ­¥çš„åšå®¢éƒ¨ç½²å·¥ä½œäº†ã€‚

![image-20240307165049368](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307165049368.png)

1. **æ„å»ºé¡¹ç›®**

   ![image-20240307171205175](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307171205175.png)

    - æ‰“å¼€é¡¹ç›®çš„ `package.json`é‡Œé¢æœ‰`æ„å»º`å’Œ`è¿è¡Œ`å‘½åã€‚
    - æ„å»ºçš„æ“ä½œä¼šæŠŠå·¥ç¨‹æ‰“åŒ…ä¸º HTML æ–‡ä»¶å†™å…¥åˆ° dev-ops/nginx/html æ–‡ä»¶å¤¹ä¸‹ã€‚
    - è¿è¡Œçš„æ“ä½œä¼šç›´æ¥æœ¬åœ°å¯åŠ¨æœåŠ¡ï¼Œå¯åŠ¨åä½ å¯ä»¥åœ¨æœ¬åœ°é¢„è§ˆã€‚è¿™æ ·ä½ åœ¨ä¿®æ”¹ä¸€äº›å†…å®¹çš„æ—¶å€™ä¹Ÿå¯ä»¥éšæ—¶çœ‹åˆ°æ•ˆæœã€‚

2. **æ„å»ºç»“æœ**

   ![image-20240307170359320](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307170359320.png)

    * å¦‚å›¾æ“ä½œï¼Œå®Œæˆæ„å»ºã€‚å½“çœ‹åˆ°`dev-ops/nginx/html` ä¸‹å‡ºç°æ„å»ºåçš„é™æ€æ–‡ä»¶ï¼Œè¡¨ç¤ºæ„å»ºæˆåŠŸã€‚

3. **é…ç½® Nginx**

   Nginx æä¾›äº†ä¸‰ç§é…ç½®æ–¹å¼ï¼Œåˆ†åˆ«æ”¯æŒè®¿é—®ç±»å‹ï¼šIP åœ°å€ç›´æ¥è®¿é—®ã€é€šè¿‡ HTTP åè®®è®¿é—®åŸŸåã€é€šè¿‡ HTTPS åè®®è®¿é—®åŸŸåã€‚

   ![image-20240307171739941](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307171739941.png)

    1. **localhost.conf**

       è¿™ä¸ªé…ç½®æ–¹å¼ä¸ºäº†æ–¹ä¾¿ï¼Œæ²¡æœ‰åŸŸåçš„ä¼™ä¼´ä»¬æµ‹è¯•ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯ä½ éƒ¨ç½²åå¯ä»¥ç›´æ¥é€šè¿‡IPè¿›è¡Œè®¿é—®ã€‚

       ```nginx
       server {
           listen       80;
           listen  [::]:80;
       
           location / {
              root /usr/share/nginx/html;
              index index.html;
           }
       
           error_page   500 502 503 504  /50x.html;
           location = /50x.html {
               root /usr/share/nginx/html;
           }
       
       }
       ```

        - ç›´æ¥æŠŠ 80 è¯·æ±‚è½¬å‘åˆ°æœ¬åœ°çš„æ ¹ç›®å½•åœ°å€çš„ html æ–‡ä»¶ä¸Šå³å¯

    2. **http.blog.conf**

       å¦‚æœæ˜¯äº‘æœåŠ¡å™¨å’ŒåŸŸåï¼Œé¦–å…ˆå…ˆé…ç½®åŸŸåè§£æã€‚

       ```nginx
       server {
           listen       80;
           listen  [::]:80;
           server_name  blog.cactusli.net;
       
           location / {
              root /usr/share/nginx/html;
              index index.html;
           }
       
           error_page   500 502 503 504  /50x.html;
           location = /50x.html {
               root /usr/share/nginx/html;
           }
       
       }
       ```

    3. **https.blog.conf**

       å¦‚æœä½ æœ‰åŸŸåé‚£ä¹ˆè¿˜å¯ä»¥é…ç½®å…è´¹çš„ssléªŒè¯ï¼Œé…ç½®å®ŒæˆåæŠŠ ssl keyã€pem æ–‡ä»¶æ”¾åˆ° dev-ops/nginx/ssl æ–‡ä»¶å¤¹ä¸‹å¹¶ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ä¸Šã€‚

       ```nginx
       server {
           listen       80;
           listen  [::]:80;
           server_name  blog.cactusli.net;
       
           rewrite ^(.*) https://$server_name$1 permanent;
       }
       
       server {
           listen       443 ssl;
           server_name  api.cactusli.net;
       
           ssl_certificate      /etc/nginx/ssl/blogs.cactusli.net.pem;
           ssl_certificate_key  /etc/nginx/ssl/blogs.cactusli.net.key;
       
           ssl_session_cache    shared:SSL:1m;
           ssl_session_timeout  5m;
       
           ssl_ciphers  HIGH:!aNULL:!MD5;
           ssl_prefer_server_ciphers  on;
       
           location / {
                root /usr/share/nginx/html;
                index index.html;
           }
       
           error_page   500 502 503 504  /50x.html;
           location = /50x.html {
               root   /usr/share/nginx/html;
           }
       }
       ```

        - è¿™ä¸ªæ–¹å¼å°±æ˜¯é…ç½® ssl çš„æ–¹å¼ã€‚

4. **ä¸Šä¼ æ–‡ä»¶**

   ![image-20240307182607039](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307182607039.png)

    - é€šè¿‡`SSH/FTP`  å·¥å…·ï¼Œè¿æ¥äº‘æœåŠ¡å™¨ï¼Œå¹¶æŠŠæˆ‘ä»¬åœ¨å·¥ç¨‹ä¸‹åˆ›å»ºçš„ `dev-ops` ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ç«¯ã€‚

5. **æœåŠ¡å¯åŠ¨**

   æ¥ä¸‹æ¥ï¼Œä½ åªéœ€è¦åŠ¡å™¨è¿›å…¥åˆ° dev-ops æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰§è¡Œè„šæœ¬ `docker compose -f docker-compose.yml up -d` å³å¯å®Œæˆéƒ¨ç½²ã€‚

   ![image-20240307182717011](https://lixuanfengs.github.io/blog-images/cactus-blogs/image-20240307182717011.png)

6. **è®¿é—®æµ‹è¯•**
