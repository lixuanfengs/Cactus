---
title: "Docker 部署 cactus-vue-pro"
subtitle: "Docker 部署 cactus-vue-pro"
date: 2024-4-03 15:36:20
category:
   - cactus-vue-pro
tag:
   - cactus-vue-pro
order: 3
---
## 自建内网穿透服务 EasyTier

一个简单、安全、去中心化的内网穿透 VPN 组网方案，使用 Rust 语言和 Tokio 框架实现。

## 安装

1. **下载预编译的二进制文件**

   访问 [GitHub Release 页面](https://github.com/KKRainbow/EasyTier/releases) 下载适用于您操作系统的二进制文件。Release 压缩包中同时包含命令行程序和图形界面程序。

2. **通过 crates.io 安装**

   ```shell
   cargo install easytier
   ```

   

3. **通过源码安装**

   ```shell
   cargo install --git https://github.com/KKRainbow/EasyTier.git
   ```


## 快速开始



> 下文仅描述命令行工具的使用，图形界面程序可参考下述概念自行配置。

确保已按照 [安装指南](https://github.com/EasyTier/EasyTier/blob/main/README_CN.md#安装) 安装 EasyTier，并且 easytier-core 和 easytier-cli 两个命令都已经可用。

### 双节点组网

假设双节点的网络拓扑如下

<details class="details-reset details-overlay details-overlay-dark" style="box-sizing: border-box; display: contents; margin-top: 0px; margin-bottom: 16px;"><summary role="button" aria-label="Open dialog" class="btn my-2 mr-2 p-0 d-inline-flex" aria-haspopup="dialog" style="box-sizing: border-box; display: inline-flex !important; cursor: pointer; position: relative; padding: 0px !important; font-size: 14px; font-weight: var(--base-text-weight-medium, 500); line-height: 20px; white-space: nowrap; vertical-align: middle; user-select: none; border-width: 1px; border-style: solid; border-color: var(--button-default-borderColor-rest, var(--color-btn-border)); border-image: initial; border-radius: 6px; appearance: none; color: var(--button-default-fgColor-rest, var(--color-btn-text)); background-color: var(--button-default-bgColor-rest, var(--color-btn-bg)); box-shadow: var(--button-default-shadow-resting, var(--color-btn-shadow)),var(--button-default-shadow-inset, var(--color-btn-inset-shadow)); transition: color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s, background-color, box-shadow, border-color; margin-right: var(--base-size-8, 8px) !important; margin-top: var(--base-size-8, 8px) !important; margin-bottom: var(--base-size-8, 8px) !important; list-style: none;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="octicon m-2"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></summary><details-dialog class="Box Box--overlay render-full-screen d-flex flex-column anim-fade-in fast" aria-label="mermaid rendered container" role="dialog" aria-modal="true" style="box-sizing: border-box; position: fixed; margin: 10vh auto; top: 0px; left: 0px; transform: translateX(-50%); z-index: 999; max-height: 80vh; max-width: 90vw; width: 34px; overflow: auto; display: none; background-color: var(--bgColor-default); background-clip: padding-box; border-color: var(--borderColor-default); box-shadow: rgba(0, 0, 0, 0.4) 0px 0px 18px; animation-name: fade-in; animation-duration: 300ms; animation-timing-function: ease-in-out; flex-direction: column !important; border-radius: var(--borderRadius-medium); border-style: solid; border-width: var(--borderWidth-thin); height: auto; padding: 16px;"><div style="box-sizing: border-box;"><button aria-label="Close dialog" data-close-dialog="" type="button" data-view-component="true" class="Link--muted btn-link position-absolute render-full-screen-close" style="box-sizing: border-box; font: inherit; margin: 0px; overflow: visible; text-transform: none; appearance: button; cursor: pointer; border-radius: 0px; display: inline-block; padding: 4px; color: var(--fgColor-muted) !important; text-decoration: none; white-space: nowrap; user-select: none; background-color: transparent; border: 0px; position: absolute !important; top: 0px; right: 0px; z-index: 1;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:inline-block;vertical-align:text-bottom" class="octicon octicon-x"><path fill-rule="evenodd" d="M5.72 5.72a.75.75 0 011.06 0L12 10.94l5.22-5.22a.75.75 0 111.06 1.06L13.06 12l5.22 5.22a.75.75 0 11-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 01-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 010-1.06z"></path></svg></button><div class="Box-body border-0" role="presentation" style="box-sizing: border-box; border-top: 0px !important; border-right: 0px !important; border-bottom: var(--borderWidth-thin) solid var(--borderColor-default); border-left: 0px !important; border-image: initial !important; padding: var(--stack-padding-normal); border-bottom-left-radius: var(--borderRadius-medium); border-bottom-right-radius: var(--borderRadius-medium); margin-bottom: calc(var(--borderWidth-thin)*-1);"></div></div></details-dialog></details>

<iframe role="presentation" class="render-viewer" sandbox="allow-scripts allow-same-origin allow-top-navigation allow-popups" src="https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com&amp;color_mode=light#6489ba4b-0f5d-4f8f-8d8d-8e451f037dd1" name="6489ba4b-0f5d-4f8f-8d8d-8e451f037dd1" data-content="{&quot;data&quot;:&quot;flowchart LR\n\nsubgraph 节点 A IP 22.1.1.1\nnodea[EasyTier\\n10.144.144.1]\nend\n\nsubgraph 节点 B\nnodeb[EasyTier\\n10.144.144.2]\nend\n\nnodea &amp;lt;-----&amp;gt; nodeb\n\n&quot;}" style="box-sizing: border-box; display: block; width: 1012px; height: 219px; border: 0px;"></iframe>

1. 在节点 A 上执行：

   ```shell
   sudo easytier-core --ipv4 10.144.144.1
   ```

   命令执行成功会有如下打印。

   [![alt text](https://lixuanfengs.github.io/blog-images/vp/web/image-2.png)](https://github.com/EasyTier/EasyTier/blob/main/assets/image-2.png)

2. 在节点 B 执行

   ```shell
   sudo easytier-core --ipv4 10.144.144.2 --peers udp://22.1.1.1:11010
   ```

   

3. 测试联通性

   两个节点应成功连接并能够在虚拟子网内通信

   ```shell
   ping 10.144.144.2
   ```

   

   使用 easytier-cli 查看子网中的节点信息

   ```shell
   easytier-cli peer
   ```

   

   [![alt text](https://lixuanfengs.github.io/blog-images/vp/web/image.png)](https://github.com/EasyTier/EasyTier/blob/main/assets/image.png)

   ```shell
   easytier-cli route
   ```

   

   [![alt text](https://lixuanfengs.github.io/blog-images/vp/web/image-1.png)](https://github.com/EasyTier/EasyTier/blob/main/assets/image-1.png)

------

### 多节点组网



基于刚才的双节点组网例子，如果有更多的节点需要加入虚拟网络，可以使用如下命令。

```shell
sudo easytier-core --ipv4 10.144.144.2 --peers udp://22.1.1.1:11010
```



其中 `--peers ` 参数可以填写任意一个已经在虚拟网络中的节点的监听地址。

------

### 子网代理（点对网）配置



假设网络拓扑如下，节点 B 想将其可访问的子网 10.1.1.0/24 共享给其他节点。

<details class="details-reset details-overlay details-overlay-dark" style="box-sizing: border-box; display: contents; margin-top: 0px; margin-bottom: 16px;"><summary role="button" aria-label="Open dialog" class="btn my-2 mr-2 p-0 d-inline-flex" aria-haspopup="dialog" style="box-sizing: border-box; display: inline-flex !important; cursor: pointer; position: relative; padding: 0px !important; font-size: 14px; font-weight: var(--base-text-weight-medium, 500); line-height: 20px; white-space: nowrap; vertical-align: middle; user-select: none; border-width: 1px; border-style: solid; border-color: var(--button-default-borderColor-rest, var(--color-btn-border)); border-image: initial; border-radius: 6px; appearance: none; color: var(--button-default-fgColor-rest, var(--color-btn-text)); background-color: var(--button-default-bgColor-rest, var(--color-btn-bg)); box-shadow: var(--button-default-shadow-resting, var(--color-btn-shadow)),var(--button-default-shadow-inset, var(--color-btn-inset-shadow)); transition: color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s, background-color, box-shadow, border-color; margin-right: var(--base-size-8, 8px) !important; margin-top: var(--base-size-8, 8px) !important; margin-bottom: var(--base-size-8, 8px) !important; list-style: none;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="octicon m-2"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></summary><details-dialog class="Box Box--overlay render-full-screen d-flex flex-column anim-fade-in fast" aria-label="mermaid rendered container" role="dialog" aria-modal="true" style="box-sizing: border-box; position: fixed; margin: 10vh auto; top: 0px; left: 0px; transform: translateX(-50%); z-index: 999; max-height: 80vh; max-width: 90vw; width: 34px; overflow: auto; display: none; background-color: var(--bgColor-default); background-clip: padding-box; border-color: var(--borderColor-default); box-shadow: rgba(0, 0, 0, 0.4) 0px 0px 18px; animation-name: fade-in; animation-duration: 300ms; animation-timing-function: ease-in-out; flex-direction: column !important; border-radius: var(--borderRadius-medium); border-style: solid; border-width: var(--borderWidth-thin); height: auto; padding: 16px;"><div style="box-sizing: border-box;"><button aria-label="Close dialog" data-close-dialog="" type="button" data-view-component="true" class="Link--muted btn-link position-absolute render-full-screen-close" style="box-sizing: border-box; font: inherit; margin: 0px; overflow: visible; text-transform: none; appearance: button; cursor: pointer; border-radius: 0px; display: inline-block; padding: 4px; color: var(--fgColor-muted) !important; text-decoration: none; white-space: nowrap; user-select: none; background-color: transparent; border: 0px; position: absolute !important; top: 0px; right: 0px; z-index: 1;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:inline-block;vertical-align:text-bottom" class="octicon octicon-x"><path fill-rule="evenodd" d="M5.72 5.72a.75.75 0 011.06 0L12 10.94l5.22-5.22a.75.75 0 111.06 1.06L13.06 12l5.22 5.22a.75.75 0 11-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 01-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 010-1.06z"></path></svg></button><div class="Box-body border-0" role="presentation" style="box-sizing: border-box; border-top: 0px !important; border-right: 0px !important; border-bottom: var(--borderWidth-thin) solid var(--borderColor-default); border-left: 0px !important; border-image: initial !important; padding: var(--stack-padding-normal); border-bottom-left-radius: var(--borderRadius-medium); border-bottom-right-radius: var(--borderRadius-medium); margin-bottom: calc(var(--borderWidth-thin)*-1);"></div></div></details-dialog></details>



<iframe role="presentation" class="render-viewer" sandbox="allow-scripts allow-same-origin allow-top-navigation allow-popups" src="https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com&amp;color_mode=light#153b060c-5e66-4827-a7db-1f2d71665237" name="153b060c-5e66-4827-a7db-1f2d71665237" data-content="{&quot;data&quot;:&quot;flowchart LR\n\nsubgraph 节点 A IP 22.1.1.1\nnodea[EasyTier\\n10.144.144.1]\nend\n\nsubgraph 节点 B\nnodeb[EasyTier\\n10.144.144.2]\nend\n\nid1[[10.1.1.0/24]]\n\nnodea &amp;lt;--&amp;gt; nodeb &amp;lt;-.-&amp;gt; id1\n\n&quot;}" style="box-sizing: border-box; display: block; width: 1012px; height: 219px; border: 0px;"></iframe>

则节点 B 的 easytier 启动参数为（新增 -n 参数）

```shell
sudo easytier-core --ipv4 10.144.144.2 -n 10.1.1.0/24
```



子网代理信息会自动同步到虚拟网络的每个节点，各个节点会自动配置相应的路由，节点 A 可以通过如下命令检查子网代理是否生效。

1. 检查路由信息是否已经同步，proxy_cidrs 列展示了被代理的子网。

   ```shell
   easytier-cli route
   ```

   

   ![EasyTier-01](https://lixuanfengs.github.io/blog-images/vp/web/EasyTier-01.png)

2. 测试节点 A 是否可访问被代理子网下的节点

   ```shell
   ping 10.1.1.2
   ```

   

------

### 无公网IP组网



EasyTier 支持共享公网节点进行组网。目前已部署共享的公网节点 `tcp://easytier.public.kkrainbow.top:11010`。

使用共享节点时，需要每个入网节点提供相同的 `--network-name` 和 `--network-secret` 参数，作为网络的唯一标识。

以双节点为例，节点 A 执行：

```shell
sudo easytier-core -i 10.144.144.1 --network-name abc --network-secret abc -e tcp://easytier.public.kkrainbow.top:11010
```



节点 B 执行

```shell
sudo easytier-core --ipv4 10.144.144.2 --network-name abc --network-secret abc -e tcp://easytier.public.kkrainbow.top:11010
```



命令执行成功后，节点 A 即可通过虚拟 IP 10.144.144.2 访问节点 B。

------

### 使用 WireGuard 客户端接入



EasyTier 可以用作 WireGuard 服务端，让任意安装了 WireGuard 客户端的设备访问 EasyTier 网络。对于目前 EasyTier 不支持的平台 （如 iOS、Android 等），可以使用这种方式接入 EasyTier 网络。

假设网络拓扑如下：

<details class="details-reset details-overlay details-overlay-dark" style="box-sizing: border-box; display: contents; margin-top: 0px; margin-bottom: 16px;"><summary role="button" aria-label="Open dialog" class="btn my-2 mr-2 p-0 d-inline-flex" aria-haspopup="dialog" style="box-sizing: border-box; display: inline-flex !important; cursor: pointer; position: relative; padding: 0px !important; font-size: 14px; font-weight: var(--base-text-weight-medium, 500); line-height: 20px; white-space: nowrap; vertical-align: middle; user-select: none; border-width: 1px; border-style: solid; border-color: var(--button-default-borderColor-rest, var(--color-btn-border)); border-image: initial; border-radius: 6px; appearance: none; color: var(--button-default-fgColor-rest, var(--color-btn-text)); background-color: var(--button-default-bgColor-rest, var(--color-btn-bg)); box-shadow: var(--button-default-shadow-resting, var(--color-btn-shadow)),var(--button-default-shadow-inset, var(--color-btn-inset-shadow)); transition: color 80ms cubic-bezier(0.33, 1, 0.68, 1) 0s, background-color, box-shadow, border-color; margin-right: var(--base-size-8, 8px) !important; margin-top: var(--base-size-8, 8px) !important; margin-bottom: var(--base-size-8, 8px) !important; list-style: none;"><svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" class="octicon m-2"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 1.06L2.56 7h10.88l-2.22-2.22a.75.75 0 011.06-1.06l3.5 3.5a.75.75 0 010 1.06l-3.5 3.5a.75.75 0 11-1.06-1.06l2.22-2.22H2.56l2.22 2.22a.75.75 0 11-1.06 1.06l-3.5-3.5a.75.75 0 010-1.06l3.5-3.5z"></path></svg></summary><details-dialog class="Box Box--overlay render-full-screen d-flex flex-column anim-fade-in fast" aria-label="mermaid rendered container" role="dialog" aria-modal="true" style="box-sizing: border-box; position: fixed; margin: 10vh auto; top: 0px; left: 0px; transform: translateX(-50%); z-index: 999; max-height: 80vh; max-width: 90vw; width: 34px; overflow: auto; display: none; background-color: var(--bgColor-default); background-clip: padding-box; border-color: var(--borderColor-default); box-shadow: rgba(0, 0, 0, 0.4) 0px 0px 18px; animation-name: fade-in; animation-duration: 300ms; animation-timing-function: ease-in-out; flex-direction: column !important; border-radius: var(--borderRadius-medium); border-style: solid; border-width: var(--borderWidth-thin); height: auto; padding: 16px;"><div style="box-sizing: border-box;"><button aria-label="Close dialog" data-close-dialog="" type="button" data-view-component="true" class="Link--muted btn-link position-absolute render-full-screen-close" style="box-sizing: border-box; font: inherit; margin: 0px; overflow: visible; text-transform: none; appearance: button; cursor: pointer; border-radius: 0px; display: inline-block; padding: 4px; color: var(--fgColor-muted) !important; text-decoration: none; white-space: nowrap; user-select: none; background-color: transparent; border: 0px; position: absolute !important; top: 0px; right: 0px; z-index: 1;"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:inline-block;vertical-align:text-bottom" class="octicon octicon-x"><path fill-rule="evenodd" d="M5.72 5.72a.75.75 0 011.06 0L12 10.94l5.22-5.22a.75.75 0 111.06 1.06L13.06 12l5.22 5.22a.75.75 0 11-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 01-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 010-1.06z"></path></svg></button><div class="Box-body border-0" role="presentation" style="box-sizing: border-box; border-top: 0px !important; border-right: 0px !important; border-bottom: var(--borderWidth-thin) solid var(--borderColor-default); border-left: 0px !important; border-image: initial !important; padding: var(--stack-padding-normal); border-bottom-left-radius: var(--borderRadius-medium); border-bottom-right-radius: var(--borderRadius-medium); margin-bottom: calc(var(--borderWidth-thin)*-1);"></div></div></details-dialog></details>



<iframe role="presentation" class="render-viewer" sandbox="allow-scripts allow-same-origin allow-top-navigation allow-popups" src="https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com&amp;color_mode=light#82be70ad-845b-436e-9826-4bbc4c7fc84b" name="82be70ad-845b-436e-9826-4bbc4c7fc84b" data-content="{&quot;data&quot;:&quot;flowchart LR\n\nios[[iPhone \\n 安装 WireGuard]]\n\nsubgraph 节点 A IP 22.1.1.1\nnodea[EasyTier\\n10.144.144.1]\nend\n\nsubgraph 节点 B\nnodeb[EasyTier\\n10.144.144.2]\nend\n\nid1[[10.1.1.0/24]]\n\nios &amp;lt;-.-&amp;gt; nodea &amp;lt;--&amp;gt; nodeb &amp;lt;-.-&amp;gt; id1\n&quot;}" style="box-sizing: border-box; display: block; width: 1012px; height: 219px; border: 0px;"></iframe>

我们需要 iPhone 通过节点 A 访问 EasyTier 网络，则可进行如下配置：

在节点 A 的 easytier-core 命令中，加入 --vpn-portal 参数，指定 WireGuard 服务监听的端口，以及 WireGuard 网络使用的网段。

```shell
# 以下参数的含义为： 监听 0.0.0.0:11013 端口，WireGuard 使用 10.14.14.0/24 网段
sudo easytier-core --ipv4 10.144.144.1 --vpn-portal wg://0.0.0.0:11013/10.14.14.0/24
```



easytier-core 启动成功后，使用 easytier-cli 获取 WireGuard Client 的配置。

```shell
$> easytier-cli vpn-portal
portal_name: wireguard

############### client_config_start ###############

[Interface]
PrivateKey = 9VDvlaIC9XHUvRuE06hD2CEDrtGF+0lDthgr9SZfIho=
Address = 10.14.14.0/32 # should assign an ip from this cidr manually

[Peer]
PublicKey = zhrZQg4QdPZs8CajT3r4fmzcNsWpBL9ImQCUsnlXyGM=
AllowedIPs = 10.144.144.0/24,10.14.14.0/24
Endpoint = 0.0.0.0:11013 # should be the public ip(or domain) of the vpn server
PersistentKeepalive = 25

############### client_config_end ###############

connected_clients:
[]
```



使用 Client Config 前，需要将 Interface Address 和 Peer Endpoint 分别修改为客户端的 IP 和 EasyTier 节点的 IP。将配置文件导入 WireGuard 客户端，即可访问 EasyTier 网络。

------

### 其他配置

可使用 `easytier-core --help` 查看全部配置项